var ntrx={};
(function(){
/*!jsencrypt.min.js*/
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.JSEncrypt=e():t.JSEncrypt=e()}(window,(function(){return(()=>{"use strict";var t=[,(t,e,i)=>{function r(t){return"0123456789abcdefghijklmnopqrstuvwxyz".charAt(t)}function n(t,e){return t&e}function s(t,e){return t|e}function o(t,e){return t^e}function h(t,e){return t&~e}function a(t){if(0==t)return-1;var e=0;return 0==(65535&t)&&(t>>=16,e+=16),0==(255&t)&&(t>>=8,e+=8),0==(15&t)&&(t>>=4,e+=4),0==(3&t)&&(t>>=2,e+=2),0==(1&t)&&++e,e}function u(t){for(var e=0;0!=t;)t&=t-1,++e;return e}i.d(e,{default:()=>nt});var c,f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";function l(t){var e,i,r="";for(e=0;e+3<=t.length;e+=3)i=parseInt(t.substring(e,e+3),16),r+=f.charAt(i>>6)+f.charAt(63&i);for(e+1==t.length?(i=parseInt(t.substring(e,e+1),16),r+=f.charAt(i<<2)):e+2==t.length&&(i=parseInt(t.substring(e,e+2),16),r+=f.charAt(i>>2)+f.charAt((3&i)<<4));(3&r.length)>0;)r+="=";return r}function p(t){var e,i="",n=0,s=0;for(e=0;e<t.length&&"="!=t.charAt(e);++e){var o=f.indexOf(t.charAt(e));o<0||(0==n?(i+=r(o>>2),s=3&o,n=1):1==n?(i+=r(s<<2|o>>4),s=15&o,n=2):2==n?(i+=r(s),i+=r(o>>2),s=3&o,n=3):(i+=r(s<<2|o>>4),i+=r(15&o),n=0))}return 1==n&&(i+=r(s<<2)),i}var g,d={decode:function(t){var e;if(void 0===g){var i="= \f\n\r\t \u2028\u2029";for(g=Object.create(null),e=0;e<64;++e)g["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(e)]=e;for(g["-"]=62,g._=63,e=0;e<i.length;++e)g[i.charAt(e)]=-1}var r=[],n=0,s=0;for(e=0;e<t.length;++e){var o=t.charAt(e);if("="==o)break;if(-1!=(o=g[o])){if(void 0===o)throw new Error("Illegal character at offset "+e);n|=o,++s>=4?(r[r.length]=n>>16,r[r.length]=n>>8&255,r[r.length]=255&n,n=0,s=0):n<<=6}}switch(s){case 1:throw new Error("Base64 encoding incomplete: at least 2 bits missing");case 2:r[r.length]=n>>10;break;case 3:r[r.length]=n>>16,r[r.length]=n>>8&255}return r},re:/-----BEGIN [^-]+-----([A-Za-z0-9+\/=\s]+)-----END [^-]+-----|begin-base64[^\n]+\n([A-Za-z0-9+\/=\s]+)====/,unarmor:function(t){var e=d.re.exec(t);if(e)if(e[1])t=e[1];else{if(!e[2])throw new Error("RegExp out of sync");t=e[2]}return d.decode(t)}},v=1e13,m=function(){function t(t){this.buf=[+t||0]}return t.prototype.mulAdd=function(t,e){var i,r,n=this.buf,s=n.length;for(i=0;i<s;++i)(r=n[i]*t+e)<v?e=0:r-=(e=0|r/v)*v,n[i]=r;e>0&&(n[i]=e)},t.prototype.sub=function(t){var e,i,r=this.buf,n=r.length;for(e=0;e<n;++e)(i=r[e]-t)<0?(i+=v,t=1):t=0,r[e]=i;for(;0===r[r.length-1];)r.pop()},t.prototype.toString=function(t){if(10!=(t||10))throw new Error("only base 10 is supported");for(var e=this.buf,i=e[e.length-1].toString(),r=e.length-2;r>=0;--r)i+=(v+e[r]).toString().substring(1);return i},t.prototype.valueOf=function(){for(var t=this.buf,e=0,i=t.length-1;i>=0;--i)e=e*v+t[i];return e},t.prototype.simplify=function(){var t=this.buf;return 1==t.length?t[0]:this},t}(),y=/^(\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/,b=/^(\d\d\d\d)(0[1-9]|1[0-2])(0[1-9]|[12]\d|3[01])([01]\d|2[0-3])(?:([0-5]\d)(?:([0-5]\d)(?:[.,](\d{1,3}))?)?)?(Z|[-+](?:[0]\d|1[0-2])([0-5]\d)?)?$/;function T(t,e){return t.length>e&&(t=t.substring(0,e)+"…"),t}var S,E=function(){function t(e,i){this.hexDigits="0123456789ABCDEF",e instanceof t?(this.enc=e.enc,this.pos=e.pos):(this.enc=e,this.pos=i)}return t.prototype.get=function(t){if(void 0===t&&(t=this.pos++),t>=this.enc.length)throw new Error("Requesting byte offset "+t+" on a stream of length "+this.enc.length);return"string"==typeof this.enc?this.enc.charCodeAt(t):this.enc[t]},t.prototype.hexByte=function(t){return this.hexDigits.charAt(t>>4&15)+this.hexDigits.charAt(15&t)},t.prototype.hexDump=function(t,e,i){for(var r="",n=t;n<e;++n)if(r+=this.hexByte(this.get(n)),!0!==i)switch(15&n){case 7:r+="  ";break;case 15:r+="\n";break;default:r+=" "}return r},t.prototype.isASCII=function(t,e){for(var i=t;i<e;++i){var r=this.get(i);if(r<32||r>176)return!1}return!0},t.prototype.parseStringISO=function(t,e){for(var i="",r=t;r<e;++r)i+=String.fromCharCode(this.get(r));return i},t.prototype.parseStringUTF=function(t,e){for(var i="",r=t;r<e;){var n=this.get(r++);i+=n<128?String.fromCharCode(n):n>191&&n<224?String.fromCharCode((31&n)<<6|63&this.get(r++)):String.fromCharCode((15&n)<<12|(63&this.get(r++))<<6|63&this.get(r++))}return i},t.prototype.parseStringBMP=function(t,e){for(var i,r,n="",s=t;s<e;)i=this.get(s++),r=this.get(s++),n+=String.fromCharCode(i<<8|r);return n},t.prototype.parseTime=function(t,e,i){var r=this.parseStringISO(t,e),n=(i?y:b).exec(r);return n?(i&&(n[1]=+n[1],n[1]+=+n[1]<70?2e3:1900),r=n[1]+"-"+n[2]+"-"+n[3]+" "+n[4],n[5]&&(r+=":"+n[5],n[6]&&(r+=":"+n[6],n[7]&&(r+="."+n[7]))),n[8]&&(r+=" UTC","Z"!=n[8]&&(r+=n[8],n[9]&&(r+=":"+n[9]))),r):"Unrecognized time: "+r},t.prototype.parseInteger=function(t,e){for(var i,r=this.get(t),n=r>127,s=n?255:0,o="";r==s&&++t<e;)r=this.get(t);if(0==(i=e-t))return n?-1:0;if(i>4){for(o=r,i<<=3;0==(128&(+o^s));)o=+o<<1,--i;o="("+i+" bit)\n"}n&&(r-=256);for(var h=new m(r),a=t+1;a<e;++a)h.mulAdd(256,this.get(a));return o+h.toString()},t.prototype.parseBitString=function(t,e,i){for(var r=this.get(t),n="("+((e-t-1<<3)-r)+" bit)\n",s="",o=t+1;o<e;++o){for(var h=this.get(o),a=o==e-1?r:0,u=7;u>=a;--u)s+=h>>u&1?"1":"0";if(s.length>i)return n+T(s,i)}return n+s},t.prototype.parseOctetString=function(t,e,i){if(this.isASCII(t,e))return T(this.parseStringISO(t,e),i);var r=e-t,n="("+r+" byte)\n";r>(i/=2)&&(e=t+i);for(var s=t;s<e;++s)n+=this.hexByte(this.get(s));return r>i&&(n+="…"),n},t.prototype.parseOID=function(t,e,i){for(var r="",n=new m,s=0,o=t;o<e;++o){var h=this.get(o);if(n.mulAdd(128,127&h),s+=7,!(128&h)){if(""===r)if((n=n.simplify())instanceof m)n.sub(80),r="2."+n.toString();else{var a=n<80?n<40?0:1:2;r=a+"."+(n-40*a)}else r+="."+n.toString();if(r.length>i)return T(r,i);n=new m,s=0}}return s>0&&(r+=".incomplete"),r},t}(),w=function(){function t(t,e,i,r,n){if(!(r instanceof D))throw new Error("Invalid tag value.");this.stream=t,this.header=e,this.length=i,this.tag=r,this.sub=n}return t.prototype.typeName=function(){switch(this.tag.tagClass){case 0:switch(this.tag.tagNumber){case 0:return"EOC";case 1:return"BOOLEAN";case 2:return"INTEGER";case 3:return"BIT_STRING";case 4:return"OCTET_STRING";case 5:return"NULL";case 6:return"OBJECT_IDENTIFIER";case 7:return"ObjectDescriptor";case 8:return"EXTERNAL";case 9:return"REAL";case 10:return"ENUMERATED";case 11:return"EMBEDDED_PDV";case 12:return"UTF8String";case 16:return"SEQUENCE";case 17:return"SET";case 18:return"NumericString";case 19:return"PrintableString";case 20:return"TeletexString";case 21:return"VideotexString";case 22:return"IA5String";case 23:return"UTCTime";case 24:return"GeneralizedTime";case 25:return"GraphicString";case 26:return"VisibleString";case 27:return"GeneralString";case 28:return"UniversalString";case 30:return"BMPString"}return"Universal_"+this.tag.tagNumber.toString();case 1:return"Application_"+this.tag.tagNumber.toString();case 2:return"["+this.tag.tagNumber.toString()+"]";case 3:return"Private_"+this.tag.tagNumber.toString()}},t.prototype.content=function(t){if(void 0===this.tag)return null;void 0===t&&(t=1/0);var e=this.posContent(),i=Math.abs(this.length);if(!this.tag.isUniversal())return null!==this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+i,t);switch(this.tag.tagNumber){case 1:return 0===this.stream.get(e)?"false":"true";case 2:return this.stream.parseInteger(e,e+i);case 3:return this.sub?"("+this.sub.length+" elem)":this.stream.parseBitString(e,e+i,t);case 4:return this.sub?"("+this.sub.length+" elem)":this.stream.parseOctetString(e,e+i,t);case 6:return this.stream.parseOID(e,e+i,t);case 16:case 17:return null!==this.sub?"("+this.sub.length+" elem)":"(no elem)";case 12:return T(this.stream.parseStringUTF(e,e+i),t);case 18:case 19:case 20:case 21:case 22:case 26:return T(this.stream.parseStringISO(e,e+i),t);case 30:return T(this.stream.parseStringBMP(e,e+i),t);case 23:case 24:return this.stream.parseTime(e,e+i,23==this.tag.tagNumber)}return null},t.prototype.toString=function(){return this.typeName()+"@"+this.stream.pos+"[header:"+this.header+",length:"+this.length+",sub:"+(null===this.sub?"null":this.sub.length)+"]"},t.prototype.toPrettyString=function(t){void 0===t&&(t="");var e=t+this.typeName()+" @"+this.stream.pos;if(this.length>=0&&(e+="+"),e+=this.length,this.tag.tagConstructed?e+=" (constructed)":!this.tag.isUniversal()||3!=this.tag.tagNumber&&4!=this.tag.tagNumber||null===this.sub||(e+=" (encapsulates)"),e+="\n",null!==this.sub){t+="  ";for(var i=0,r=this.sub.length;i<r;++i)e+=this.sub[i].toPrettyString(t)}return e},t.prototype.posStart=function(){return this.stream.pos},t.prototype.posContent=function(){return this.stream.pos+this.header},t.prototype.posEnd=function(){return this.stream.pos+this.header+Math.abs(this.length)},t.prototype.toHexString=function(){return this.stream.hexDump(this.posStart(),this.posEnd(),!0)},t.decodeLength=function(t){var e=t.get(),i=127&e;if(i==e)return i;if(i>6)throw new Error("Length over 48 bits not supported at position "+(t.pos-1));if(0===i)return null;e=0;for(var r=0;r<i;++r)e=256*e+t.get();return e},t.prototype.getHexStringValue=function(){var t=this.toHexString(),e=2*this.header,i=2*this.length;return t.substr(e,i)},t.decode=function(e){var i;i=e instanceof E?e:new E(e,0);var r=new E(i),n=new D(i),s=t.decodeLength(i),o=i.pos,h=o-r.pos,a=null,u=function(){var e=[];if(null!==s){for(var r=o+s;i.pos<r;)e[e.length]=t.decode(i);if(i.pos!=r)throw new Error("Content size is not correct for container starting at offset "+o)}else try{for(;;){var n=t.decode(i);if(n.tag.isEOC())break;e[e.length]=n}s=o-i.pos}catch(t){throw new Error("Exception while decoding undefined length content: "+t)}return e};if(n.tagConstructed)a=u();else if(n.isUniversal()&&(3==n.tagNumber||4==n.tagNumber))try{if(3==n.tagNumber&&0!=i.get())throw new Error("BIT STRINGs with unused bits cannot encapsulate.");a=u();for(var c=0;c<a.length;++c)if(a[c].tag.isEOC())throw new Error("EOC is not supposed to be actual content.")}catch(t){a=null}if(null===a){if(null===s)throw new Error("We can't skip over an invalid tag with undefined length at offset "+o);i.pos=o+Math.abs(s)}return new t(r,h,s,n,a)},t}(),D=function(){function t(t){var e=t.get();if(this.tagClass=e>>6,this.tagConstructed=0!=(32&e),this.tagNumber=31&e,31==this.tagNumber){var i=new m;do{e=t.get(),i.mulAdd(128,127&e)}while(128&e);this.tagNumber=i.simplify()}}return t.prototype.isUniversal=function(){return 0===this.tagClass},t.prototype.isEOC=function(){return 0===this.tagClass&&0===this.tagNumber},t}(),x=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],R=(1<<26)/x[x.length-1],B=function(){function t(t,e,i){null!=t&&("number"==typeof t?this.fromNumber(t,e,i):null==e&&"string"!=typeof t?this.fromString(t,256):this.fromString(t,e))}return t.prototype.toString=function(t){if(this.s<0)return"-"+this.negate().toString(t);var e;if(16==t)e=4;else if(8==t)e=3;else if(2==t)e=1;else if(32==t)e=5;else{if(4!=t)return this.toRadix(t);e=2}var i,n=(1<<e)-1,s=!1,o="",h=this.t,a=this.DB-h*this.DB%e;if(h-- >0)for(a<this.DB&&(i=this[h]>>a)>0&&(s=!0,o=r(i));h>=0;)a<e?(i=(this[h]&(1<<a)-1)<<e-a,i|=this[--h]>>(a+=this.DB-e)):(i=this[h]>>(a-=e)&n,a<=0&&(a+=this.DB,--h)),i>0&&(s=!0),s&&(o+=r(i));return s?o:"0"},t.prototype.negate=function(){var e=N();return t.ZERO.subTo(this,e),e},t.prototype.abs=function(){return this.s<0?this.negate():this},t.prototype.compareTo=function(t){var e=this.s-t.s;if(0!=e)return e;var i=this.t;if(0!=(e=i-t.t))return this.s<0?-e:e;for(;--i>=0;)if(0!=(e=this[i]-t[i]))return e;return 0},t.prototype.bitLength=function(){return this.t<=0?0:this.DB*(this.t-1)+F(this[this.t-1]^this.s&this.DM)},t.prototype.mod=function(e){var i=N();return this.abs().divRemTo(e,null,i),this.s<0&&i.compareTo(t.ZERO)>0&&e.subTo(i,i),i},t.prototype.modPowInt=function(t,e){var i;return i=t<256||e.isEven()?new A(e):new V(e),this.exp(t,i)},t.prototype.clone=function(){var t=N();return this.copyTo(t),t},t.prototype.intValue=function(){if(this.s<0){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]},t.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24},t.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16},t.prototype.signum=function(){return this.s<0?-1:this.t<=0||1==this.t&&this[0]<=0?0:1},t.prototype.toByteArray=function(){var t=this.t,e=[];e[0]=this.s;var i,r=this.DB-t*this.DB%8,n=0;if(t-- >0)for(r<this.DB&&(i=this[t]>>r)!=(this.s&this.DM)>>r&&(e[n++]=i|this.s<<this.DB-r);t>=0;)r<8?(i=(this[t]&(1<<r)-1)<<8-r,i|=this[--t]>>(r+=this.DB-8)):(i=this[t]>>(r-=8)&255,r<=0&&(r+=this.DB,--t)),0!=(128&i)&&(i|=-256),0==n&&(128&this.s)!=(128&i)&&++n,(n>0||i!=this.s)&&(e[n++]=i);return e},t.prototype.equals=function(t){return 0==this.compareTo(t)},t.prototype.min=function(t){return this.compareTo(t)<0?this:t},t.prototype.max=function(t){return this.compareTo(t)>0?this:t},t.prototype.and=function(t){var e=N();return this.bitwiseTo(t,n,e),e},t.prototype.or=function(t){var e=N();return this.bitwiseTo(t,s,e),e},t.prototype.xor=function(t){var e=N();return this.bitwiseTo(t,o,e),e},t.prototype.andNot=function(t){var e=N();return this.bitwiseTo(t,h,e),e},t.prototype.not=function(){for(var t=N(),e=0;e<this.t;++e)t[e]=this.DM&~this[e];return t.t=this.t,t.s=~this.s,t},t.prototype.shiftLeft=function(t){var e=N();return t<0?this.rShiftTo(-t,e):this.lShiftTo(t,e),e},t.prototype.shiftRight=function(t){var e=N();return t<0?this.lShiftTo(-t,e):this.rShiftTo(t,e),e},t.prototype.getLowestSetBit=function(){for(var t=0;t<this.t;++t)if(0!=this[t])return t*this.DB+a(this[t]);return this.s<0?this.t*this.DB:-1},t.prototype.bitCount=function(){for(var t=0,e=this.s&this.DM,i=0;i<this.t;++i)t+=u(this[i]^e);return t},t.prototype.testBit=function(t){var e=Math.floor(t/this.DB);return e>=this.t?0!=this.s:0!=(this[e]&1<<t%this.DB)},t.prototype.setBit=function(t){return this.changeBit(t,s)},t.prototype.clearBit=function(t){return this.changeBit(t,h)},t.prototype.flipBit=function(t){return this.changeBit(t,o)},t.prototype.add=function(t){var e=N();return this.addTo(t,e),e},t.prototype.subtract=function(t){var e=N();return this.subTo(t,e),e},t.prototype.multiply=function(t){var e=N();return this.multiplyTo(t,e),e},t.prototype.divide=function(t){var e=N();return this.divRemTo(t,e,null),e},t.prototype.remainder=function(t){var e=N();return this.divRemTo(t,null,e),e},t.prototype.divideAndRemainder=function(t){var e=N(),i=N();return this.divRemTo(t,e,i),[e,i]},t.prototype.modPow=function(t,e){var i,r,n=t.bitLength(),s=C(1);if(n<=0)return s;i=n<18?1:n<48?3:n<144?4:n<768?5:6,r=n<8?new A(e):e.isEven()?new I(e):new V(e);var o=[],h=3,a=i-1,u=(1<<i)-1;if(o[1]=r.convert(this),i>1){var c=N();for(r.sqrTo(o[1],c);h<=u;)o[h]=N(),r.mulTo(c,o[h-2],o[h]),h+=2}var f,l,p=t.t-1,g=!0,d=N();for(n=F(t[p])-1;p>=0;){for(n>=a?f=t[p]>>n-a&u:(f=(t[p]&(1<<n+1)-1)<<a-n,p>0&&(f|=t[p-1]>>this.DB+n-a)),h=i;0==(1&f);)f>>=1,--h;if((n-=h)<0&&(n+=this.DB,--p),g)o[f].copyTo(s),g=!1;else{for(;h>1;)r.sqrTo(s,d),r.sqrTo(d,s),h-=2;h>0?r.sqrTo(s,d):(l=s,s=d,d=l),r.mulTo(d,o[f],s)}for(;p>=0&&0==(t[p]&1<<n);)r.sqrTo(s,d),l=s,s=d,d=l,--n<0&&(n=this.DB-1,--p)}return r.revert(s)},t.prototype.modInverse=function(e){var i=e.isEven();if(this.isEven()&&i||0==e.signum())return t.ZERO;for(var r=e.clone(),n=this.clone(),s=C(1),o=C(0),h=C(0),a=C(1);0!=r.signum();){for(;r.isEven();)r.rShiftTo(1,r),i?(s.isEven()&&o.isEven()||(s.addTo(this,s),o.subTo(e,o)),s.rShiftTo(1,s)):o.isEven()||o.subTo(e,o),o.rShiftTo(1,o);for(;n.isEven();)n.rShiftTo(1,n),i?(h.isEven()&&a.isEven()||(h.addTo(this,h),a.subTo(e,a)),h.rShiftTo(1,h)):a.isEven()||a.subTo(e,a),a.rShiftTo(1,a);r.compareTo(n)>=0?(r.subTo(n,r),i&&s.subTo(h,s),o.subTo(a,o)):(n.subTo(r,n),i&&h.subTo(s,h),a.subTo(o,a))}return 0!=n.compareTo(t.ONE)?t.ZERO:a.compareTo(e)>=0?a.subtract(e):a.signum()<0?(a.addTo(e,a),a.signum()<0?a.add(e):a):a},t.prototype.pow=function(t){return this.exp(t,new O)},t.prototype.gcd=function(t){var e=this.s<0?this.negate():this.clone(),i=t.s<0?t.negate():t.clone();if(e.compareTo(i)<0){var r=e;e=i,i=r}var n=e.getLowestSetBit(),s=i.getLowestSetBit();if(s<0)return e;for(n<s&&(s=n),s>0&&(e.rShiftTo(s,e),i.rShiftTo(s,i));e.signum()>0;)(n=e.getLowestSetBit())>0&&e.rShiftTo(n,e),(n=i.getLowestSetBit())>0&&i.rShiftTo(n,i),e.compareTo(i)>=0?(e.subTo(i,e),e.rShiftTo(1,e)):(i.subTo(e,i),i.rShiftTo(1,i));return s>0&&i.lShiftTo(s,i),i},t.prototype.isProbablePrime=function(t){var e,i=this.abs();if(1==i.t&&i[0]<=x[x.length-1]){for(e=0;e<x.length;++e)if(i[0]==x[e])return!0;return!1}if(i.isEven())return!1;for(e=1;e<x.length;){for(var r=x[e],n=e+1;n<x.length&&r<R;)r*=x[n++];for(r=i.modInt(r);e<n;)if(r%x[e++]==0)return!1}return i.millerRabin(t)},t.prototype.copyTo=function(t){for(var e=this.t-1;e>=0;--e)t[e]=this[e];t.t=this.t,t.s=this.s},t.prototype.fromInt=function(t){this.t=1,this.s=t<0?-1:0,t>0?this[0]=t:t<-1?this[0]=t+this.DV:this.t=0},t.prototype.fromString=function(e,i){var r;if(16==i)r=4;else if(8==i)r=3;else if(256==i)r=8;else if(2==i)r=1;else if(32==i)r=5;else{if(4!=i)return void this.fromRadix(e,i);r=2}this.t=0,this.s=0;for(var n=e.length,s=!1,o=0;--n>=0;){var h=8==r?255&+e[n]:H(e,n);h<0?"-"==e.charAt(n)&&(s=!0):(s=!1,0==o?this[this.t++]=h:o+r>this.DB?(this[this.t-1]|=(h&(1<<this.DB-o)-1)<<o,this[this.t++]=h>>this.DB-o):this[this.t-1]|=h<<o,(o+=r)>=this.DB&&(o-=this.DB))}8==r&&0!=(128&+e[0])&&(this.s=-1,o>0&&(this[this.t-1]|=(1<<this.DB-o)-1<<o)),this.clamp(),s&&t.ZERO.subTo(this,this)},t.prototype.clamp=function(){for(var t=this.s&this.DM;this.t>0&&this[this.t-1]==t;)--this.t},t.prototype.dlShiftTo=function(t,e){var i;for(i=this.t-1;i>=0;--i)e[i+t]=this[i];for(i=t-1;i>=0;--i)e[i]=0;e.t=this.t+t,e.s=this.s},t.prototype.drShiftTo=function(t,e){for(var i=t;i<this.t;++i)e[i-t]=this[i];e.t=Math.max(this.t-t,0),e.s=this.s},t.prototype.lShiftTo=function(t,e){for(var i=t%this.DB,r=this.DB-i,n=(1<<r)-1,s=Math.floor(t/this.DB),o=this.s<<i&this.DM,h=this.t-1;h>=0;--h)e[h+s+1]=this[h]>>r|o,o=(this[h]&n)<<i;for(h=s-1;h>=0;--h)e[h]=0;e[s]=o,e.t=this.t+s+1,e.s=this.s,e.clamp()},t.prototype.rShiftTo=function(t,e){e.s=this.s;var i=Math.floor(t/this.DB);if(i>=this.t)e.t=0;else{var r=t%this.DB,n=this.DB-r,s=(1<<r)-1;e[0]=this[i]>>r;for(var o=i+1;o<this.t;++o)e[o-i-1]|=(this[o]&s)<<n,e[o-i]=this[o]>>r;r>0&&(e[this.t-i-1]|=(this.s&s)<<n),e.t=this.t-i,e.clamp()}},t.prototype.subTo=function(t,e){for(var i=0,r=0,n=Math.min(t.t,this.t);i<n;)r+=this[i]-t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r-=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r-=t[i],e[i++]=r&this.DM,r>>=this.DB;r-=t.s}e.s=r<0?-1:0,r<-1?e[i++]=this.DV+r:r>0&&(e[i++]=r),e.t=i,e.clamp()},t.prototype.multiplyTo=function(e,i){var r=this.abs(),n=e.abs(),s=r.t;for(i.t=s+n.t;--s>=0;)i[s]=0;for(s=0;s<n.t;++s)i[s+r.t]=r.am(0,n[s],i,s,0,r.t);i.s=0,i.clamp(),this.s!=e.s&&t.ZERO.subTo(i,i)},t.prototype.squareTo=function(t){for(var e=this.abs(),i=t.t=2*e.t;--i>=0;)t[i]=0;for(i=0;i<e.t-1;++i){var r=e.am(i,e[i],t,2*i,0,1);(t[i+e.t]+=e.am(i+1,2*e[i],t,2*i+1,r,e.t-i-1))>=e.DV&&(t[i+e.t]-=e.DV,t[i+e.t+1]=1)}t.t>0&&(t[t.t-1]+=e.am(i,e[i],t,2*i,0,1)),t.s=0,t.clamp()},t.prototype.divRemTo=function(e,i,r){var n=e.abs();if(!(n.t<=0)){var s=this.abs();if(s.t<n.t)return null!=i&&i.fromInt(0),void(null!=r&&this.copyTo(r));null==r&&(r=N());var o=N(),h=this.s,a=e.s,u=this.DB-F(n[n.t-1]);u>0?(n.lShiftTo(u,o),s.lShiftTo(u,r)):(n.copyTo(o),s.copyTo(r));var c=o.t,f=o[c-1];if(0!=f){var l=f*(1<<this.F1)+(c>1?o[c-2]>>this.F2:0),p=this.FV/l,g=(1<<this.F1)/l,d=1<<this.F2,v=r.t,m=v-c,y=null==i?N():i;for(o.dlShiftTo(m,y),r.compareTo(y)>=0&&(r[r.t++]=1,r.subTo(y,r)),t.ONE.dlShiftTo(c,y),y.subTo(o,o);o.t<c;)o[o.t++]=0;for(;--m>=0;){var b=r[--v]==f?this.DM:Math.floor(r[v]*p+(r[v-1]+d)*g);if((r[v]+=o.am(0,b,r,m,0,c))<b)for(o.dlShiftTo(m,y),r.subTo(y,r);r[v]<--b;)r.subTo(y,r)}null!=i&&(r.drShiftTo(c,i),h!=a&&t.ZERO.subTo(i,i)),r.t=c,r.clamp(),u>0&&r.rShiftTo(u,r),h<0&&t.ZERO.subTo(r,r)}}},t.prototype.invDigit=function(){if(this.t<1)return 0;var t=this[0];if(0==(1&t))return 0;var e=3&t;return(e=(e=(e=(e=e*(2-(15&t)*e)&15)*(2-(255&t)*e)&255)*(2-((65535&t)*e&65535))&65535)*(2-t*e%this.DV)%this.DV)>0?this.DV-e:-e},t.prototype.isEven=function(){return 0==(this.t>0?1&this[0]:this.s)},t.prototype.exp=function(e,i){if(e>4294967295||e<1)return t.ONE;var r=N(),n=N(),s=i.convert(this),o=F(e)-1;for(s.copyTo(r);--o>=0;)if(i.sqrTo(r,n),(e&1<<o)>0)i.mulTo(n,s,r);else{var h=r;r=n,n=h}return i.revert(r)},t.prototype.chunkSize=function(t){return Math.floor(Math.LN2*this.DB/Math.log(t))},t.prototype.toRadix=function(t){if(null==t&&(t=10),0==this.signum()||t<2||t>36)return"0";var e=this.chunkSize(t),i=Math.pow(t,e),r=C(i),n=N(),s=N(),o="";for(this.divRemTo(r,n,s);n.signum()>0;)o=(i+s.intValue()).toString(t).substr(1)+o,n.divRemTo(r,n,s);return s.intValue().toString(t)+o},t.prototype.fromRadix=function(e,i){this.fromInt(0),null==i&&(i=10);for(var r=this.chunkSize(i),n=Math.pow(i,r),s=!1,o=0,h=0,a=0;a<e.length;++a){var u=H(e,a);u<0?"-"==e.charAt(a)&&0==this.signum()&&(s=!0):(h=i*h+u,++o>=r&&(this.dMultiply(n),this.dAddOffset(h,0),o=0,h=0))}o>0&&(this.dMultiply(Math.pow(i,o)),this.dAddOffset(h,0)),s&&t.ZERO.subTo(this,this)},t.prototype.fromNumber=function(e,i,r){if("number"==typeof i)if(e<2)this.fromInt(1);else for(this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(t.ONE.shiftLeft(e-1),s,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(i);)this.dAddOffset(2,0),this.bitLength()>e&&this.subTo(t.ONE.shiftLeft(e-1),this);else{var n=[],o=7&e;n.length=1+(e>>3),i.nextBytes(n),o>0?n[0]&=(1<<o)-1:n[0]=0,this.fromString(n,256)}},t.prototype.bitwiseTo=function(t,e,i){var r,n,s=Math.min(t.t,this.t);for(r=0;r<s;++r)i[r]=e(this[r],t[r]);if(t.t<this.t){for(n=t.s&this.DM,r=s;r<this.t;++r)i[r]=e(this[r],n);i.t=this.t}else{for(n=this.s&this.DM,r=s;r<t.t;++r)i[r]=e(n,t[r]);i.t=t.t}i.s=e(this.s,t.s),i.clamp()},t.prototype.changeBit=function(e,i){var r=t.ONE.shiftLeft(e);return this.bitwiseTo(r,i,r),r},t.prototype.addTo=function(t,e){for(var i=0,r=0,n=Math.min(t.t,this.t);i<n;)r+=this[i]+t[i],e[i++]=r&this.DM,r>>=this.DB;if(t.t<this.t){for(r+=t.s;i<this.t;)r+=this[i],e[i++]=r&this.DM,r>>=this.DB;r+=this.s}else{for(r+=this.s;i<t.t;)r+=t[i],e[i++]=r&this.DM,r>>=this.DB;r+=t.s}e.s=r<0?-1:0,r>0?e[i++]=r:r<-1&&(e[i++]=this.DV+r),e.t=i,e.clamp()},t.prototype.dMultiply=function(t){this[this.t]=this.am(0,t-1,this,0,0,this.t),++this.t,this.clamp()},t.prototype.dAddOffset=function(t,e){if(0!=t){for(;this.t<=e;)this[this.t++]=0;for(this[e]+=t;this[e]>=this.DV;)this[e]-=this.DV,++e>=this.t&&(this[this.t++]=0),++this[e]}},t.prototype.multiplyLowerTo=function(t,e,i){var r=Math.min(this.t+t.t,e);for(i.s=0,i.t=r;r>0;)i[--r]=0;for(var n=i.t-this.t;r<n;++r)i[r+this.t]=this.am(0,t[r],i,r,0,this.t);for(n=Math.min(t.t,e);r<n;++r)this.am(0,t[r],i,r,0,e-r);i.clamp()},t.prototype.multiplyUpperTo=function(t,e,i){--e;var r=i.t=this.t+t.t-e;for(i.s=0;--r>=0;)i[r]=0;for(r=Math.max(e-this.t,0);r<t.t;++r)i[this.t+r-e]=this.am(e-r,t[r],i,0,0,this.t+r-e);i.clamp(),i.drShiftTo(1,i)},t.prototype.modInt=function(t){if(t<=0)return 0;var e=this.DV%t,i=this.s<0?t-1:0;if(this.t>0)if(0==e)i=this[0]%t;else for(var r=this.t-1;r>=0;--r)i=(e*i+this[r])%t;return i},t.prototype.millerRabin=function(e){var i=this.subtract(t.ONE),r=i.getLowestSetBit();if(r<=0)return!1;var n=i.shiftRight(r);(e=e+1>>1)>x.length&&(e=x.length);for(var s=N(),o=0;o<e;++o){s.fromInt(x[Math.floor(Math.random()*x.length)]);var h=s.modPow(n,this);if(0!=h.compareTo(t.ONE)&&0!=h.compareTo(i)){for(var a=1;a++<r&&0!=h.compareTo(i);)if(0==(h=h.modPowInt(2,this)).compareTo(t.ONE))return!1;if(0!=h.compareTo(i))return!1}}return!0},t.prototype.square=function(){var t=N();return this.squareTo(t),t},t.prototype.gcda=function(t,e){var i=this.s<0?this.negate():this.clone(),r=t.s<0?t.negate():t.clone();if(i.compareTo(r)<0){var n=i;i=r,r=n}var s=i.getLowestSetBit(),o=r.getLowestSetBit();if(o<0)e(i);else{s<o&&(o=s),o>0&&(i.rShiftTo(o,i),r.rShiftTo(o,r));var h=function(){(s=i.getLowestSetBit())>0&&i.rShiftTo(s,i),(s=r.getLowestSetBit())>0&&r.rShiftTo(s,r),i.compareTo(r)>=0?(i.subTo(r,i),i.rShiftTo(1,i)):(r.subTo(i,r),r.rShiftTo(1,r)),i.signum()>0?setTimeout(h,0):(o>0&&r.lShiftTo(o,r),setTimeout((function(){e(r)}),0))};setTimeout(h,10)}},t.prototype.fromNumberAsync=function(e,i,r,n){if("number"==typeof i)if(e<2)this.fromInt(1);else{this.fromNumber(e,r),this.testBit(e-1)||this.bitwiseTo(t.ONE.shiftLeft(e-1),s,this),this.isEven()&&this.dAddOffset(1,0);var o=this,h=function(){o.dAddOffset(2,0),o.bitLength()>e&&o.subTo(t.ONE.shiftLeft(e-1),o),o.isProbablePrime(i)?setTimeout((function(){n()}),0):setTimeout(h,0)};setTimeout(h,0)}else{var a=[],u=7&e;a.length=1+(e>>3),i.nextBytes(a),u>0?a[0]&=(1<<u)-1:a[0]=0,this.fromString(a,256)}},t}(),O=function(){function t(){}return t.prototype.convert=function(t){return t},t.prototype.revert=function(t){return t},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i)},t.prototype.sqrTo=function(t,e){t.squareTo(e)},t}(),A=function(){function t(t){this.m=t}return t.prototype.convert=function(t){return t.s<0||t.compareTo(this.m)>=0?t.mod(this.m):t},t.prototype.revert=function(t){return t},t.prototype.reduce=function(t){t.divRemTo(this.m,null,t)},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},t.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},t}(),V=function(){function t(t){this.m=t,this.mp=t.invDigit(),this.mpl=32767&this.mp,this.mph=this.mp>>15,this.um=(1<<t.DB-15)-1,this.mt2=2*t.t}return t.prototype.convert=function(t){var e=N();return t.abs().dlShiftTo(this.m.t,e),e.divRemTo(this.m,null,e),t.s<0&&e.compareTo(B.ZERO)>0&&this.m.subTo(e,e),e},t.prototype.revert=function(t){var e=N();return t.copyTo(e),this.reduce(e),e},t.prototype.reduce=function(t){for(;t.t<=this.mt2;)t[t.t++]=0;for(var e=0;e<this.m.t;++e){var i=32767&t[e],r=i*this.mpl+((i*this.mph+(t[e]>>15)*this.mpl&this.um)<<15)&t.DM;for(t[i=e+this.m.t]+=this.m.am(0,r,t,e,0,this.m.t);t[i]>=t.DV;)t[i]-=t.DV,t[++i]++}t.clamp(),t.drShiftTo(this.m.t,t),t.compareTo(this.m)>=0&&t.subTo(this.m,t)},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},t.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},t}(),I=function(){function t(t){this.m=t,this.r2=N(),this.q3=N(),B.ONE.dlShiftTo(2*t.t,this.r2),this.mu=this.r2.divide(t)}return t.prototype.convert=function(t){if(t.s<0||t.t>2*this.m.t)return t.mod(this.m);if(t.compareTo(this.m)<0)return t;var e=N();return t.copyTo(e),this.reduce(e),e},t.prototype.revert=function(t){return t},t.prototype.reduce=function(t){for(t.drShiftTo(this.m.t-1,this.r2),t.t>this.m.t+1&&(t.t=this.m.t+1,t.clamp()),this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3),this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);t.compareTo(this.r2)<0;)t.dAddOffset(1,this.m.t+1);for(t.subTo(this.r2,t);t.compareTo(this.m)>=0;)t.subTo(this.m,t)},t.prototype.mulTo=function(t,e,i){t.multiplyTo(e,i),this.reduce(i)},t.prototype.sqrTo=function(t,e){t.squareTo(e),this.reduce(e)},t}();function N(){return new B(null)}function P(t,e){return new B(t,e)}var M="undefined"!=typeof navigator;M&&"Microsoft Internet Explorer"==navigator.appName?(B.prototype.am=function(t,e,i,r,n,s){for(var o=32767&e,h=e>>15;--s>=0;){var a=32767&this[t],u=this[t++]>>15,c=h*a+u*o;n=((a=o*a+((32767&c)<<15)+i[r]+(1073741823&n))>>>30)+(c>>>15)+h*u+(n>>>30),i[r++]=1073741823&a}return n},S=30):M&&"Netscape"!=navigator.appName?(B.prototype.am=function(t,e,i,r,n,s){for(;--s>=0;){var o=e*this[t++]+i[r]+n;n=Math.floor(o/67108864),i[r++]=67108863&o}return n},S=26):(B.prototype.am=function(t,e,i,r,n,s){for(var o=16383&e,h=e>>14;--s>=0;){var a=16383&this[t],u=this[t++]>>14,c=h*a+u*o;n=((a=o*a+((16383&c)<<14)+i[r]+n)>>28)+(c>>14)+h*u,i[r++]=268435455&a}return n},S=28),B.prototype.DB=S,B.prototype.DM=(1<<S)-1,B.prototype.DV=1<<S,B.prototype.FV=Math.pow(2,52),B.prototype.F1=52-S,B.prototype.F2=2*S-52;var j,q,L=[];for(j="0".charCodeAt(0),q=0;q<=9;++q)L[j++]=q;for(j="a".charCodeAt(0),q=10;q<36;++q)L[j++]=q;for(j="A".charCodeAt(0),q=10;q<36;++q)L[j++]=q;function H(t,e){var i=L[t.charCodeAt(e)];return null==i?-1:i}function C(t){var e=N();return e.fromInt(t),e}function F(t){var e,i=1;return 0!=(e=t>>>16)&&(t=e,i+=16),0!=(e=t>>8)&&(t=e,i+=8),0!=(e=t>>4)&&(t=e,i+=4),0!=(e=t>>2)&&(t=e,i+=2),0!=(e=t>>1)&&(t=e,i+=1),i}B.ZERO=C(0),B.ONE=C(1);var U,K,k=function(){function t(){this.i=0,this.j=0,this.S=[]}return t.prototype.init=function(t){var e,i,r;for(e=0;e<256;++e)this.S[e]=e;for(i=0,e=0;e<256;++e)i=i+this.S[e]+t[e%t.length]&255,r=this.S[e],this.S[e]=this.S[i],this.S[i]=r;this.i=0,this.j=0},t.prototype.next=function(){var t;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,t=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=t,this.S[t+this.S[this.i]&255]},t}(),_=null;if(null==_){_=[],K=0;var z=void 0;if(window.crypto&&window.crypto.getRandomValues){var Z=new Uint32Array(256);for(window.crypto.getRandomValues(Z),z=0;z<Z.length;++z)_[K++]=255&Z[z]}var G=0,$=function(t){if((G=G||0)>=256||K>=256)window.removeEventListener?window.removeEventListener("mousemove",$,!1):window.detachEvent&&window.detachEvent("onmousemove",$);else try{var e=t.x+t.y;_[K++]=255&e,G+=1}catch(t){}};window.addEventListener?window.addEventListener("mousemove",$,!1):window.attachEvent&&window.attachEvent("onmousemove",$)}function Y(){if(null==U){for(U=new k;K<256;){var t=Math.floor(65536*Math.random());_[K++]=255&t}for(U.init(_),K=0;K<_.length;++K)_[K]=0;K=0}return U.next()}var J=function(){function t(){}return t.prototype.nextBytes=function(t){for(var e=0;e<t.length;++e)t[e]=Y()},t}(),X=function(){function t(){this.n=null,this.e=0,this.d=null,this.p=null,this.q=null,this.dmp1=null,this.dmq1=null,this.coeff=null}return t.prototype.doPublic=function(t){return t.modPowInt(this.e,this.n)},t.prototype.doPrivate=function(t){if(null==this.p||null==this.q)return t.modPow(this.d,this.n);for(var e=t.mod(this.p).modPow(this.dmp1,this.p),i=t.mod(this.q).modPow(this.dmq1,this.q);e.compareTo(i)<0;)e=e.add(this.p);return e.subtract(i).multiply(this.coeff).mod(this.p).multiply(this.q).add(i)},t.prototype.setPublic=function(t,e){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=P(t,16),this.e=parseInt(e,16)):console.error("Invalid RSA public key")},t.prototype.encrypt=function(t){var e=this.n.bitLength()+7>>3,i=function(t,e){if(e<t.length+11)return console.error("Message too long for RSA"),null;for(var i=[],r=t.length-1;r>=0&&e>0;){var n=t.charCodeAt(r--);n<128?i[--e]=n:n>127&&n<2048?(i[--e]=63&n|128,i[--e]=n>>6|192):(i[--e]=63&n|128,i[--e]=n>>6&63|128,i[--e]=n>>12|224)}i[--e]=0;for(var s=new J,o=[];e>2;){for(o[0]=0;0==o[0];)s.nextBytes(o);i[--e]=o[0]}return i[--e]=2,i[--e]=0,new B(i)}(t,e);if(null==i)return null;var r=this.doPublic(i);if(null==r)return null;for(var n=r.toString(16),s=n.length,o=0;o<2*e-s;o++)n="0"+n;return n},t.prototype.setPrivate=function(t,e,i){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=P(t,16),this.e=parseInt(e,16),this.d=P(i,16)):console.error("Invalid RSA private key")},t.prototype.setPrivateEx=function(t,e,i,r,n,s,o,h){null!=t&&null!=e&&t.length>0&&e.length>0?(this.n=P(t,16),this.e=parseInt(e,16),this.d=P(i,16),this.p=P(r,16),this.q=P(n,16),this.dmp1=P(s,16),this.dmq1=P(o,16),this.coeff=P(h,16)):console.error("Invalid RSA private key")},t.prototype.generate=function(t,e){var i=new J,r=t>>1;this.e=parseInt(e,16);for(var n=new B(e,16);;){for(;this.p=new B(t-r,1,i),0!=this.p.subtract(B.ONE).gcd(n).compareTo(B.ONE)||!this.p.isProbablePrime(10););for(;this.q=new B(r,1,i),0!=this.q.subtract(B.ONE).gcd(n).compareTo(B.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var s=this.p;this.p=this.q,this.q=s}var o=this.p.subtract(B.ONE),h=this.q.subtract(B.ONE),a=o.multiply(h);if(0==a.gcd(n).compareTo(B.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(a),this.dmp1=this.d.mod(o),this.dmq1=this.d.mod(h),this.coeff=this.q.modInverse(this.p);break}}},t.prototype.decrypt=function(t){var e=P(t,16),i=this.doPrivate(e);return null==i?null:function(t,e){for(var i=t.toByteArray(),r=0;r<i.length&&0==i[r];)++r;if(i.length-r!=e-1||2!=i[r])return null;for(++r;0!=i[r];)if(++r>=i.length)return null;for(var n="";++r<i.length;){var s=255&i[r];s<128?n+=String.fromCharCode(s):s>191&&s<224?(n+=String.fromCharCode((31&s)<<6|63&i[r+1]),++r):(n+=String.fromCharCode((15&s)<<12|(63&i[r+1])<<6|63&i[r+2]),r+=2)}return n}(i,this.n.bitLength()+7>>3)},t.prototype.generateAsync=function(t,e,i){var r=new J,n=t>>1;this.e=parseInt(e,16);var s=new B(e,16),o=this,h=function(){var e=function(){if(o.p.compareTo(o.q)<=0){var t=o.p;o.p=o.q,o.q=t}var e=o.p.subtract(B.ONE),r=o.q.subtract(B.ONE),n=e.multiply(r);0==n.gcd(s).compareTo(B.ONE)?(o.n=o.p.multiply(o.q),o.d=s.modInverse(n),o.dmp1=o.d.mod(e),o.dmq1=o.d.mod(r),o.coeff=o.q.modInverse(o.p),setTimeout((function(){i()}),0)):setTimeout(h,0)},a=function(){o.q=N(),o.q.fromNumberAsync(n,1,r,(function(){o.q.subtract(B.ONE).gcda(s,(function(t){0==t.compareTo(B.ONE)&&o.q.isProbablePrime(10)?setTimeout(e,0):setTimeout(a,0)}))}))},u=function(){o.p=N(),o.p.fromNumberAsync(t-n,1,r,(function(){o.p.subtract(B.ONE).gcda(s,(function(t){0==t.compareTo(B.ONE)&&o.p.isProbablePrime(10)?setTimeout(a,0):setTimeout(u,0)}))}))};setTimeout(u,0)};setTimeout(h,0)},t.prototype.sign=function(t,e,i){var r=function(t,e){if(e<t.length+22)return console.error("Message too long for RSA"),null;for(var i=e-t.length-6,r="",n=0;n<i;n+=2)r+="ff";return P("0001"+r+"00"+t,16)}((Q[i]||"")+e(t).toString(),this.n.bitLength()/4);if(null==r)return null;var n=this.doPrivate(r);if(null==n)return null;var s=n.toString(16);return 0==(1&s.length)?s:"0"+s},t.prototype.verify=function(t,e,i){var r=P(e,16),n=this.doPublic(r);return null==n?null:function(t){for(var e in Q)if(Q.hasOwnProperty(e)){var i=Q[e],r=i.length;if(t.substr(0,r)==i)return t.substr(r)}return t}(n.toString(16).replace(/^1f+00/,""))==i(t).toString()},t}(),Q={md2:"3020300c06082a864886f70d020205000410",md5:"3020300c06082a864886f70d020505000410",sha1:"3021300906052b0e03021a05000414",sha224:"302d300d06096086480165030402040500041c",sha256:"3031300d060960864801650304020105000420",sha384:"3041300d060960864801650304020205000430",sha512:"3051300d060960864801650304020305000440",ripemd160:"3021300906052b2403020105000414"},W={};W.lang={extend:function(t,e,i){if(!e||!t)throw new Error("YAHOO.lang.extend failed, please check that all dependencies are included.");var r=function(){};if(r.prototype=e.prototype,t.prototype=new r,t.prototype.constructor=t,t.superclass=e.prototype,e.prototype.constructor==Object.prototype.constructor&&(e.prototype.constructor=e),i){var n;for(n in i)t.prototype[n]=i[n];var s=function(){},o=["toString","valueOf"];try{/MSIE/.test(navigator.userAgent)&&(s=function(t,e){for(n=0;n<o.length;n+=1){var i=o[n],r=e[i];"function"==typeof r&&r!=Object.prototype[i]&&(t[i]=r)}})}catch(t){}s(t.prototype,i)}}};var tt={};void 0!==tt.asn1&&tt.asn1||(tt.asn1={}),tt.asn1.ASN1Util=new function(){this.integerToByteHex=function(t){var e=t.toString(16);return e.length%2==1&&(e="0"+e),e},this.bigIntToMinTwosComplementsHex=function(t){var e=t.toString(16);if("-"!=e.substr(0,1))e.length%2==1?e="0"+e:e.match(/^[0-7]/)||(e="00"+e);else{var i=e.substr(1).length;i%2==1?i+=1:e.match(/^[0-7]/)||(i+=2);for(var r="",n=0;n<i;n++)r+="f";e=new B(r,16).xor(t).add(B.ONE).toString(16).replace(/^-/,"")}return e},this.getPEMStringFromHex=function(t,e){return hextopem(t,e)},this.newObject=function(t){var e=tt.asn1,i=e.DERBoolean,r=e.DERInteger,n=e.DERBitString,s=e.DEROctetString,o=e.DERNull,h=e.DERObjectIdentifier,a=e.DEREnumerated,u=e.DERUTF8String,c=e.DERNumericString,f=e.DERPrintableString,l=e.DERTeletexString,p=e.DERIA5String,g=e.DERUTCTime,d=e.DERGeneralizedTime,v=e.DERSequence,m=e.DERSet,y=e.DERTaggedObject,b=e.ASN1Util.newObject,T=Object.keys(t);if(1!=T.length)throw"key of param shall be only one.";var S=T[0];if(-1==":bool:int:bitstr:octstr:null:oid:enum:utf8str:numstr:prnstr:telstr:ia5str:utctime:gentime:seq:set:tag:".indexOf(":"+S+":"))throw"undefined key: "+S;if("bool"==S)return new i(t[S]);if("int"==S)return new r(t[S]);if("bitstr"==S)return new n(t[S]);if("octstr"==S)return new s(t[S]);if("null"==S)return new o(t[S]);if("oid"==S)return new h(t[S]);if("enum"==S)return new a(t[S]);if("utf8str"==S)return new u(t[S]);if("numstr"==S)return new c(t[S]);if("prnstr"==S)return new f(t[S]);if("telstr"==S)return new l(t[S]);if("ia5str"==S)return new p(t[S]);if("utctime"==S)return new g(t[S]);if("gentime"==S)return new d(t[S]);if("seq"==S){for(var E=t[S],w=[],D=0;D<E.length;D++){var x=b(E[D]);w.push(x)}return new v({array:w})}if("set"==S){for(E=t[S],w=[],D=0;D<E.length;D++)x=b(E[D]),w.push(x);return new m({array:w})}if("tag"==S){var R=t[S];if("[object Array]"===Object.prototype.toString.call(R)&&3==R.length){var B=b(R[2]);return new y({tag:R[0],explicit:R[1],obj:B})}var O={};if(void 0!==R.explicit&&(O.explicit=R.explicit),void 0!==R.tag&&(O.tag=R.tag),void 0===R.obj)throw"obj shall be specified for 'tag'.";return O.obj=b(R.obj),new y(O)}},this.jsonToASN1HEX=function(t){return this.newObject(t).getEncodedHex()}},tt.asn1.ASN1Util.oidHexToInt=function(t){for(var e="",i=parseInt(t.substr(0,2),16),r=(e=Math.floor(i/40)+"."+i%40,""),n=2;n<t.length;n+=2){var s=("00000000"+parseInt(t.substr(n,2),16).toString(2)).slice(-8);r+=s.substr(1,7),"0"==s.substr(0,1)&&(e=e+"."+new B(r,2).toString(10),r="")}return e},tt.asn1.ASN1Util.oidIntToHex=function(t){var e=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},i=function(t){var i="",r=new B(t,10).toString(2),n=7-r.length%7;7==n&&(n=0);for(var s="",o=0;o<n;o++)s+="0";for(r=s+r,o=0;o<r.length-1;o+=7){var h=r.substr(o,7);o!=r.length-7&&(h="1"+h),i+=e(parseInt(h,2))}return i};if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var r="",n=t.split("."),s=40*parseInt(n[0])+parseInt(n[1]);r+=e(s),n.splice(0,2);for(var o=0;o<n.length;o++)r+=i(n[o]);return r},tt.asn1.ASN1Object=function(){this.getLengthHexFromValue=function(){if(void 0===this.hV||null==this.hV)throw"this.hV is null or undefined.";if(this.hV.length%2==1)throw"value hex must be even length: n="+"".length+",v="+this.hV;var t=this.hV.length/2,e=t.toString(16);if(e.length%2==1&&(e="0"+e),t<128)return e;var i=e.length/2;if(i>15)throw"ASN.1 length too long to represent by 8x: n = "+t.toString(16);return(128+i).toString(16)+e},this.getEncodedHex=function(){return(null==this.hTLV||this.isModified)&&(this.hV=this.getFreshValueHex(),this.hL=this.getLengthHexFromValue(),this.hTLV=this.hT+this.hL+this.hV,this.isModified=!1),this.hTLV},this.getValueHex=function(){return this.getEncodedHex(),this.hV},this.getFreshValueHex=function(){return""}},tt.asn1.DERAbstractString=function(t){tt.asn1.DERAbstractString.superclass.constructor.call(this),this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(this.s)},this.setStringHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t?this.setString(t):void 0!==t.str?this.setString(t.str):void 0!==t.hex&&this.setStringHex(t.hex))},W.lang.extend(tt.asn1.DERAbstractString,tt.asn1.ASN1Object),tt.asn1.DERAbstractTime=function(t){tt.asn1.DERAbstractTime.superclass.constructor.call(this),this.localDateToUTC=function(t){return utc=t.getTime()+6e4*t.getTimezoneOffset(),new Date(utc)},this.formatDate=function(t,e,i){var r=this.zeroPadding,n=this.localDateToUTC(t),s=String(n.getFullYear());"utc"==e&&(s=s.substr(2,2));var o=s+r(String(n.getMonth()+1),2)+r(String(n.getDate()),2)+r(String(n.getHours()),2)+r(String(n.getMinutes()),2)+r(String(n.getSeconds()),2);if(!0===i){var h=n.getMilliseconds();if(0!=h){var a=r(String(h),3);o=o+"."+(a=a.replace(/[0]+$/,""))}}return o+"Z"},this.zeroPadding=function(t,e){return t.length>=e?t:new Array(e-t.length+1).join("0")+t},this.getString=function(){return this.s},this.setString=function(t){this.hTLV=null,this.isModified=!0,this.s=t,this.hV=stohex(t)},this.setByDateValue=function(t,e,i,r,n,s){var o=new Date(Date.UTC(t,e-1,i,r,n,s,0));this.setByDate(o)},this.getFreshValueHex=function(){return this.hV}},W.lang.extend(tt.asn1.DERAbstractTime,tt.asn1.ASN1Object),tt.asn1.DERAbstractStructured=function(t){tt.asn1.DERAbstractString.superclass.constructor.call(this),this.setByASN1ObjectArray=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array=t},this.appendASN1Object=function(t){this.hTLV=null,this.isModified=!0,this.asn1Array.push(t)},this.asn1Array=new Array,void 0!==t&&void 0!==t.array&&(this.asn1Array=t.array)},W.lang.extend(tt.asn1.DERAbstractStructured,tt.asn1.ASN1Object),tt.asn1.DERBoolean=function(){tt.asn1.DERBoolean.superclass.constructor.call(this),this.hT="01",this.hTLV="0101ff"},W.lang.extend(tt.asn1.DERBoolean,tt.asn1.ASN1Object),tt.asn1.DERInteger=function(t){tt.asn1.DERInteger.superclass.constructor.call(this),this.hT="02",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=tt.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var e=new B(String(t),10);this.setByBigInteger(e)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.bigint?this.setByBigInteger(t.bigint):void 0!==t.int?this.setByInteger(t.int):"number"==typeof t?this.setByInteger(t):void 0!==t.hex&&this.setValueHex(t.hex))},W.lang.extend(tt.asn1.DERInteger,tt.asn1.ASN1Object),tt.asn1.DERBitString=function(t){if(void 0!==t&&void 0!==t.obj){var e=tt.asn1.ASN1Util.newObject(t.obj);t.hex="00"+e.getEncodedHex()}tt.asn1.DERBitString.superclass.constructor.call(this),this.hT="03",this.setHexValueIncludingUnusedBits=function(t){this.hTLV=null,this.isModified=!0,this.hV=t},this.setUnusedBitsAndHexValue=function(t,e){if(t<0||7<t)throw"unused bits shall be from 0 to 7: u = "+t;var i="0"+t;this.hTLV=null,this.isModified=!0,this.hV=i+e},this.setByBinaryString=function(t){var e=8-(t=t.replace(/0+$/,"")).length%8;8==e&&(e=0);for(var i=0;i<=e;i++)t+="0";var r="";for(i=0;i<t.length-1;i+=8){var n=t.substr(i,8),s=parseInt(n,2).toString(16);1==s.length&&(s="0"+s),r+=s}this.hTLV=null,this.isModified=!0,this.hV="0"+e+r},this.setByBooleanArray=function(t){for(var e="",i=0;i<t.length;i++)1==t[i]?e+="1":e+="0";this.setByBinaryString(e)},this.newFalseArray=function(t){for(var e=new Array(t),i=0;i<t;i++)e[i]=!1;return e},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t&&t.toLowerCase().match(/^[0-9a-f]+$/)?this.setHexValueIncludingUnusedBits(t):void 0!==t.hex?this.setHexValueIncludingUnusedBits(t.hex):void 0!==t.bin?this.setByBinaryString(t.bin):void 0!==t.array&&this.setByBooleanArray(t.array))},W.lang.extend(tt.asn1.DERBitString,tt.asn1.ASN1Object),tt.asn1.DEROctetString=function(t){if(void 0!==t&&void 0!==t.obj){var e=tt.asn1.ASN1Util.newObject(t.obj);t.hex=e.getEncodedHex()}tt.asn1.DEROctetString.superclass.constructor.call(this,t),this.hT="04"},W.lang.extend(tt.asn1.DEROctetString,tt.asn1.DERAbstractString),tt.asn1.DERNull=function(){tt.asn1.DERNull.superclass.constructor.call(this),this.hT="05",this.hTLV="0500"},W.lang.extend(tt.asn1.DERNull,tt.asn1.ASN1Object),tt.asn1.DERObjectIdentifier=function(t){var e=function(t){var e=t.toString(16);return 1==e.length&&(e="0"+e),e},i=function(t){var i="",r=new B(t,10).toString(2),n=7-r.length%7;7==n&&(n=0);for(var s="",o=0;o<n;o++)s+="0";for(r=s+r,o=0;o<r.length-1;o+=7){var h=r.substr(o,7);o!=r.length-7&&(h="1"+h),i+=e(parseInt(h,2))}return i};tt.asn1.DERObjectIdentifier.superclass.constructor.call(this),this.hT="06",this.setValueHex=function(t){this.hTLV=null,this.isModified=!0,this.s=null,this.hV=t},this.setValueOidString=function(t){if(!t.match(/^[0-9.]+$/))throw"malformed oid string: "+t;var r="",n=t.split("."),s=40*parseInt(n[0])+parseInt(n[1]);r+=e(s),n.splice(0,2);for(var o=0;o<n.length;o++)r+=i(n[o]);this.hTLV=null,this.isModified=!0,this.s=null,this.hV=r},this.setValueName=function(t){var e=tt.asn1.x509.OID.name2oid(t);if(""===e)throw"DERObjectIdentifier oidName undefined: "+t;this.setValueOidString(e)},this.getFreshValueHex=function(){return this.hV},void 0!==t&&("string"==typeof t?t.match(/^[0-2].[0-9.]+$/)?this.setValueOidString(t):this.setValueName(t):void 0!==t.oid?this.setValueOidString(t.oid):void 0!==t.hex?this.setValueHex(t.hex):void 0!==t.name&&this.setValueName(t.name))},W.lang.extend(tt.asn1.DERObjectIdentifier,tt.asn1.ASN1Object),tt.asn1.DEREnumerated=function(t){tt.asn1.DEREnumerated.superclass.constructor.call(this),this.hT="0a",this.setByBigInteger=function(t){this.hTLV=null,this.isModified=!0,this.hV=tt.asn1.ASN1Util.bigIntToMinTwosComplementsHex(t)},this.setByInteger=function(t){var e=new B(String(t),10);this.setByBigInteger(e)},this.setValueHex=function(t){this.hV=t},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.int?this.setByInteger(t.int):"number"==typeof t?this.setByInteger(t):void 0!==t.hex&&this.setValueHex(t.hex))},W.lang.extend(tt.asn1.DEREnumerated,tt.asn1.ASN1Object),tt.asn1.DERUTF8String=function(t){tt.asn1.DERUTF8String.superclass.constructor.call(this,t),this.hT="0c"},W.lang.extend(tt.asn1.DERUTF8String,tt.asn1.DERAbstractString),tt.asn1.DERNumericString=function(t){tt.asn1.DERNumericString.superclass.constructor.call(this,t),this.hT="12"},W.lang.extend(tt.asn1.DERNumericString,tt.asn1.DERAbstractString),tt.asn1.DERPrintableString=function(t){tt.asn1.DERPrintableString.superclass.constructor.call(this,t),this.hT="13"},W.lang.extend(tt.asn1.DERPrintableString,tt.asn1.DERAbstractString),tt.asn1.DERTeletexString=function(t){tt.asn1.DERTeletexString.superclass.constructor.call(this,t),this.hT="14"},W.lang.extend(tt.asn1.DERTeletexString,tt.asn1.DERAbstractString),tt.asn1.DERIA5String=function(t){tt.asn1.DERIA5String.superclass.constructor.call(this,t),this.hT="16"},W.lang.extend(tt.asn1.DERIA5String,tt.asn1.DERAbstractString),tt.asn1.DERUTCTime=function(t){tt.asn1.DERUTCTime.superclass.constructor.call(this,t),this.hT="17",this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"utc"),this.hV=stohex(this.s)),this.hV},void 0!==t&&(void 0!==t.str?this.setString(t.str):"string"==typeof t&&t.match(/^[0-9]{12}Z$/)?this.setString(t):void 0!==t.hex?this.setStringHex(t.hex):void 0!==t.date&&this.setByDate(t.date))},W.lang.extend(tt.asn1.DERUTCTime,tt.asn1.DERAbstractTime),tt.asn1.DERGeneralizedTime=function(t){tt.asn1.DERGeneralizedTime.superclass.constructor.call(this,t),this.hT="18",this.withMillis=!1,this.setByDate=function(t){this.hTLV=null,this.isModified=!0,this.date=t,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)},this.getFreshValueHex=function(){return void 0===this.date&&void 0===this.s&&(this.date=new Date,this.s=this.formatDate(this.date,"gen",this.withMillis),this.hV=stohex(this.s)),this.hV},void 0!==t&&(void 0!==t.str?this.setString(t.str):"string"==typeof t&&t.match(/^[0-9]{14}Z$/)?this.setString(t):void 0!==t.hex?this.setStringHex(t.hex):void 0!==t.date&&this.setByDate(t.date),!0===t.millis&&(this.withMillis=!0))},W.lang.extend(tt.asn1.DERGeneralizedTime,tt.asn1.DERAbstractTime),tt.asn1.DERSequence=function(t){tt.asn1.DERSequence.superclass.constructor.call(this,t),this.hT="30",this.getFreshValueHex=function(){for(var t="",e=0;e<this.asn1Array.length;e++)t+=this.asn1Array[e].getEncodedHex();return this.hV=t,this.hV}},W.lang.extend(tt.asn1.DERSequence,tt.asn1.DERAbstractStructured),tt.asn1.DERSet=function(t){tt.asn1.DERSet.superclass.constructor.call(this,t),this.hT="31",this.sortFlag=!0,this.getFreshValueHex=function(){for(var t=new Array,e=0;e<this.asn1Array.length;e++){var i=this.asn1Array[e];t.push(i.getEncodedHex())}return 1==this.sortFlag&&t.sort(),this.hV=t.join(""),this.hV},void 0!==t&&void 0!==t.sortflag&&0==t.sortflag&&(this.sortFlag=!1)},W.lang.extend(tt.asn1.DERSet,tt.asn1.DERAbstractStructured),tt.asn1.DERTaggedObject=function(t){tt.asn1.DERTaggedObject.superclass.constructor.call(this),this.hT="a0",this.hV="",this.isExplicit=!0,this.asn1Object=null,this.setASN1Object=function(t,e,i){this.hT=e,this.isExplicit=t,this.asn1Object=i,this.isExplicit?(this.hV=this.asn1Object.getEncodedHex(),this.hTLV=null,this.isModified=!0):(this.hV=null,this.hTLV=i.getEncodedHex(),this.hTLV=this.hTLV.replace(/^../,e),this.isModified=!1)},this.getFreshValueHex=function(){return this.hV},void 0!==t&&(void 0!==t.tag&&(this.hT=t.tag),void 0!==t.explicit&&(this.isExplicit=t.explicit),void 0!==t.obj&&(this.asn1Object=t.obj,this.setASN1Object(this.isExplicit,this.hT,this.asn1Object)))},W.lang.extend(tt.asn1.DERTaggedObject,tt.asn1.ASN1Object);var et,it=(et=function(t,e){return(et=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}et(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}),rt=function(t){function e(i){var r=t.call(this)||this;return i&&("string"==typeof i?r.parseKey(i):(e.hasPrivateKeyProperty(i)||e.hasPublicKeyProperty(i))&&r.parsePropertiesFrom(i)),r}return it(e,t),e.prototype.parseKey=function(t){try{var e=0,i=0,r=/^\s*(?:[0-9A-Fa-f][0-9A-Fa-f]\s*)+$/.test(t)?function(t){var e;if(void 0===c){var i="0123456789ABCDEF",r=" \f\n\r\t \u2028\u2029";for(c={},e=0;e<16;++e)c[i.charAt(e)]=e;for(i=i.toLowerCase(),e=10;e<16;++e)c[i.charAt(e)]=e;for(e=0;e<r.length;++e)c[r.charAt(e)]=-1}var n=[],s=0,o=0;for(e=0;e<t.length;++e){var h=t.charAt(e);if("="==h)break;if(-1!=(h=c[h])){if(void 0===h)throw new Error("Illegal character at offset "+e);s|=h,++o>=2?(n[n.length]=s,s=0,o=0):s<<=4}}if(o)throw new Error("Hex encoding incomplete: 4 bits missing");return n}(t):d.unarmor(t),n=w.decode(r);if(3===n.sub.length&&(n=n.sub[2].sub[0]),9===n.sub.length){e=n.sub[1].getHexStringValue(),this.n=P(e,16),i=n.sub[2].getHexStringValue(),this.e=parseInt(i,16);var s=n.sub[3].getHexStringValue();this.d=P(s,16);var o=n.sub[4].getHexStringValue();this.p=P(o,16);var h=n.sub[5].getHexStringValue();this.q=P(h,16);var a=n.sub[6].getHexStringValue();this.dmp1=P(a,16);var u=n.sub[7].getHexStringValue();this.dmq1=P(u,16);var f=n.sub[8].getHexStringValue();this.coeff=P(f,16)}else{if(2!==n.sub.length)return!1;var l=n.sub[1].sub[0];e=l.sub[0].getHexStringValue(),this.n=P(e,16),i=l.sub[1].getHexStringValue(),this.e=parseInt(i,16)}return!0}catch(t){return!1}},e.prototype.getPrivateBaseKey=function(){var t={array:[new tt.asn1.DERInteger({int:0}),new tt.asn1.DERInteger({bigint:this.n}),new tt.asn1.DERInteger({int:this.e}),new tt.asn1.DERInteger({bigint:this.d}),new tt.asn1.DERInteger({bigint:this.p}),new tt.asn1.DERInteger({bigint:this.q}),new tt.asn1.DERInteger({bigint:this.dmp1}),new tt.asn1.DERInteger({bigint:this.dmq1}),new tt.asn1.DERInteger({bigint:this.coeff})]};return new tt.asn1.DERSequence(t).getEncodedHex()},e.prototype.getPrivateBaseKeyB64=function(){return l(this.getPrivateBaseKey())},e.prototype.getPublicBaseKey=function(){var t=new tt.asn1.DERSequence({array:[new tt.asn1.DERObjectIdentifier({oid:"1.2.840.113549.1.1.1"}),new tt.asn1.DERNull]}),e=new tt.asn1.DERSequence({array:[new tt.asn1.DERInteger({bigint:this.n}),new tt.asn1.DERInteger({int:this.e})]}),i=new tt.asn1.DERBitString({hex:"00"+e.getEncodedHex()});return new tt.asn1.DERSequence({array:[t,i]}).getEncodedHex()},e.prototype.getPublicBaseKeyB64=function(){return l(this.getPublicBaseKey())},e.wordwrap=function(t,e){if(!t)return t;var i="(.{1,"+(e=e||64)+"})( +|$\n?)|(.{1,"+e+"})";return t.match(RegExp(i,"g")).join("\n")},e.prototype.getPrivateKey=function(){var t="-----BEGIN RSA PRIVATE KEY-----\n";return(t+=e.wordwrap(this.getPrivateBaseKeyB64())+"\n")+"-----END RSA PRIVATE KEY-----"},e.prototype.getPublicKey=function(){var t="-----BEGIN PUBLIC KEY-----\n";return(t+=e.wordwrap(this.getPublicBaseKeyB64())+"\n")+"-----END PUBLIC KEY-----"},e.hasPublicKeyProperty=function(t){return(t=t||{}).hasOwnProperty("n")&&t.hasOwnProperty("e")},e.hasPrivateKeyProperty=function(t){return(t=t||{}).hasOwnProperty("n")&&t.hasOwnProperty("e")&&t.hasOwnProperty("d")&&t.hasOwnProperty("p")&&t.hasOwnProperty("q")&&t.hasOwnProperty("dmp1")&&t.hasOwnProperty("dmq1")&&t.hasOwnProperty("coeff")},e.prototype.parsePropertiesFrom=function(t){this.n=t.n,this.e=t.e,t.hasOwnProperty("d")&&(this.d=t.d,this.p=t.p,this.q=t.q,this.dmp1=t.dmp1,this.dmq1=t.dmq1,this.coeff=t.coeff)},e}(X);const nt=function(){function t(t){void 0===t&&(t={}),t=t||{},this.default_key_size=t.default_key_size?parseInt(t.default_key_size,10):1024,this.default_public_exponent=t.default_public_exponent||"010001",this.log=t.log||!1,this.key=null}return t.prototype.setKey=function(t){this.log&&this.key&&console.warn("A key was already set, overriding existing."),this.key=new rt(t)},t.prototype.setPrivateKey=function(t){this.setKey(t)},t.prototype.setPublicKey=function(t){this.setKey(t)},t.prototype.decrypt=function(t){try{return this.getKey().decrypt(p(t))}catch(t){return!1}},t.prototype.encrypt=function(t){try{return l(this.getKey().encrypt(t))}catch(t){return!1}},t.prototype.sign=function(t,e,i){try{return l(this.getKey().sign(t,e,i))}catch(t){return!1}},t.prototype.verify=function(t,e,i){try{return this.getKey().verify(t,p(e),i)}catch(t){return!1}},t.prototype.getKey=function(t){if(!this.key){if(this.key=new rt,t&&"[object Function]"==={}.toString.call(t))return void this.key.generateAsync(this.default_key_size,this.default_public_exponent,t);this.key.generate(this.default_key_size,this.default_public_exponent)}return this.key},t.prototype.getPrivateKey=function(){return this.getKey().getPrivateKey()},t.prototype.getPrivateKeyB64=function(){return this.getKey().getPrivateBaseKeyB64()},t.prototype.getPublicKey=function(){return this.getKey().getPublicKey()},t.prototype.getPublicKeyB64=function(){return this.getKey().getPublicBaseKeyB64()},t.version="3.2.1",t}()}],e={d:(t,i)=>{for(var r in i)e.o(i,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:i[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},i={};return t[1](0,i,e),i.default})()}));
/*!adapter.min.js*/
!function(e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}(function(){return function n(i,o,a){function s(t,e){if(!o[t]){if(!i[t]){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(c)return c(t,!0);throw(r=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",r}r=o[t]={exports:{}},i[t][0].call(r.exports,function(e){return s(i[t][1][e]||e)},r,r.exports,n,i,o,a)}return o[t].exports}for(var c="function"==typeof require&&require,e=0;e<a.length;e++)s(a[e]);return s}({1:[function(e,t,r){"use strict";e=(0,e("./adapter_factory.js").adapterFactory)({window:"undefined"==typeof window?void 0:window});t.exports=e},{"./adapter_factory.js":2}],2:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.adapterFactory=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).window,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0},r=o.log,n=o.detectBrowser(e),i={browserDetails:n,commonShim:p,extractVersion:o.extractVersion,disableLog:o.disableLog,disableWarnings:o.disableWarnings,sdp:d};switch(n.browser){case"chrome":if(!a||!a.shimPeerConnection||!t.shimChrome)return r("Chrome shim is not included in this adapter release."),i;if(null===n.version)return r("Chrome shim can not determine version, not shimming."),i;r("adapter.js shimming chrome."),i.browserShim=a,p.shimAddIceCandidateNullOrEmpty(e,n),a.shimGetUserMedia(e,n),a.shimMediaStream(e,n),a.shimPeerConnection(e,n),a.shimOnTrack(e,n),a.shimAddTrackRemoveTrack(e,n),a.shimGetSendersWithDtmf(e,n),a.shimGetStats(e,n),a.shimSenderReceiverGetStats(e,n),a.fixNegotiationNeeded(e,n),p.shimRTCIceCandidate(e,n),p.shimConnectionState(e,n),p.shimMaxMessageSize(e,n),p.shimSendThrowTypeError(e,n),p.removeExtmapAllowMixed(e,n);break;case"firefox":if(!s||!s.shimPeerConnection||!t.shimFirefox)return r("Firefox shim is not included in this adapter release."),i;r("adapter.js shimming firefox."),i.browserShim=s,p.shimAddIceCandidateNullOrEmpty(e,n),s.shimGetUserMedia(e,n),s.shimPeerConnection(e,n),s.shimOnTrack(e,n),s.shimRemoveStream(e,n),s.shimSenderGetStats(e,n),s.shimReceiverGetStats(e,n),s.shimRTCDataChannel(e,n),s.shimAddTransceiver(e,n),s.shimGetParameters(e,n),s.shimCreateOffer(e,n),s.shimCreateAnswer(e,n),p.shimRTCIceCandidate(e,n),p.shimConnectionState(e,n),p.shimMaxMessageSize(e,n),p.shimSendThrowTypeError(e,n);break;case"safari":if(!c||!t.shimSafari)return r("Safari shim is not included in this adapter release."),i;r("adapter.js shimming safari."),i.browserShim=c,p.shimAddIceCandidateNullOrEmpty(e,n),c.shimRTCIceServerUrls(e,n),c.shimCreateOfferLegacy(e,n),c.shimCallbacksAPI(e,n),c.shimLocalStreamsAPI(e,n),c.shimRemoteStreamsAPI(e,n),c.shimTrackEventTransceiver(e,n),c.shimGetUserMedia(e,n),c.shimAudioContext(e,n),p.shimRTCIceCandidate(e,n),p.shimMaxMessageSize(e,n),p.shimSendThrowTypeError(e,n),p.removeExtmapAllowMixed(e,n);break;default:r("Unsupported browser!")}return i};var o=n(e("./utils")),a=n(e("./chrome/chrome_shim")),s=n(e("./firefox/firefox_shim")),c=n(e("./safari/safari_shim")),p=n(e("./common_shim")),d=n(e("sdp"));function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}},{"./chrome/chrome_shim":3,"./common_shim":6,"./firefox/firefox_shim":7,"./safari/safari_shim":10,"./utils":11,sdp:12}],3:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimMediaStream=function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},r.shimOnTrack=function(o){{var e;"object"!==(void 0===o?"undefined":s(o))||!o.RTCPeerConnection||"ontrack"in o.RTCPeerConnection.prototype?a.wrapPeerConnectionEvent(o,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e}):(Object.defineProperty(o.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0}),e=o.RTCPeerConnection.prototype.setRemoteDescription,o.RTCPeerConnection.prototype.setRemoteDescription=function(){var i=this;return this._ontrackpoly||(this._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(t){var e=void 0,e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.track.id}):{track:t.track},r=new Event("track");r.track=t.track,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)}),n.stream.getTracks().forEach(function(t){var e=void 0,e=o.RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track&&e.track.id===t.id}):{track:t},r=new Event("track");r.track=t,r.receiver=e,r.transceiver={receiver:e},r.streams=[n.stream],i.dispatchEvent(r)})},this.addEventListener("addstream",this._ontrackpoly)),e.apply(this,arguments)})}},r.shimGetSendersWithDtmf=function(e){{var n,i,t,r,o,a;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype?(n=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}},e.RTCPeerConnection.prototype.getSenders||(e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()},i=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addTrack=function(e,t){var r=i.apply(this,arguments);return r||(r=n(this,e),this._senders.push(r)),r},t=e.RTCPeerConnection.prototype.removeTrack,e.RTCPeerConnection.prototype.removeTrack=function(e){t.apply(this,arguments);e=this._senders.indexOf(e);-1!==e&&this._senders.splice(e,1)}),r=e.RTCPeerConnection.prototype.addStream,e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach(function(e){t._senders.push(n(t,e))})},o=e.RTCPeerConnection.prototype.removeStream,e.RTCPeerConnection.prototype.removeStream=function(e){var r=this;this._senders=this._senders||[],o.apply(this,[e]),e.getTracks().forEach(function(t){var e=r._senders.find(function(e){return e.track===t});e&&r._senders.splice(r._senders.indexOf(e),1)})}):"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)&&(a=e.RTCPeerConnection.prototype.getSenders,e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=a.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}}))}},r.shimGetStats=function(e){var a;e.RTCPeerConnection&&(a=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){var r=this,e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],e=e[2];if(0<arguments.length&&"function"==typeof t)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof t))return a.apply(this,[]);function i(e){var n={};return e.result().forEach(function(t){var r={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){r[e]=t.stat(e)}),n[r.id]=r}),n}function o(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))}if(2<=arguments.length)return a.apply(this,[function(e){n(o(i(e)))},t]);return new Promise(function(t,e){a.apply(r,[function(e){t(o(i(e)))},e])}).then(n,e)})},r.shimSenderReceiverGetStats=function(e){var r,t,n,o;"object"===(void 0===e?"undefined":s(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver&&("getStats"in e.RTCRtpSender.prototype||((r=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return a.filterStats(e,t.track,!0)})}),"getStats"in e.RTCRtpReceiver.prototype||((n=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=n.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),a.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var t=this;return this._pc.getStats().then(function(e){return a.filterStats(e,t.track,!1)})}),"getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype&&(o=e.RTCPeerConnection.prototype.getStats,e.RTCPeerConnection.prototype.getStats=function(){if(0<arguments.length&&arguments[0]instanceof e.MediaStreamTrack){var t=arguments[0],r=void 0,n=void 0,i=void 0;return this.getSenders().forEach(function(e){e.track===t&&(r?i=!0:r=e)}),this.getReceivers().forEach(function(e){return e.track===t&&(n?i=!0:n=e),e.track===t}),i||r&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}))},r.shimAddTrackRemoveTrackWithNative=p,r.shimAddTrackRemoveTrack=function(i,e){if(i.RTCPeerConnection){if(i.RTCPeerConnection.prototype.addTrack&&65<=e.version)return p(i);var r=i.RTCPeerConnection.prototype.getLocalStreams;i.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this,e=r.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map(function(e){return t._reverseStreams[e.id]})};var n=i.RTCPeerConnection.prototype.addStream;i.RTCPeerConnection.prototype.addStream=function(e){var t,r=this;this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")}),this._reverseStreams[e.id]||(t=new i.MediaStream(e.getTracks()),this._streams[e.id]=t,this._reverseStreams[t.id]=e,e=t),n.apply(this,[e])};var t=i.RTCPeerConnection.prototype.removeStream;i.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[(this._streams[e.id]||e).id],delete this._streams[e.id]},i.RTCPeerConnection.prototype.addTrack=function(t,e){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var n=[].slice.call(arguments,1);if(1!==n.length||!n[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};n=this._streams[e.id];return n?(n.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))})):(n=new i.MediaStream([t]),this._streams[e.id]=n,this._reverseStreams[n.id]=e,this.addStream(n)),this.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(e){var n=i.RTCPeerConnection.prototype[e],t=c({},e,function(){var t=this,r=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[function(e){e=s(t,e);r[0].apply(null,[e])},function(e){r[1]&&r[1].apply(null,e)},arguments[2]]):n.apply(this,arguments).then(function(e){return s(t,e)})});i.RTCPeerConnection.prototype[e]=t[e]});var o=i.RTCPeerConnection.prototype.setLocalDescription;i.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type&&(arguments[0]=(r=this,n=(e=arguments[0]).sdp,Object.keys(r._reverseStreams||[]).forEach(function(e){var t=r._reverseStreams[e],e=r._streams[t.id];n=n.replace(new RegExp(t.id,"g"),e.id)}),new RTCSessionDescription({type:e.type,sdp:n}))),o.apply(this,arguments);var r,e,n};var a=Object.getOwnPropertyDescriptor(i.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(i.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=a.get.apply(this);return""===e.type?e:s(this,e)}}),i.RTCPeerConnection.prototype.removeTrack=function(t){var r=this;if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!t._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(t._pc===this))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");this._streams=this._streams||{};var n=void 0;Object.keys(this._streams).forEach(function(e){r._streams[e].getTracks().find(function(e){return t.track===e})&&(n=r._streams[e])}),n&&(1===n.getTracks().length?this.removeStream(this._reverseStreams[n.id]):n.removeTrack(t.track),this.dispatchEvent(new Event("negotiationneeded")))}}function s(r,e){var n=e.sdp;return Object.keys(r._reverseStreams||[]).forEach(function(e){var t=r._reverseStreams[e],e=r._streams[t.id];n=n.replace(new RegExp(e.id,"g"),t.id)}),new RTCSessionDescription({type:e.type,sdp:n})}},r.shimPeerConnection=function(n,e){!n.RTCPeerConnection&&n.webkitRTCPeerConnection&&(n.RTCPeerConnection=n.webkitRTCPeerConnection);n.RTCPeerConnection&&e.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=n.RTCPeerConnection.prototype[e],r=c({},e,function(){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});n.RTCPeerConnection.prototype[e]=r[e]})},r.fixNegotiationNeeded=function(e,r){a.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){var t=e.target;if(!(r.version<72||t.getConfiguration&&"plan-b"===t.getConfiguration().sdpSemantics)||"stable"===t.signalingState)return e})};var a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils.js"));function c(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(e){return t._shimmedLocalStreams[e][0]})};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,t){if(!t)return n.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=n.apply(this,arguments);return this._shimmedLocalStreams[t.id]?-1===this._shimmedLocalStreams[t.id].indexOf(r)&&this._shimmedLocalStreams[t.id].push(r):this._shimmedLocalStreams[t.id]=[t,r],r};var i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var r=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(t){if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError")});var t=this.getSenders();i.apply(this,arguments);var n=this.getSenders().filter(function(e){return-1===t.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(n)};var t=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],t.apply(this,arguments)};var o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(r){var n=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},r&&Object.keys(this._shimmedLocalStreams).forEach(function(e){var t=n._shimmedLocalStreams[e].indexOf(r);-1!==t&&n._shimmedLocalStreams[e].splice(t,1),1===n._shimmedLocalStreams[e].length&&delete n._shimmedLocalStreams[e]}),o.apply(this,arguments)}}},{"../utils.js":11,"./getdisplaymedia":4,"./getusermedia":5}],4:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(o,e){o.navigator.mediaDevices&&"getDisplayMedia"in o.navigator.mediaDevices||o.navigator.mediaDevices&&("function"==typeof e?o.navigator.mediaDevices.getDisplayMedia=function(i){return e(i).then(function(e){var t=i.video&&i.video.width,r=i.video&&i.video.height,n=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxFrameRate:n||3}},t&&(i.video.mandatory.maxWidth=t),r&&(i.video.mandatory.maxHeight=r),o.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}},{}],5:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e,t){var a,n,i,r,s=e&&e.navigator;s.mediaDevices&&(a=function(i){if("object"!==(void 0===i?"undefined":c(i))||i.mandatory||i.optional)return i;var o={};return Object.keys(i).forEach(function(t){var r,n,e;"require"!==t&&"advanced"!==t&&"mediaSource"!==t&&(void 0!==(r="object"===c(i[t])?i[t]:{ideal:i[t]}).exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact),n=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t},void 0!==r.ideal&&(o.optional=o.optional||[],e={},"number"==typeof r.ideal?(e[n("min",t)]=r.ideal,o.optional.push(e),(e={})[n("max",t)]=r.ideal):e[n("",t)]=r.ideal,o.optional.push(e)),void 0!==r.exact&&"number"!=typeof r.exact?(o.mandatory=o.mandatory||{},o.mandatory[n("",t)]=r.exact):["min","max"].forEach(function(e){void 0!==r[e]&&(o.mandatory=o.mandatory||{},o.mandatory[n(e,t)]=r[e])}))}),i.advanced&&(o.optional=(o.optional||[]).concat(i.advanced)),o},n=function(r,n){if(61<=t.version)return n(r);if((r=JSON.parse(JSON.stringify(r)))&&"object"===c(r.audio)&&((e=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])})((r=JSON.parse(JSON.stringify(r))).audio,"autoGainControl","googAutoGainControl"),e(r.audio,"noiseSuppression","googNoiseSuppression"),r.audio=a(r.audio)),r&&"object"===c(r.video)){var i=(i=r.video.facingMode)&&("object"===(void 0===i?"undefined":c(i))?i:{ideal:i}),e=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!s.mediaDevices.getSupportedConstraints||!s.mediaDevices.getSupportedConstraints().facingMode||e)){delete r.video.facingMode;var o=void 0;if("environment"===i.exact||"environment"===i.ideal?o=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(o=["front"]),o)return s.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return o.some(function(e){return t.label.toLowerCase().includes(e)})});return(t=!t&&e.length&&o.includes("back")?e[e.length-1]:t)&&(r.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}),r.video=a(r.video),p("chrome: "+JSON.stringify(r)),n(r)})}r.video=a(r.video)}return p("chrome: "+JSON.stringify(r)),n(r)},i=function(e){return 64<=t.version?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},s.getUserMedia=function(e,t,r){n(e,function(e){s.webkitGetUserMedia(e,t,function(e){r&&r(i(e))})})}.bind(s),s.mediaDevices.getUserMedia&&(r=s.mediaDevices.getUserMedia.bind(s.mediaDevices),s.mediaDevices.getUserMedia=function(e){return n(e,function(t){return r(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(i(e))})})}))};var p=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils.js")).log},{"../utils.js":11}],6:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimRTCIceCandidate=function(t){var i;!t.RTCIceCandidate||t.RTCIceCandidate&&"foundation"in t.RTCIceCandidate.prototype||(i=t.RTCIceCandidate,t.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":o(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var t=new i(e),r=a.default.parseCandidate(e.candidate),n=Object.assign(t,r);return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new i(e)},t.RTCIceCandidate.prototype=i.prototype,s.wrapPeerConnectionEvent(t,"icecandidate",function(e){return e.candidate&&Object.defineProperty(e,"candidate",{value:new t.RTCIceCandidate(e.candidate),writable:"false"}),e}))},r.shimMaxMessageSize=function(e,i){var o;e.RTCPeerConnection&&("sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}}),o=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,t,r,n;return this._sctp=null,"chrome"===i.browser&&76<=i.version&&"plan-b"===this.getConfiguration().sdpSemantics&&Object.defineProperty(this,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0}),function(e){if(!e||!e.sdp)return!1;e=a.default.splitSections(e.sdp);return e.shift(),e.some(function(e){e=a.default.parseMLine(e);return e&&"application"===e.kind&&-1!==e.protocol.indexOf("SCTP")})}(arguments[0])&&(t=function(e){e=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===e||e.length<2)return-1;e=parseInt(e[1],10);return e!=e?-1:e}(arguments[0]),r=t,n=65536,n=n="firefox"===i.browser?i.version<57?-1===r?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637:n,t=function(e,t){var r=65536;"firefox"===i.browser&&57===i.version&&(r=65535);e=a.default.matchPrefix(e.sdp,"a=max-message-size:");return 0<e.length?r=parseInt(e[0].substr(19),10):"firefox"===i.browser&&-1!==t&&(r=2147483637),r}(arguments[0],t),e=void 0,e=0===n&&0===t?Number.POSITIVE_INFINITY:0===n||0===t?Math.max(n,t):Math.min(n,t),t={},Object.defineProperty(t,"maxMessageSize",{get:function(){return e}}),this._sctp=t),o.apply(this,arguments)})},r.shimSendThrowTypeError=function(e){var t;function r(t,r){var n=t.send;t.send=function(){var e=arguments[0],e=e.length||e.size||e.byteLength;if("open"===t.readyState&&r.sctp&&e>r.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+r.sctp.maxMessageSize+" bytes)");return n.apply(t,arguments)}}e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype&&(t=e.RTCPeerConnection.prototype.createDataChannel,e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return r(e,this),e},s.wrapPeerConnectionEvent(e,"datachannel",function(e){return r(e.channel,e.target),e}))},r.shimConnectionState=function(e){var r;!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype||(r=e.RTCPeerConnection.prototype,Object.defineProperty(r,"connectionState",{get:function(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get:function(){return this._onconnectionstatechange||null},set:function(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(function(e){var t=r[e];r[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=function(e){var t,r=e.target;return r._lastConnectionState!==r.connectionState&&(r._lastConnectionState=r.connectionState,t=new Event("connectionstatechange",e),r.dispatchEvent(t)),e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),t.apply(this,arguments)}}))},r.removeExtmapAllowMixed=function(r,e){var n;r.RTCPeerConnection&&("chrome"===e.browser&&71<=e.version||"safari"===e.browser&&605<=e.version||(n=r.RTCPeerConnection.prototype.setRemoteDescription,r.RTCPeerConnection.prototype.setRemoteDescription=function(e){var t;return e&&e.sdp&&-1!==e.sdp.indexOf("\na=extmap-allow-mixed")&&(t=e.sdp.split("\n").filter(function(e){return"a=extmap-allow-mixed"!==e.trim()}).join("\n"),r.RTCSessionDescription&&e instanceof r.RTCSessionDescription?arguments[0]=new r.RTCSessionDescription({type:e.type,sdp:t}):e.sdp=t),n.apply(this,arguments)}))},r.shimAddIceCandidateNullOrEmpty=function(e,t){var r;e.RTCPeerConnection&&e.RTCPeerConnection.prototype&&((r=e.RTCPeerConnection.prototype.addIceCandidate)&&0!==r.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}))};var n,i=e("sdp"),a=(n=i)&&n.__esModule?n:{default:n},s=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("./utils"))},{"./utils":11,sdp:12}],7:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=r.shimGetUserMedia=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=e("./getusermedia");Object.defineProperty(r,"shimGetUserMedia",{enumerable:!0,get:function(){return n.shimGetUserMedia}});var i=e("./getdisplaymedia");Object.defineProperty(r,"shimGetDisplayMedia",{enumerable:!0,get:function(){return i.shimGetDisplayMedia}}),r.shimOnTrack=function(e){"object"===(void 0===e?"undefined":a(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimPeerConnection=function(n,i){var o,r;"object"===(void 0===n?"undefined":a(n))&&(n.RTCPeerConnection||n.mozRTCPeerConnection)&&(!n.RTCPeerConnection&&n.mozRTCPeerConnection&&(n.RTCPeerConnection=n.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=n.RTCPeerConnection.prototype[e],r=function(e,t,r){t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r;return e}({},e,function(){return arguments[0]=new("addIceCandidate"===e?n.RTCIceCandidate:n.RTCSessionDescription)(arguments[0]),t.apply(this,arguments)});n.RTCPeerConnection.prototype[e]=r[e]}),o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=n.RTCPeerConnection.prototype.getStats,n.RTCPeerConnection.prototype.getStats=function(){var e=Array.prototype.slice.call(arguments),t=e[0],n=e[1],e=e[2];return r.apply(this,[t||null]).then(function(r){if(i.version<53&&!n)try{r.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;r.forEach(function(e,t){r.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return r}).then(n,e)})},r.shimSenderGetStats=function(e){var r,t;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype||((r=e.RTCPeerConnection.prototype.getSenders)&&(e.RTCPeerConnection.prototype.getSenders=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),(t=e.RTCPeerConnection.prototype.addTrack)&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=t.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}))},r.shimReceiverGetStats=function(e){var r;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype||((r=e.RTCPeerConnection.prototype.getReceivers)&&(e.RTCPeerConnection.prototype.getReceivers=function(){var t=this,e=r.apply(this,[]);return e.forEach(function(e){return e._pc=t}),e}),o.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}))},r.shimRemoveStream=function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){var r=this;o.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(e){e.track&&t.getTracks().includes(e.track)&&r.removeTrack(e)})})},r.shimRTCDataChannel=function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},r.shimAddTransceiver=function(e){var i;"object"!==(void 0===e?"undefined":a(e))||!e.RTCPeerConnection||(i=e.RTCPeerConnection.prototype.addTransceiver)&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];var e=arguments[1],t=e&&"sendEncodings"in e;t&&e.sendEncodings.forEach(function(e){if("rid"in e)if(!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(1<=parseFloat(e.scaleResolutionDownBy)))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(0<=parseFloat(e.maxFramerate)))throw new RangeError("max_framerate must be >= 0.0")});var r,n=i.apply(this,arguments);return t&&("encodings"in(t=(r=n.sender).getParameters())&&(1!==t.encodings.length||0!==Object.keys(t.encodings[0]).length)||(t.encodings=e.sendEncodings,r.sendEncodings=e.sendEncodings,this.setParametersPromises.push(r.setParameters(t).then(function(){delete r.sendEncodings}).catch(function(){delete r.sendEncodings})))),n})},r.shimGetParameters=function(e){var t;"object"!==(void 0===e?"undefined":a(e))||!e.RTCRtpSender||(t=e.RTCRtpSender.prototype.getParameters)&&(e.RTCRtpSender.prototype.getParameters=function(){var e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})},r.shimCreateOffer=function(e){var r;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&(r=e.RTCPeerConnection.prototype.createOffer,e.RTCPeerConnection.prototype.createOffer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)})},r.shimCreateAnswer=function(e){var r;"object"===(void 0===e?"undefined":a(e))&&e.RTCPeerConnection&&(r=e.RTCPeerConnection.prototype.createAnswer,e.RTCPeerConnection.prototype.createAnswer=function(){var e=this,t=arguments;return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(function(){return r.apply(e,t)}).finally(function(){e.setParametersPromises=[]}):r.apply(this,arguments)})};var o=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils"))},{"../utils":11,"./getdisplaymedia":8,"./getusermedia":9}],8:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.shimGetDisplayMedia=function(t,r){t.navigator.mediaDevices&&"getDisplayMedia"in t.navigator.mediaDevices||t.navigator.mediaDevices&&(t.navigator.mediaDevices.getDisplayMedia=function(e){if(e&&e.video)return!0===e.video?e.video={mediaSource:r}:e.video.mediaSource=r,t.navigator.mediaDevices.getUserMedia(e);e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)})}},{}],9:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimGetUserMedia=function(e,t){var n=e&&e.navigator,e=e&&e.MediaStreamTrack;{var r,i,o,a;n.getUserMedia=function(e,t,r){c.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},55<t.version&&"autoGainControl"in n.mediaDevices.getSupportedConstraints()||(r=function(e,t,r){t in e&&!(r in e)&&(e[r]=e[t],delete e[t])},i=n.mediaDevices.getUserMedia.bind(n.mediaDevices),n.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":s(e))&&"object"===s(e.audio)&&(e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","mozAutoGainControl"),r(e.audio,"noiseSuppression","mozNoiseSuppression")),i(e)},e&&e.prototype.getSettings&&(o=e.prototype.getSettings,e.prototype.getSettings=function(){var e=o.apply(this,arguments);return r(e,"mozAutoGainControl","autoGainControl"),r(e,"mozNoiseSuppression","noiseSuppression"),e}),e&&e.prototype.applyConstraints&&(a=e.prototype.applyConstraints,e.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":s(e))&&(e=JSON.parse(JSON.stringify(e)),r(e,"autoGainControl","mozAutoGainControl"),r(e,"noiseSuppression","mozNoiseSuppression")),a.apply(this,[e])}))}};var c=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils"))},{"../utils":11}],10:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.shimLocalStreamsAPI=function(e){var o;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"addStream"in e.RTCPeerConnection.prototype||(o=e.RTCPeerConnection.prototype.addTrack,e.RTCPeerConnection.prototype.addStream=function(t){var r=this;this._localStreams||(this._localStreams=[]),this._localStreams.includes(t)||this._localStreams.push(t),t.getAudioTracks().forEach(function(e){return o.call(r,e,t)}),t.getVideoTracks().forEach(function(e){return o.call(r,e,t)})},e.RTCPeerConnection.prototype.addTrack=function(e){for(var t=this,r=arguments.length,n=Array(1<r?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n&&n.forEach(function(e){t._localStreams?t._localStreams.includes(e)||t._localStreams.push(e):t._localStreams=[e]}),o.apply(this,arguments)}),"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;this._localStreams||(this._localStreams=[]);var r,n=this._localStreams.indexOf(e);-1!==n&&(this._localStreams.splice(n,1),r=e.getTracks(),this.getSenders().forEach(function(e){r.includes(e.track)&&t.removeTrack(e)}))}))},r.shimRemoteStreamsAPI=function(e){var t;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams||[]}),"onaddstream"in e.RTCPeerConnection.prototype||(Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var r=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;r._remoteStreams||(r._remoteStreams=[]),r._remoteStreams.includes(e)||(r._remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.dispatchEvent(t))})})}}),t=e.RTCPeerConnection.prototype.setRemoteDescription,e.RTCPeerConnection.prototype.setRemoteDescription=function(){var r=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){var t;r._remoteStreams||(r._remoteStreams=[]),0<=r._remoteStreams.indexOf(e)||(r._remoteStreams.push(e),(t=new Event("addstream")).stream=e,r.dispatchEvent(t))})}),t.apply(r,arguments)}))},r.shimCallbacksAPI=function(e){var t,n,i,o,a,s;"object"===(void 0===e?"undefined":c(e))&&e.RTCPeerConnection&&(t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,s=t.addIceCandidate,t.createOffer=function(e,t){var r=n.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var r=i.apply(this,[2<=arguments.length?arguments[2]:e]);return t?(r.then(e,t),Promise.resolve()):r},e=function(e,t,r){e=o.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},t.setLocalDescription=e,e=function(e,t,r){e=a.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},t.setRemoteDescription=e,e=function(e,t,r){e=s.apply(this,[e]);return r?(e.then(t,r),Promise.resolve()):e},t.addIceCandidate=e)},r.shimGetUserMedia=function(e){var n=e&&e.navigator;{var t;n.mediaDevices&&n.mediaDevices.getUserMedia&&(e=n.mediaDevices,t=e.getUserMedia.bind(e),n.mediaDevices.getUserMedia=function(e){return t(i(e))})}!n.getUserMedia&&n.mediaDevices&&n.mediaDevices.getUserMedia&&(n.getUserMedia=function(e,t,r){n.mediaDevices.getUserMedia(e).then(t,r)}.bind(n))},r.shimConstraints=i,r.shimRTCIceServerUrls=function(e){var o;e.RTCPeerConnection&&(o=e.RTCPeerConnection,e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var r=[],n=0;n<e.iceServers.length;n++){var i=e.iceServers[n];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(a.deprecated("RTCIceServer.url","RTCIceServer.urls"),(i=JSON.parse(JSON.stringify(i))).urls=i.url,delete i.url,r.push(i)):r.push(e.iceServers[n])}e.iceServers=r}return new o(e,t)},e.RTCPeerConnection.prototype=o.prototype,"generateCertificate"in o&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}}))},r.shimTrackEventTransceiver=function(e){"object"===(void 0===e?"undefined":c(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},r.shimCreateOfferLegacy=function(e){var r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var t;return e&&(void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio),t=this.getTransceivers().find(function(e){return"audio"===e.receiver.track.kind}),!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo),t=this.getTransceivers().find(function(e){return"video"===e.receiver.track.kind}),!1===e.offerToReceiveVideo&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveVideo||t||this.addTransceiver("video")),r.apply(this,arguments)}},r.shimAudioContext=function(e){"object"!==(void 0===e?"undefined":c(e))||e.AudioContext||(e.AudioContext=e.webkitAudioContext)};var a=function(e){{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}}(e("../utils"));function i(e){return e&&void 0!==e.video?Object.assign({},e,{video:a.compactObject(e.video)}):e}},{"../utils":11}],11:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function a(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}r.extractVersion=s,r.wrapPeerConnectionEvent=function(e,n,i){var o,a;e.RTCPeerConnection&&(e=e.RTCPeerConnection.prototype,o=e.addEventListener,e.addEventListener=function(e,t){if(e!==n)return o.apply(this,arguments);function r(e){(e=i(e))&&(t.handleEvent?t.handleEvent(e):t(e))}return this._eventMap=this._eventMap||{},this._eventMap[n]||(this._eventMap[n]=new Map),this._eventMap[n].set(t,r),o.apply(this,[e,r])},a=e.removeEventListener,e.removeEventListener=function(e,t){if(e!==n||!this._eventMap||!this._eventMap[n])return a.apply(this,arguments);if(!this._eventMap[n].has(t))return a.apply(this,arguments);var r=this._eventMap[n].get(t);return this._eventMap[n].delete(t),0===this._eventMap[n].size&&delete this._eventMap[n],0===Object.keys(this._eventMap).length&&delete this._eventMap,a.apply(this,[e,r])},Object.defineProperty(e,"on"+n,{get:function(){return this["_on"+n]},set:function(e){this["_on"+n]&&(this.removeEventListener(n,this["_on"+n]),delete this["_on"+n]),e&&this.addEventListener(n,this["_on"+n]=e)},enumerable:!0,configurable:!0}))},r.disableLog=function(e){return"boolean"==typeof e?(i=e)?"adapter.js logging disabled":"adapter.js logging enabled":new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.")},r.disableWarnings=function(e){return"boolean"==typeof e?(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled")):new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean.")},r.log=function(){"object"===("undefined"==typeof window?"undefined":n(window))&&(i||"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments))},r.deprecated=function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},r.detectBrowser=function(e){var t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;var r=e.navigator;if(r.mozGetUserMedia)t.browser="firefox",t.version=s(r.userAgent,/Firefox\/(\d+)\./,1);else if(r.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection&&!e.RTCIceGatherer)t.browser="chrome",t.version=s(r.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!r.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=s(r.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t},r.compactObject=function i(o){if(!c(o))return o;return Object.keys(o).reduce(function(e,t){var r=c(o[t]),n=r?i(o[t]):o[t],r=r&&!Object.keys(n).length;return void 0===n||r?e:Object.assign(e,a({},t,n))},{})},r.walkStats=p,r.filterStats=function(r,t,e){var n=e?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return r.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){r.forEach(function(e){e.type===n&&e.trackId===t.id&&p(r,e,i)})}),i};var i=!0,o=!0;function s(e,t,r){t=e.match(t);return t&&t.length>=r&&parseInt(t[r],10)}function c(e){return"[object Object]"===Object.prototype.toString.call(e)}function p(t,r,n){r&&!n.has(r.id)&&(n.set(r.id,r),Object.keys(r).forEach(function(e){e.endsWith("Id")?p(t,t.get(r[e]),n):e.endsWith("Ids")&&r[e].forEach(function(e){p(t,t.get(e),n)})}))}},{}],12:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},p={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};p.localCName=p.generateIdentifier(),p.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},p.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},p.getDescription=function(e){e=p.splitSections(e);return e&&e[0]},p.getMediaSections=function(e){e=p.splitSections(e);return e.shift(),e},p.matchPrefix=function(e,t){return p.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},p.parseCandidate=function(e){for(var t=void 0,r={foundation:(t=(0===e.indexOf("a=candidate:")?e.substring(12):e.substring(10)).split(" "))[0],component:{1:"rtp",2:"rtcp"}[t[1]],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":r.relatedAddress=t[n+1];break;case"rport":r.relatedPort=parseInt(t[n+1],10);break;case"tcptype":r.tcpType=t[n+1];break;case"ufrag":r.ufrag=t[n+1],r.usernameFragment=t[n+1];break;default:void 0===r[t[n]]&&(r[t[n]]=t[n+1])}return r},p.writeCandidate=function(e){var t=[];t.push(e.foundation);var r=e.component;"rtp"===r?t.push(1):"rtcp"===r?t.push(2):t.push(r),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},p.parseIceOptions=function(e){return e.substr(14).split(" ")},p.parseRtpMap=function(e){var t=e.substr(9).split(" "),e={payloadType:parseInt(t.shift(),10)},t=t[0].split("/");return e.name=t[0],e.clockRate=parseInt(t[1],10),e.channels=3===t.length?parseInt(t[2],10):1,e.numChannels=e.channels,e},p.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var r=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==r?"/"+r:"")+"\r\n"},p.parseExtmap=function(e){e=e.substr(9).split(" ");return{id:parseInt(e[0],10),direction:0<e[0].indexOf("/")?e[0].split("/")[1]:"sendrecv",uri:e[1]}},p.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},p.parseFmtp=function(e){for(var t={},r=void 0,n=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<n.length;i++)t[(r=n[i].trim().split("="))[0].trim()]=r[1];return t},p.writeFmtp=function(t){var r,e="",n=t.payloadType;return void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length&&(r=[],Object.keys(t.parameters).forEach(function(e){t.parameters[e]?r.push(e+"="+t.parameters[e]):r.push(e)}),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"),e},p.parseRtcpFb=function(e){e=e.substr(e.indexOf(" ")+1).split(" ");return{type:e.shift(),parameter:e.join(" ")}},p.writeRtcpFb=function(e){var t="",r=e.payloadType;return void 0!==e.preferredPayloadType&&(r=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+r+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},p.parseSsrcMedia=function(e){var t=e.indexOf(" "),r={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return-1<n?(r.attribute=e.substr(t+1,n-t-1),r.value=e.substr(n+1)):r.attribute=e.substr(t+1),r},p.parseSsrcGroup=function(e){e=e.substr(13).split(" ");return{semantics:e.shift(),ssrcs:e.map(function(e){return parseInt(e,10)})}},p.getMid=function(e){e=p.matchPrefix(e,"a=mid:")[0];if(e)return e.substr(6)},p.parseFingerprint=function(e){e=e.substr(14).split(" ");return{algorithm:e[0].toLowerCase(),value:e[1]}},p.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:p.matchPrefix(e+t,"a=fingerprint:").map(p.parseFingerprint)}},p.writeDtlsParameters=function(e,t){var r="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){r+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),r},p.parseCryptoLine=function(e){e=e.substr(9).split(" ");return{tag:parseInt(e[0],10),cryptoSuite:e[1],keyParams:e[2],sessionParams:e.slice(3)}},p.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"===n(e.keyParams)?p.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},p.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;e=e.substr(7).split("|");return{keyMethod:"inline",keySalt:e[0],lifeTime:e[1],mkiValue:e[2]?e[2].split(":")[0]:void 0,mkiLength:e[2]?e[2].split(":")[1]:void 0}},p.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},p.getCryptoParameters=function(e,t){return p.matchPrefix(e+t,"a=crypto:").map(p.parseCryptoLine)},p.getIceParameters=function(e,t){var r=p.matchPrefix(e+t,"a=ice-ufrag:")[0],t=p.matchPrefix(e+t,"a=ice-pwd:")[0];return r&&t?{usernameFragment:r.substr(12),password:t.substr(10)}:null},p.writeIceParameters=function(e){var t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},p.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=p.splitLines(e)[0].split(" "),n=3;n<r.length;n++){var i=r[n],o=p.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var a=p.parseRtpMap(o),o=p.matchPrefix(e,"a=fmtp:"+i+" ");switch(a.parameters=o.length?p.parseFmtp(o[0]):{},a.rtcpFeedback=p.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(p.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return p.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(p.parseExtmap(e))}),t},p.writeRtpDescription=function(e,t){var r="";r+="m="+e+" ",r+=0<t.codecs.length?"9":"0",r+=" UDP/TLS/RTP/SAVPF ",r+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){r+=p.writeRtpMap(e),r+=p.writeFmtp(e),r+=p.writeRtcpFb(e)});var n=0;return t.codecs.forEach(function(e){e.maxptime>n&&(n=e.maxptime)}),0<n&&(r+="a=maxptime:"+n+"\r\n"),t.headerExtensions&&t.headerExtensions.forEach(function(e){r+=p.writeExtmap(e)}),r},p.parseRtpEncodingParameters=function(e){var t=[],r=p.parseRtpParameters(e),n=-1!==r.fecMechanisms.indexOf("RED"),i=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=p.matchPrefix(e,"a=ssrc:").map(function(e){return p.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<o.length&&o[0].ssrc,s=void 0,o=p.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});0<o.length&&1<o[0].length&&o[0][0]===a&&(s=o[0][1]),r.codecs.forEach(function(e){"RTX"===e.name.toUpperCase()&&e.parameters.apt&&(e={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)},a&&s&&(e.rtx={ssrc:s}),t.push(e),n&&((e=JSON.parse(JSON.stringify(e))).fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},t.push(e)))}),0===t.length&&a&&t.push({ssrc:a});var c=p.matchPrefix(e,"b=");return c.length&&(c=0===c[0].indexOf("b=TIAS:")?parseInt(c[0].substr(7),10):0===c[0].indexOf("b=AS:")?1e3*parseInt(c[0].substr(5),10)*.95-16e3:void 0,t.forEach(function(e){e.maxBitrate=c})),t},p.parseRtcpParameters=function(e){var t={},r=p.matchPrefix(e,"a=ssrc:").map(function(e){return p.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];r&&(t.cname=r.value,t.ssrc=r.ssrc);r=p.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<r.length,t.compound=0===r.length;e=p.matchPrefix(e,"a=rtcp-mux");return t.mux=0<e.length,t},p.writeRtcpParameters=function(e){var t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},p.parseMsid=function(e){var t=void 0,r=p.matchPrefix(e,"a=msid:");if(1===r.length)return{stream:(t=r[0].substr(7).split(" "))[0],track:t[1]};e=p.matchPrefix(e,"a=ssrc:").map(function(e){return p.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<e.length?{stream:(t=e[0].value.split(" "))[0],track:t[1]}:void 0},p.parseSctpDescription=function(e){var t=p.parseMLine(e),r=p.matchPrefix(e,"a=max-message-size:"),n=void 0;0<r.length&&(n=parseInt(r[0].substr(19),10)),isNaN(n)&&(n=65536);r=p.matchPrefix(e,"a=sctp-port:");if(0<r.length)return{port:parseInt(r[0].substr(12),10),protocol:t.fmt,maxMessageSize:n};e=p.matchPrefix(e,"a=sctpmap:");if(0<e.length){e=e[0].substr(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:n}}},p.writeSctpDescription=function(e,t){var r=[],r="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"];return void 0!==t.maxMessageSize&&r.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),r.join("")},p.generateSessionId=function(){return Math.random().toString().substr(2,21)},p.writeSessionBoilerplate=function(e,t,r){t=void 0!==t?t:2;return"v=0\r\no="+(r||"thisisadapterortc")+" "+(e||p.generateSessionId())+" "+t+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},p.getDirection=function(e,t){for(var r=p.splitLines(e),n=0;n<r.length;n++)switch(r[n]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[n].substr(2)}return t?p.getDirection(t):"sendrecv"},p.getKind=function(e){return p.splitLines(e)[0].split(" ")[0].substr(2)},p.isRejected=function(e){return"0"===e.split(" ",2)[1]},p.parseMLine=function(e){e=p.splitLines(e)[0].substr(2).split(" ");return{kind:e[0],port:parseInt(e[1],10),protocol:e[2],fmt:e.slice(3).join(" ")}},p.parseOLine=function(e){e=p.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:e[0],sessionId:e[1],sessionVersion:parseInt(e[2],10),netType:e[3],addressType:e[4],address:e[5]}},p.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var t=p.splitLines(e),r=0;r<t.length;r++)if(t[r].length<2||"="!==t[r].charAt(1))return!1;return!0},"object"===(void 0===t?"undefined":n(t))&&(t.exports=p)},{}]},{},[1])(1)});
/*!Toastify js 1.11.2*/
!function(t,o){"object"==typeof module&&module.exports?module.exports=o():t.Toastify=o()}(this,(function(t){var o=function(t){return new o.lib.init(t)};function i(t,o){return o.offset[t]?isNaN(o.offset[t])?o.offset[t]:o.offset[t]+"px":"0px"}function s(t,o){return!(!t||"string"!=typeof o)&&!!(t.className&&t.className.trim().split(/\s+/gi).indexOf(o)>-1)}return o.lib=o.prototype={toastify:"1.10.0",constructor:o,init:function(t){return t||(t={}),this.options={},this.toastElement=null,this.options.text=t.text||"Hi there!",this.options.node=t.node,this.options.duration=0===t.duration?0:t.duration||3e3,this.options.selector=t.selector,this.options.callback=t.callback||function(){},this.options.destination=t.destination,this.options.newWindow=t.newWindow||!1,this.options.close=t.close||!1,this.options.gravity="bottom"===t.gravity?"toastify-bottom":"toastify-top",this.options.positionLeft=t.positionLeft||!1,this.options.position=t.position||"",this.options.backgroundColor=t.backgroundColor,this.options.avatar=t.avatar||"",this.options.className=t.className||"",this.options.stopOnFocus=void 0===t.stopOnFocus||t.stopOnFocus,this.options.onClick=t.onClick,this.options.offset=t.offset||{x:0,y:0},this.options.escapeMarkup=void 0===t.escapeMarkup||t.escapeMarkup,this.options.style=t.style||{},this.options.style.background=this.options.style.background||t.backgroundColor,this},buildToast:function(){if(!this.options)throw"Toastify is not initialized";var t=document.createElement("div");t.className="toastify on "+this.options.className,this.options.position?t.className+=" toastify-"+this.options.position:!0===this.options.positionLeft?(t.className+=" toastify-left",console.warn("Property `positionLeft` will be depreciated in further versions. Please use `position` instead.")):t.className+=" toastify-right",t.className+=" "+this.options.gravity;for(const o in this.options.style)t.style[o]=this.options.style[o];if(this.options.node&&this.options.node.nodeType===Node.ELEMENT_NODE)t.appendChild(this.options.node);else if(this.options.escapeMarkup?t.innerText=this.options.text:t.innerHTML=this.options.text,""!==this.options.avatar){var o=document.createElement("img");o.src=this.options.avatar,o.className="toastify-avatar","left"==this.options.position||!0===this.options.positionLeft?t.appendChild(o):t.insertAdjacentElement("afterbegin",o)}if(!0===this.options.close){var s=document.createElement("span");s.innerHTML="&#10006;",s.className="toast-close",s.addEventListener("click",function(t){t.stopPropagation(),this.removeElement(this.toastElement),window.clearTimeout(this.toastElement.timeOutValue)}.bind(this));var n=window.innerWidth>0?window.innerWidth:screen.width;("left"==this.options.position||!0===this.options.positionLeft)&&n>360?t.insertAdjacentElement("afterbegin",s):t.appendChild(s)}if(this.options.stopOnFocus&&this.options.duration>0){var e=this;t.addEventListener("mouseover",(function(o){window.clearTimeout(t.timeOutValue)})),t.addEventListener("mouseleave",(function(){t.timeOutValue=window.setTimeout((function(){e.removeElement(t)}),e.options.duration)}))}if(void 0!==this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),!0===this.options.newWindow?window.open(this.options.destination,"_blank"):window.location=this.options.destination}.bind(this)),"function"==typeof this.options.onClick&&void 0===this.options.destination&&t.addEventListener("click",function(t){t.stopPropagation(),this.options.onClick()}.bind(this)),"object"==typeof this.options.offset){var a=i("x",this.options),r=i("y",this.options),p="left"==this.options.position?a:"-"+a,l="toastify-top"==this.options.gravity?r:"-"+r;t.style.transform="translate("+p+","+l+")"}return t},showToast:function(){var t;if(this.toastElement=this.buildToast(),!(t="string"==typeof this.options.selector?document.getElementById(this.options.selector):this.options.selector instanceof HTMLElement||this.options.selector instanceof ShadowRoot?this.options.selector:document.body))throw"Root element is not defined";return t.insertBefore(this.toastElement,t.firstChild),o.reposition(),this.options.duration>0&&(this.toastElement.timeOutValue=window.setTimeout(function(){this.removeElement(this.toastElement)}.bind(this),this.options.duration)),this},hideToast:function(){this.toastElement.timeOutValue&&clearTimeout(this.toastElement.timeOutValue),this.removeElement(this.toastElement)},removeElement:function(t){t.className=t.className.replace(" on",""),window.setTimeout(function(){this.options.node&&this.options.node.parentNode&&this.options.node.parentNode.removeChild(this.options.node),t.parentNode&&t.parentNode.removeChild(t),this.options.callback.call(t),o.reposition()}.bind(this),400)}},o.reposition=function(){for(var t,o={top:15,bottom:15},i={top:15,bottom:15},n={top:15,bottom:15},e=document.getElementsByClassName("toastify"),a=0;a<e.length;a++){t=!0===s(e[a],"toastify-top")?"toastify-top":"toastify-bottom";var r=e[a].offsetHeight;t=t.substr(9,t.length-1);(window.innerWidth>0?window.innerWidth:screen.width)<=360?(e[a].style[t]=n[t]+"px",n[t]+=r+15):!0===s(e[a],"toastify-left")?(e[a].style[t]=o[t]+"px",o[t]+=r+15):(e[a].style[t]=i[t]+"px",i[t]+=r+15)}return this},o.lib.init.prototype=o.lib,o}));var pastMsg="",$t=2e3,toast={success:function(t){if(t!==pastMsg){pastMsg=t;var o=150*t.length;o<$t&&(o=$t),Toastify({text:t,duration:o,gravity:"bottom",position:"left",backgroundColor:"green"}).showToast()}},error:function(t){if(t!==pastMsg){pastMsg=t;var o=150*t.length;o<$t&&(o=$t),Toastify({text:t,duration:o,gravity:"bottom",position:"left",backgroundColor:"red"}).showToast()}},info:function(t){if(t!==pastMsg){pastMsg=t;var o=150*t.length;o<$t&&(o=$t),Toastify({text:t,duration:o,gravity:"bottom",position:"left",backgroundColor:"royalblue"}).showToast()}}};
/*!Paris.js*/
Paris.sessions={};var defaultExtension={extensionId:"not_impelemented_yet",isInstalled:function(){return!1},getScreen:function(e){},init:function(){}};function Paris(e,r){if((e=e||{}).success="function"==typeof e.success?e.success:Paris.noop,e.error="function"==typeof e.error?e.error:Paris.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:Paris.noop,!Paris.initDone)return e.error("Library not initialized"),{};if(!Paris.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(Paris.log("Library initialized: "+Paris.initDone),!e.server)return e.error("Invalid server url"),{};var i=!1,a=null,n={},o=null,t=null,s=0,d=e.server;Paris.isArray(d)?(Paris.log("Multiple servers provided ("+d.length+"), will use the first that works"),d=null,t=e.server,Paris.debug(t)):0===d.indexOf("ws")?(i=!0,Paris.log("Using WebSockets to contact Paris: "+d)):(i=!1,Paris.log("Using REST API to contact Paris: "+d));var c=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],l=e.iceTransportPolicy,u=e.bundlePolicy,f=!0===e.ipv6,v=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(v=!0===e.withCredentials);var p=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(p=e.max_poll_events),p<1&&(p=1);var g=null;void 0!==e.token&&null!==e.token&&(g=e.token);var m=null;void 0!==e.apisecret&&null!==e.apisecret&&(m=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var P=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(P=e.keepAlivePeriod),isNaN(P)&&(P=25e3);var b=6e4;function h(e){var r={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(r.high=e.high),e.medium&&(r.medium=e.medium),e.low&&(r.low=e.low)),r}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(b=e.longPollTimeout),isNaN(b)&&(b=6e4);var S=!1,w=null,y={},k=this,T=0,C={};function A(){if(null!=w)if(Paris.debug("Long poll..."),S){var r=d+"/"+w+"?rid="+(new Date).getTime();p&&(r=r+"&maxev="+p),g&&(r=r+"&token="+encodeURIComponent(g)),m&&(r=r+"&apisecret="+encodeURIComponent(m)),Paris.httpAPICall(r,{verb:"GET",withCredentials:v,success:D,timeout:b,error:function(r,i){if(Paris.error(r+":",i),++T>3)return S=!1,void e.error("Lost connection to the server (is it down?)");A()}})}else Paris.warn("Is the server down? (connected=false)")}function D(e,n){if(T=0,i||null==w||!0===n||A(),i||!Paris.isArray(e))if("keepalive"!==e[r])if("server_info"!==e[r])if("ack"!==e[r])if("success"!==e[r])if("trickle"===e[r]){if(!(c=e.sender))return void Paris.warn("Missing sender...");if(!(u=y[c]))return void Paris.debug("This handle is not attached to this session");var o=e.candidate;Paris.debug("Got a trickled candidate on session "+w),Paris.debug(o);var t=u.webrtcStuff;t.pc&&t.remoteSdp?(Paris.debug("Adding remote candidate:",o),o&&!0!==o.completed?t.pc.addIceCandidate(o):t.pc.addIceCandidate(Paris.endOfCandidates)):(Paris.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),t.candidates||(t.candidates=[]),t.candidates.push(o),Paris.debug(t.candidates))}else{if("webrtcup"===e[r])return Paris.debug("Got a webrtcup event on session "+w),Paris.debug(e),(c=e.sender)?(u=y[c])?void u.webrtcState(!0):void Paris.debug("This handle is not attached to this session"):void Paris.warn("Missing sender...");if("hangup"===e[r]){if(Paris.debug("Got a hangup event on session "+w),Paris.debug(e),!(c=e.sender))return void Paris.warn("Missing sender...");if(!(u=y[c]))return void Paris.debug("This handle is not attached to this session");u.webrtcState(!1,e.reason),u.hangup()}else if("detached"===e[r]){if(Paris.debug("Got a detached event on session "+w),Paris.debug(e),!(c=e.sender))return void Paris.warn("Missing sender...");if(!(u=y[c]))return;u.ondetached(),u.detach()}else if("media"===e[r]){if(Paris.debug("Got a media event on session "+w),Paris.debug(e),!(c=e.sender))return void Paris.warn("Missing sender...");if(!(u=y[c]))return void Paris.debug("This handle is not attached to this session");u.mediaState(e.type,e.receiving)}else if("slowlink"===e[r]){if(Paris.debug("Got a slowlink event on session "+w),Paris.debug(e),!(c=e.sender))return void Paris.warn("Missing sender...");if(!(u=y[c]))return void Paris.debug("This handle is not attached to this session");u.slowLink(e.uplink,e.lost)}else{if("error"===e[r]){var s,d;if(Paris.error("Ooops: "+e.error.code+" "+e.error.reason),Paris.debug(e),s=e.transaction)(d=C[s])&&d(e),delete C[s];return}if("event"===e[r]){var c;if(Paris.debug("Got a plugin event on session "+w),Paris.debug(e),!(c=e.sender))return void Paris.warn("Missing sender...");var l=e.plugindata;if(!l)return void Paris.warn("Missing plugindata...");Paris.debug("  -- Event is coming from "+c+" ("+l.plugin+")");var u,f=l.data;if(Paris.debug(f),!(u=y[c]))return void Paris.warn("This handle is not attached to this session");var v=e.jsep;v&&(Paris.debug("Handling SDP as well..."),Paris.debug(v));var p=u.onmessage;p?(Paris.debug("Notifying application..."),p(f,v)):Paris.debug("No provided notification callback")}else{if("timeout"===e[r])return Paris.error("Timeout on session "+w),Paris.debug(e),void(i&&a.close(3504,"Gateway timeout"));Paris.warn("Unknown message/event  '"+e[r]+"' on session "+w),Paris.debug(e)}}}else Paris.debug("Got a success on session "+w),Paris.debug(e),(s=e.transaction)&&((d=C[s])&&d(e),delete C[s]);else Paris.debug("Got an ack on session "+w),Paris.debug(e),(s=e.transaction)&&((d=C[s])&&d(e),delete C[s]);else Paris.debug("Got info on the Paris instance"),Paris.debug(e),(s=e.transaction)&&((d=C[s])&&d(e),delete C[s]);else Paris.vdebug("Got a keepalive on session "+w);else for(var g=0;g<e.length;g++)D(e[g],!0)}function R(){if(d&&i&&S){o=setTimeout(R,P);var e={session_id:w,transaction:Paris.randomString(12)};e[r]="keepalive",g&&(e.token=g),m&&(e.apisecret=m),a.send(JSON.stringify(e))}}function I(c){var l=Paris.randomString(12),u={transaction:l};if(u[r]="create",c.reconnect&&(S=!1,u[r]="claim",u.session_id=w,a&&(a.onopen=null,a.onerror=null,a.onclose=null,o&&(clearTimeout(o),o=null))),g&&(u.token=g),m&&(u.apisecret=m),!d&&Paris.isArray(t)&&(0===(d=t[s]).indexOf("ws")?(i=!0,Paris.log("Server #"+(s+1)+": trying WebSockets to contact Paris ("+d+")")):(i=!1,Paris.log("Server #"+(s+1)+": trying REST API to contact Paris ("+d+")"))),i)for(var f in a=Paris.newWebSocket(d,r+"-protocol"),n={error:function(){if(Paris.error("Error connecting to the Paris WebSockets server... "+d),Paris.isArray(t)&&!c.reconnect)return++s===t.length?void c.error("Error connecting to any of the provided Paris servers: Is the server down?"):(d=null,void setTimeout((function(){I(c)}),200));c.error("Error connecting to the Paris WebSockets server: Is the server down?")},open:function(){C[l]=function(e){if(Paris.debug(e),"success"!==e[r])return Paris.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);o=setTimeout(R,P),S=!0,w=e.session_id?e.session_id:e.data.id,c.reconnect?Paris.log("Claimed session: "+w):Paris.log("Created session: "+w),Paris.sessions[w]=k,c.success()},a.send(JSON.stringify(u))},message:function(e){D(JSON.parse(e.data))},close:function(){d&&S&&(S=!1,e.error("Lost connection to the server (is it down?)"))}})a.addEventListener(f,n[f]);else Paris.httpAPICall(d,{verb:"POST",withCredentials:v,body:u,success:function(e){if(Paris.debug(e),"success"!==e[r])return Paris.error("Ooops: "+e.error.code+" "+e.error.reason),void c.error(e.error.reason);S=!0,w=e.session_id?e.session_id:e.data.id,c.reconnect?Paris.log("Claimed session: "+w):Paris.log("Created session: "+w),Paris.sessions[w]=k,A(),c.success()},error:function(e,r){if(Paris.error(e+":",r),Paris.isArray(t)&&!c.reconnect)return++s===t.length?void c.error("Error connecting to any of the provided Paris servers: Is the server down?"):(d=null,void setTimeout((function(){I(c)}),200));""===r?c.error(e+": Is the server down?"):c.error(e+": "+r)}})}function V(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:Paris.noop,n.error="function"==typeof n.error?n.error:Paris.noop,!S)return Paris.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var o=y[e];if(!o||!o.webrtcStuff)return Paris.warn("Invalid handle"),void n.error("Invalid handle");var t=n.message,s=n.jsep,c=Paris.randomString(12),l={body:t,transaction:c};if(l[r]="message",o.token&&(l.token=o.token),m&&(l.apisecret=m),s&&(l.jsep={type:s.type,sdp:s.sdp},s.e2ee&&(l.jsep.e2ee=!0),"hml"!==s.rid_order&&"lmh"!==s.rid_order||(l.jsep.rid_order=s.rid_order)),Paris.debug("Sending message to plugin (handle="+e+"):"),Paris.debug(l),i)return l.session_id=w,l.handle_id=e,C[c]=function(e){if(Paris.debug("Message sent!"),Paris.debug(e),"success"===e[r]){var i=e.plugindata;if(!i)return Paris.warn("Request succeeded, but missing plugindata..."),void n.success();Paris.log("Synchronous transaction successful ("+i.plugin+")");var a=i.data;return Paris.debug(a),void n.success(a)}"ack"===e[r]?n.success():e.error?(Paris.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(Paris.error("Unknown error"),n.error("Unknown error"))},void a.send(JSON.stringify(l));Paris.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:v,body:l,success:function(e){if(Paris.debug("Message sent!"),Paris.debug(e),"success"===e[r]){var i=e.plugindata;if(!i)return Paris.warn("Request succeeded, but missing plugindata..."),void n.success();Paris.log("Synchronous transaction successful ("+i.plugin+")");var a=i.data;return Paris.debug(a),void n.success(a)}"ack"===e[r]?n.success():e.error?(Paris.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(Paris.error("Unknown error"),n.error("Unknown error"))},error:function(e,r){Paris.error(e+":",r),n.error(e+": "+r)}})}function x(e,n){if(S){var o=y[e];if(o&&o.webrtcStuff){var t={candidate:n,transaction:Paris.randomString(12)};if(t[r]="trickle",o.token&&(t.token=o.token),m&&(t.apisecret=m),Paris.vdebug("Sending trickle candidate (handle="+e+"):"),Paris.vdebug(t),i)return t.session_id=w,t.handle_id=e,void a.send(JSON.stringify(t));Paris.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:v,body:t,success:function(e){Paris.vdebug("Candidate sent!"),Paris.vdebug(e),"ack"===e[r]||Paris.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,r){Paris.error(e+":",r)}})}else Paris.warn("Invalid handle")}else Paris.warn("Is the server down? (connected=false)")}function M(e,r,i,a,n){var o=y[e];if(o&&o.webrtcStuff){var t=o.webrtcStuff;if(t.pc){var s=function(e){Paris.log("Received state change on data channel:",e);var r=e.target.label,i=e.target.protocol,a=t.dataChannel[r]?t.dataChannel[r].readyState:"null";if(Paris.log("State change on <"+r+"> data channel: "+a),"open"===a){if(t.dataChannel[r].pending&&t.dataChannel[r].pending.length>0){for(var n of(Paris.log("Sending pending messages on <"+r+">:",t.dataChannel[r].pending.length),t.dataChannel[r].pending))Paris.log("Sending data on data channel <"+r+">"),Paris.debug(n),t.dataChannel[r].send(n);t.dataChannel[r].pending=[]}o.ondataopen(r,i)}};if(a)t.dataChannel[r]=a;else{var d={ordered:!0};i&&(d.protocol=i),t.dataChannel[r]=t.pc.createDataChannel(r,d)}t.dataChannel[r].onmessage=function(e){var r=e.target.label;o.ondata(e.data,r)},t.dataChannel[r].onopen=s,t.dataChannel[r].onclose=s,t.dataChannel[r].onerror=function(e){Paris.error("Got error on data channel:",e)},t.dataChannel[r].pending=[],n&&t.dataChannel[r].pending.push(n)}else Paris.warn("Invalid PeerConnection")}else Paris.warn("Invalid handle")}function E(e,r){(r=r||{}).success="function"==typeof r.success?r.success:Paris.noop,r.error="function"==typeof r.error?r.error:Paris.noop;var i=y[e];if(!i||!i.webrtcStuff)return Paris.warn("Invalid handle"),void r.error("Invalid handle");var a=i.webrtcStuff,n=r.text||r.data;if(!n)return Paris.warn("Invalid data"),void r.error("Invalid data");var o=r.label?r.label:Paris.dataChanDefaultLabel;return a.dataChannel[o]?"open"!==a.dataChannel[o].readyState?(a.dataChannel[o].pending.push(n),void r.success()):(Paris.debug(n),a.dataChannel[o].send(n),void r.success()):(M(e,o,r.protocol,!1,n,r.protocol),void r.success())}function O(e,r){(r=r||{}).success="function"==typeof r.success?r.success:Paris.noop,r.error="function"==typeof r.error?r.error:Paris.noop;var i=y[e];if(!i||!i.webrtcStuff)return Paris.warn("Invalid handle"),void r.error("Invalid handle");var a=i.webrtcStuff;if(!a.dtmfSender){if(a.pc){var n=a.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!n)return Paris.warn("Invalid DTMF configuration (no audio track)"),void r.error("Invalid DTMF configuration (no audio track)");a.dtmfSender=n.dtmf,a.dtmfSender&&(Paris.log("Created DTMF Sender"),a.dtmfSender.ontonechange=function(e){Paris.debug("Sent DTMF tone: "+e.tone)})}if(!a.dtmfSender)return Paris.warn("Invalid DTMF configuration"),void r.error("Invalid DTMF configuration")}var o=r.dtmf;if(!o)return Paris.warn("Invalid DTMF parameters"),void r.error("Invalid DTMF parameters");var t=o.tones;if(!t)return Paris.warn("Invalid DTMF string"),void r.error("Invalid DTMF string");var s="number"==typeof o.duration?o.duration:500,d="number"==typeof o.gap?o.gap:50;Paris.debug("Sending DTMF string "+t+" (duration "+s+"ms, gap "+d+"ms)"),a.dtmfSender.insertDTMF(t,s,d),r.success()}function L(e,n){(n=n||{}).success="function"==typeof n.success?n.success:Paris.noop,n.error="function"==typeof n.error?n.error:Paris.noop;var o=!0===n.noRequest;Paris.log("Destroying handle "+e+" (only-locally="+o+")"),G(e);var t=y[e];if(!t||t.detached)return delete y[e],void n.success();if(t.detached=!0,o)return delete y[e],void n.success();if(!S)return Paris.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var s={transaction:Paris.randomString(12)};if(s[r]="detach",t.token&&(s.token=t.token),m&&(s.apisecret=m),i)return s.session_id=w,s.handle_id=e,a.send(JSON.stringify(s)),delete y[e],void n.success();Paris.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:v,body:s,success:function(i){Paris.log("Destroyed handle:"),Paris.debug(i),"success"!==i[r]&&Paris.error("Ooops: "+i.error.code+" "+i.error.reason),delete y[e],n.success()},error:function(r,i){Paris.error(r+":",i),delete y[e],n.success()}})}function N(e,r,i,a,n){var o=y[e];if(!o||!o.webrtcStuff)return Paris.warn("Invalid handle"),a.stream||Paris.stopAllTracks(n),void a.error("Invalid handle");var t=o.webrtcStuff;Paris.debug("streamsDone:",n),n&&(Paris.debug("  -- Audio tracks:",n.getAudioTracks()),Paris.debug("  -- Video tracks:",n.getVideoTracks()));var s=!1;if(t.myStream&&i.update&&(!t.streamExternal||i.replaceAudio||i.replaceVideo)){if((!i.update&&z(i)||i.update&&(i.addAudio||i.replaceAudio))&&n.getAudioTracks()&&n.getAudioTracks().length)if(t.myStream.addTrack(n.getAudioTracks()[0]),Paris.unifiedPlan){Paris.log((i.replaceAudio?"Replacing":"Adding")+" audio track:",n.getAudioTracks()[0]);var d=null;if((p=t.pc.getTransceivers())&&p.length>0)for(var v of p)if(v.sender&&v.sender.track&&"audio"===v.sender.track.kind||v.receiver&&v.receiver.track&&"audio"===v.receiver.track.kind){d=v;break}d&&d.sender?d.sender.replaceTrack(n.getAudioTracks()[0]):t.pc.addTrack(n.getAudioTracks()[0],n)}else Paris.log((i.replaceAudio?"Replacing":"Adding")+" audio track:",n.getAudioTracks()[0]),t.pc.addTrack(n.getAudioTracks()[0],n);if((!i.update&&H(i)||i.update&&(i.addVideo||i.replaceVideo))&&n.getVideoTracks()&&n.getVideoTracks().length)if(t.myStream.addTrack(n.getVideoTracks()[0]),Paris.unifiedPlan){Paris.log((i.replaceVideo?"Replacing":"Adding")+" video track:",n.getVideoTracks()[0]);var p,g=null;if((p=t.pc.getTransceivers())&&p.length>0)for(var v of p)if(v.sender&&v.sender.track&&"video"===v.sender.track.kind||v.receiver&&v.receiver.track&&"video"===v.receiver.track.kind){g=v;break}g&&g.sender?g.sender.replaceTrack(n.getVideoTracks()[0]):t.pc.addTrack(n.getVideoTracks()[0],n)}else Paris.log((i.replaceVideo?"Replacing":"Adding")+" video track:",n.getVideoTracks()[0]),t.pc.addTrack(n.getVideoTracks()[0],n)}else t.myStream=n,s=!0;if(!t.pc){var m={iceServers:c,iceTransportPolicy:l,bundlePolicy:u};"chrome"===Paris.webRTCAdapter.browserDetails.browser&&(m.sdpSemantics=Paris.webRTCAdapter.browserDetails.version<72?"plan-b":"unified-plan");var P={optional:[{DtlsSrtpKeyAgreement:!0}]};if(f&&P.optional.push({googIPv6:!0}),a.rtcConstraints&&"object"==typeof a.rtcConstraints)for(var b in Paris.debug("Adding custom PeerConnection constraints:",a.rtcConstraints),a.rtcConstraints)P.optional.push(a.rtcConstraints[b]);"edge"===Paris.webRTCAdapter.browserDetails.browser&&(m.bundlePolicy="max-bundle"),RTCRtpSender&&(RTCRtpSender.prototype.createEncodedStreams||RTCRtpSender.prototype.createEncodedAudioStreams&&RTCRtpSender.prototype.createEncodedVideoStreams)&&(a.senderTransforms||a.receiverTransforms)&&(t.senderTransforms=a.senderTransforms,t.receiverTransforms=a.receiverTransforms,m.forceEncodedAudioInsertableStreams=!0,m.forceEncodedVideoInsertableStreams=!0,m.encodedInsertableStreams=!0),Paris.log("Creating PeerConnection"),Paris.debug(P),t.pc=new RTCPeerConnection(m,P),Paris.debug(t.pc),t.pc.getStats&&(t.volume={},t.bitrate.value="0 kbits/sec"),Paris.log("Preparing local SDP and gathering candidates (trickle="+t.trickle+")"),t.pc.oniceconnectionstatechange=function(e){t.pc&&o.iceState(t.pc.iceConnectionState)},t.pc.onicecandidate=function(r){if(!r.candidate||"edge"===Paris.webRTCAdapter.browserDetails.browser&&r.candidate.candidate.indexOf("endOfCandidates")>0)Paris.log("End of candidates."),t.iceDone=!0,!0===t.trickle?x(e,{completed:!0}):function(e,r){r=r||{},r.success="function"==typeof r.success?r.success:Paris.noop,r.error="function"==typeof r.error?r.error:Paris.noop;var i=y[e];if(!i||!i.webrtcStuff)return void Paris.warn("Invalid handle, not sending anything");var a=i.webrtcStuff;if(Paris.log("Sending offer/answer SDP..."),!a.mySdp)return void Paris.warn("Local SDP instance is invalid, not sending anything...");a.mySdp={type:a.pc.localDescription.type,sdp:a.pc.localDescription.sdp},!1===a.trickle&&(a.mySdp.trickle=!1);Paris.debug(r),a.sdpSent=!0,r.success(a.mySdp)}(e,a);else{var i={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===t.trickle&&x(e,i)}},t.pc.ontrack=function(e){if(Paris.log("Handling Remote Track"),Paris.debug(e),e.streams&&(t.remoteStream=e.streams[0],o.onremotestream(t.remoteStream),!e.track.onended)){if(t.receiverTransforms){var r=null;RTCRtpSender.prototype.createEncodedStreams?r=e.receiver.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===e.track.kind&&t.receiverTransforms.audio?r=e.receiver.createEncodedAudioStreams():"video"===e.track.kind&&t.receiverTransforms.video&&(r=e.receiver.createEncodedVideoStreams())),r&&(r.readableStream&&r.writableStream?r.readableStream.pipeThrough(t.receiverTransforms[e.track.kind]).pipeTo(r.writableStream):r.readable&&r.writable&&r.readable.pipeThrough(t.receiverTransforms[e.track.kind]).pipeTo(r.writable))}var i=null;Paris.log("Adding onended callback to track:",e.track),e.track.onended=function(e){Paris.log("Remote track removed:",e),t.remoteStream&&(clearTimeout(i),t.remoteStream.removeTrack(e.target),o.onremotestream(t.remoteStream))},e.track.onmute=function(e){Paris.log("Remote track muted:",e),t.remoteStream&&null==i&&(i=setTimeout((function(){Paris.log("Removing remote track","config",t),t.remoteStream&&(t.remoteStream.removeTrack(e.target),o.onremotestream(t.remoteStream)),i=null}),2520))},e.track.onunmute=function(e){if(Paris.log("Remote track flowing again:",e),null!=i)clearTimeout(i),i=null;else try{t.remoteStream.addTrack(e.target),o.onremotestream(t.remoteStream)}catch(e){Paris.error(e)}}}}}if(s&&n){Paris.log("Adding local stream");var S=!0===a.simulcast2;n.getTracks().forEach((function(e){Paris.log("Adding local track:",e);var r=null;if(S&&"audio"!==e.kind){Paris.log("Enabling rid-based simulcasting:",e);var i=h(a.simulcastMaxBitrates),o=t.pc.addTransceiver(e,{direction:"sendrecv",streams:[n],sendEncodings:a.sendEncodings||[{rid:"h",active:!0,maxBitrate:i.high},{rid:"m",active:!0,maxBitrate:i.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:i.low,scaleResolutionDownBy:4}]});o&&(r=o.sender)}else r=t.pc.addTrack(e,n);if(r&&t.senderTransforms){var s=null;RTCRtpSender.prototype.createEncodedStreams?s=r.createEncodedStreams():(RTCRtpSender.prototype.createAudioEncodedStreams||RTCRtpSender.prototype.createEncodedVideoStreams)&&("audio"===r.track.kind&&t.senderTransforms.audio?s=r.createEncodedAudioStreams():"video"===r.track.kind&&t.senderTransforms.video&&(s=r.createEncodedVideoStreams())),s&&(s.readableStream&&s.writableStream?s.readableStream.pipeThrough(t.senderTransforms[r.track.kind]).pipeTo(s.writableStream):s.readable&&s.writable&&s.readable.pipeThrough(t.senderTransforms[r.track.kind]).pipeTo(s.writable))}}))}(function(e){if(Paris.debug("isDataEnabled:",e),"edge"===Paris.webRTCAdapter.browserDetails.browser)return Paris.warn("Edge doesn't support data channels yet"),!1;return null!=e&&!0===e.data})(i)&&!t.dataChannel[Paris.dataChanDefaultLabel]&&(Paris.log("Creating default data channel"),M(e,Paris.dataChanDefaultLabel,null,!1),t.pc.ondatachannel=function(r){Paris.log("Data channel created by Paris:",r),M(e,r.channel.label,r.channel.protocol,r.channel)}),t.myStream&&o.onlocalstream(t.myStream),r?t.pc.setRemoteDescription(r).then((function(){if(Paris.log("Remote description accepted!"),t.remoteSdp=r.sdp,t.candidates&&t.candidates.length>0){for(var n=0;n<t.candidates.length;n++){var o=t.candidates[n];Paris.debug("Adding remote candidate:",o),o&&!0!==o.completed?t.pc.addIceCandidate(o):t.pc.addIceCandidate(Paris.endOfCandidates)}t.candidates=[]}!function(e,r,i){i=i||{},i.success="function"==typeof i.success?i.success:Paris.noop,i.error="function"==typeof i.error?i.error:Paris.noop,i.customizeSdp="function"==typeof i.customizeSdp?i.customizeSdp:Paris.noop;var a=y[e];if(!a||!a.webrtcStuff)return Paris.warn("Invalid handle"),void i.error("Invalid handle");var n=a.webrtcStuff,o=!0===i.simulcast;o?Paris.log("Creating answer (iceDone="+n.iceDone+", simulcast="+o+")"):Paris.log("Creating answer (iceDone="+n.iceDone+")");var t=null;if(Paris.unifiedPlan){t={};var s=null,d=null,c=n.pc.getTransceivers();if(c&&c.length>0)for(var l of c)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(d||(d=l));var u=z(r),f=q(r);if(u||f){if(u&&f){if(s)try{s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",Paris.log("Setting audio transceiver to sendrecv:",s)}catch(e){Paris.error(e)}}else if(u&&!f)try{s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",Paris.log("Setting audio transceiver to sendonly:",s))}catch(e){Paris.error(e)}else if(!u&&f)if(s)try{s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",Paris.log("Setting audio transceiver to recvonly:",s)}catch(e){Paris.error(e)}else s=n.pc.addTransceiver("audio",{direction:"recvonly"}),Paris.log("Adding recvonly audio transceiver:",s)}else if(r.removeAudio&&s)try{s.setDirection?s.setDirection("inactive"):s.direction="inactive",Paris.log("Setting audio transceiver to inactive:",s)}catch(e){Paris.error(e)}var v=H(r),p=Q(r);if(v||p){if(v&&p){if(d)try{d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",Paris.log("Setting video transceiver to sendrecv:",d)}catch(e){Paris.error(e)}}else if(v&&!p){if(d)try{d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",Paris.log("Setting video transceiver to sendonly:",d)}catch(e){Paris.error(e)}}else if(!v&&p)if(d)try{d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",Paris.log("Setting video transceiver to recvonly:",d)}catch(e){Paris.error(e)}else d=n.pc.addTransceiver("video",{direction:"recvonly"}),Paris.log("Adding recvonly video transceiver:",d)}else if(r.removeVideo&&d)try{d.setDirection?d.setDirection("inactive"):d.direction="inactive",Paris.log("Setting video transceiver to inactive:",d)}catch(e){Paris.error(e)}}else t="firefox"===Paris.webRTCAdapter.browserDetails.browser||"edge"===Paris.webRTCAdapter.browserDetails.browser?{offerToReceiveAudio:q(r),offerToReceiveVideo:Q(r)}:{mandatory:{OfferToReceiveAudio:q(r),OfferToReceiveVideo:Q(r)}};Paris.debug(t);var g=H(r);if(g&&o&&"firefox"===Paris.webRTCAdapter.browserDetails.browser){Paris.log("Enabling Simulcasting for Firefox (RID)");var m=n.pc.getSenders()[1];Paris.log(m);var P=m.getParameters();Paris.log(P);var b=h(i.simulcastMaxBitrates);m.setParameters({encodings:i.sendEncodings||[{rid:"h",active:!0,maxBitrate:b.high},{rid:"m",active:!0,maxBitrate:b.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:b.low,scaleResolutionDownBy:4}]})}n.pc.createAnswer(t).then((function(e){Paris.debug(e);var r={type:e.type,sdp:e.sdp};i.customizeSdp(r),e.sdp=r.sdp,Paris.log("Setting local description"),g&&o&&("chrome"===Paris.webRTCAdapter.browserDetails.browser?Paris.warn("simulcast=true, but this is an answer, and video breaks in Chrome if we enable it"):"firefox"!==Paris.webRTCAdapter.browserDetails.browser&&Paris.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),n.mySdp={type:"answer",sdp:e.sdp},n.pc.setLocalDescription(e).catch(i.error),n.mediaConstraints=t,n.iceDone||n.trickle?((n.senderTransforms||n.receiverTransforms)&&(e.e2ee=!0),i.success(e)):Paris.log("Waiting for all candidates...")}),i.error)}(e,i,a)}),a.error):function(e,r,i){i=i||{},i.success="function"==typeof i.success?i.success:Paris.noop,i.error="function"==typeof i.error?i.error:Paris.noop,i.customizeSdp="function"==typeof i.customizeSdp?i.customizeSdp:Paris.noop;var a=y[e];if(!a||!a.webrtcStuff)return Paris.warn("Invalid handle"),void i.error("Invalid handle");var n=a.webrtcStuff,o=!0===i.simulcast;o?Paris.log("Creating offer (iceDone="+n.iceDone+", simulcast="+o+")"):Paris.log("Creating offer (iceDone="+n.iceDone+")");var t={};if(Paris.unifiedPlan){var s=null,d=null,c=n.pc.getTransceivers();if(c&&c.length>0)for(var l of c)l.sender&&l.sender.track&&"audio"===l.sender.track.kind||l.receiver&&l.receiver.track&&"audio"===l.receiver.track.kind?s||(s=l):(l.sender&&l.sender.track&&"video"===l.sender.track.kind||l.receiver&&l.receiver.track&&"video"===l.receiver.track.kind)&&(d||(d=l));var u=z(r),f=q(r);u||f?u&&f?s&&(s.setDirection?s.setDirection("sendrecv"):s.direction="sendrecv",Paris.log("Setting audio transceiver to sendrecv:",s)):u&&!f?s&&(s.setDirection?s.setDirection("sendonly"):s.direction="sendonly",Paris.log("Setting audio transceiver to sendonly:",s)):!u&&f&&(s?(s.setDirection?s.setDirection("recvonly"):s.direction="recvonly",Paris.log("Setting audio transceiver to recvonly:",s)):(s=n.pc.addTransceiver("audio",{direction:"recvonly"}),Paris.log("Adding recvonly audio transceiver:",s))):r.removeAudio&&s&&(s.setDirection?s.setDirection("inactive"):s.direction="inactive",Paris.log("Setting audio transceiver to inactive:",s));var v=H(r),p=Q(r);v||p?v&&p?d&&(d.setDirection?d.setDirection("sendrecv"):d.direction="sendrecv",Paris.log("Setting video transceiver to sendrecv:",d)):v&&!p?d&&(d.setDirection?d.setDirection("sendonly"):d.direction="sendonly",Paris.log("Setting video transceiver to sendonly:",d)):!v&&p&&(d?(d.setDirection?d.setDirection("recvonly"):d.direction="recvonly",Paris.log("Setting video transceiver to recvonly:",d)):(d=n.pc.addTransceiver("video",{direction:"recvonly"}),Paris.log("Adding recvonly video transceiver:",d))):r.removeVideo&&d&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive",Paris.log("Setting video transceiver to inactive:",d))}else t.offerToReceiveAudio=q(r),t.offerToReceiveVideo=Q(r);var g=!0===i.iceRestart;g&&(t.iceRestart=!0);Paris.debug(t);var m=H(r);if(m&&o&&"firefox"===Paris.webRTCAdapter.browserDetails.browser){Paris.log("Enabling Simulcasting for Firefox (RID)");var P=n.pc.getSenders().find((function(e){return e.track&&"video"===e.track.kind}));if(P){var b=P.getParameters();b||(b={});var S=h(i.simulcastMaxBitrates);b.encodings=i.sendEncodings||[{rid:"h",active:!0,maxBitrate:S.high},{rid:"m",active:!0,maxBitrate:S.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:S.low,scaleResolutionDownBy:4}],P.setParameters(b)}}n.pc.createOffer(t).then((function(e){Paris.debug(e);var r={type:e.type,sdp:e.sdp};i.customizeSdp(r),e.sdp=r.sdp,Paris.log("Setting local description"),m&&o&&("chrome"===Paris.webRTCAdapter.browserDetails.browser||"safari"===Paris.webRTCAdapter.browserDetails.browser?(Paris.log("Enabling Simulcasting for Chrome (SDP munging)"),e.sdp=function(e){for(var r=e.split("\r\n"),i=!1,a=[-1],n=[-1],o=null,t=null,s=null,d=null,c=-1,l=0;l<r.length;l++){if(f=r[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(a[0]<0)){c=l;break}i=!0}else if(a[0]>-1){c=l;break}}else if(i){if(r[l].match(/a=ssrc-group:SIM (\d+) (\d+) (\d+)/))return Paris.warn("The SDP already contains a SIM attribute, munging will be skipped"),e;var u=r[l].match(/a=ssrc-group:FID (\d+) (\d+)/);if(u)a[0]=u[1],n[0]=u[2],r.splice(l,1),l--;else{if(a[0]){if((p=r[l].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=p[1]),(p=r[l].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(t=p[1]),(p=r[l].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=p[1]),(p=r[l].match("a=ssrc:"+a[0]+" label:(.+)"))&&(d=p[1]),0===r[l].indexOf("a=ssrc:"+n[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+a[0])){r.splice(l,1),l--;continue}}0!=r[l].length||(r.splice(l,1),l--)}}}if(a[0]<0){c=-1,i=!1;for(l=0;l<r.length;l++){var f;if(f=r[l].match(/m=(\w+) */)){if("video"===f[1]){if(!(a[0]<0)){c=l;break}i=!0}else if(a[0]>-1){c=l;break}}else if(i){if(a[0]<0){var v=r[l].match(/a=ssrc:(\d+)/);if(v){a[0]=v[1],r.splice(l,1),l--;continue}}else{var p;if((p=r[l].match("a=ssrc:"+a[0]+" cname:(.+)"))&&(o=p[1]),(p=r[l].match("a=ssrc:"+a[0]+" msid:(.+)"))&&(t=p[1]),(p=r[l].match("a=ssrc:"+a[0]+" mslabel:(.+)"))&&(s=p[1]),(p=r[l].match("a=ssrc:"+a[0]+" label:(.+)"))&&(d=p[1]),0===r[l].indexOf("a=ssrc:"+n[0])){r.splice(l,1),l--;continue}if(0===r[l].indexOf("a=ssrc:"+a[0])){r.splice(l,1),l--;continue}}0!==r[l].length||(r.splice(l,1),l--)}}}if(a[0]<0)return Paris.warn("Couldn't find the video SSRC, simulcasting NOT enabled"),e;c<0&&(c=r.length);a[1]=Math.floor(4294967295*Math.random()),a[2]=Math.floor(4294967295*Math.random()),n[1]=Math.floor(4294967295*Math.random()),n[2]=Math.floor(4294967295*Math.random());for(l=0;l<a.length;l++)o&&(r.splice(c,0,"a=ssrc:"+a[l]+" cname:"+o),c++),t&&(r.splice(c,0,"a=ssrc:"+a[l]+" msid:"+t),c++),s&&(r.splice(c,0,"a=ssrc:"+a[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+a[l]+" label:"+d),c++),o&&(r.splice(c,0,"a=ssrc:"+n[l]+" cname:"+o),c++),t&&(r.splice(c,0,"a=ssrc:"+n[l]+" msid:"+t),c++),s&&(r.splice(c,0,"a=ssrc:"+n[l]+" mslabel:"+s),c++),d&&(r.splice(c,0,"a=ssrc:"+n[l]+" label:"+d),c++);r.splice(c,0,"a=ssrc-group:FID "+a[2]+" "+n[2]),r.splice(c,0,"a=ssrc-group:FID "+a[1]+" "+n[1]),r.splice(c,0,"a=ssrc-group:FID "+a[0]+" "+n[0]),r.splice(c,0,"a=ssrc-group:SIM "+a[0]+" "+a[1]+" "+a[2]),(e=r.join("\r\n")).endsWith("\r\n")||(e+="\r\n");return e}(e.sdp)):"firefox"!==Paris.webRTCAdapter.browserDetails.browser&&Paris.warn("simulcast=true, but this is not Chrome nor Firefox, ignoring")),n.mySdp={type:"offer",sdp:e.sdp},n.pc.setLocalDescription(e).catch(i.error),n.mediaConstraints=t,n.iceDone||n.trickle?((n.senderTransforms||n.receiverTransforms)&&(e.e2ee=!0),i.success(e)):Paris.log("Waiting for all candidates...")}),i.error)}(e,i,a)}function F(e,r,i){(i=i||{}).success="function"==typeof i.success?i.success:Paris.noop,i.error="function"==typeof i.error?i.error:J;var a=i.jsep;if(r&&a)return Paris.error("Provided a JSEP to a createOffer"),void i.error("Provided a JSEP to a createOffer");if(!(r||a&&a.type&&a.sdp))return Paris.error("A valid JSEP is required for createAnswer"),void i.error("A valid JSEP is required for createAnswer");i.media="object"==typeof i.media&&i.media?i.media:{audio:!0,video:!0};var n=i.media,o=y[e];if(!o||!o.webrtcStuff)return Paris.warn("Invalid handle"),void i.error("Invalid handle");var t,s=o.webrtcStuff;if(s.trickle=(t=i.trickle,Paris.debug("isTrickleEnabled:",t),!1!==t),s.pc){if(Paris.log("Updating existing media session"),n.update=!0,i.stream)i.stream!==s.myStream&&Paris.log("Renegotiation involves a new external stream");else{if(n.addAudio){if(n.keepAudio=!1,n.replaceAudio=!1,n.removeAudio=!1,n.audioSend=!0,s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length)return Paris.error("Can't add audio stream, there already is one"),void i.error("Can't add audio stream, there already is one")}else n.removeAudio?(n.keepAudio=!1,n.replaceAudio=!1,n.addAudio=!1,n.audioSend=!1):n.replaceAudio&&(n.keepAudio=!1,n.addAudio=!1,n.removeAudio=!1,n.audioSend=!0);if(s.myStream&&s.myStream.getAudioTracks()&&0!==s.myStream.getAudioTracks().length?!z(n)||n.removeAudio||n.replaceAudio||(n.keepAudio=!0):(n.replaceAudio&&(n.keepAudio=!1,n.replaceAudio=!1,n.addAudio=!0,n.audioSend=!0),z(n)&&(n.keepAudio=!1,n.addAudio=!0)),n.addVideo){if(n.keepVideo=!1,n.replaceVideo=!1,n.removeVideo=!1,n.videoSend=!0,s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length)return Paris.error("Can't add video stream, there already is one"),void i.error("Can't add video stream, there already is one")}else n.removeVideo?(n.keepVideo=!1,n.replaceVideo=!1,n.addVideo=!1,n.videoSend=!1):n.replaceVideo&&(n.keepVideo=!1,n.addVideo=!1,n.removeVideo=!1,n.videoSend=!0);s.myStream&&s.myStream.getVideoTracks()&&0!==s.myStream.getVideoTracks().length?!H(n)||n.removeVideo||n.replaceVideo||(n.keepVideo=!0):(n.replaceVideo&&(n.keepVideo=!1,n.replaceVideo=!1,n.addVideo=!0,n.videoSend=!0),H(n)&&(n.keepVideo=!1,n.addVideo=!0)),n.addData&&(n.data=!0)}if(z(n)&&n.keepAudio&&H(n)&&n.keepVideo)return o.consentDialog(!1),void N(e,a,n,i,s.myStream)}else n.update=!1,n.keepAudio=!1,n.keepVideo=!1;if(n.update&&(!s.streamExternal||s.streamExternal&&(n.replaceAudio||n.replaceVideo))){if(n.removeAudio||n.replaceAudio){if(s.myStream&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){var d=s.myStream.getAudioTracks()[0];Paris.log("Removing audio track:",d),s.myStream.removeTrack(d);try{d.stop()}catch(R){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var c=!0;if(n.replaceAudio&&Paris.unifiedPlan&&(c=!1),c)for(var l of s.pc.getSenders())l&&l.track&&"audio"===l.track.kind&&(Paris.log("Removing audio sender:",l),s.pc.removeTrack(l))}}if(n.removeVideo||n.replaceVideo){if(s.myStream&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){var u=s.myStream.getVideoTracks()[0];Paris.log("Removing video track:",u),s.myStream.removeTrack(u);try{u.stop()}catch(I){}}if(s.pc.getSenders()&&s.pc.getSenders().length){var f=!0;if(n.replaceVideo&&Paris.unifiedPlan&&(f=!1),f)for(var v of s.pc.getSenders())v&&v.track&&"video"===v.track.kind&&(Paris.log("Removing video sender:",v),s.pc.removeTrack(v))}}}if(i.stream){var p=i.stream;return Paris.log("MediaStream provided by the application"),Paris.debug(p),!n.update||!s.myStream||s.myStream===i.stream||s.streamExternal||n.replaceAudio||n.replaceVideo||(Paris.stopAllTracks(s.myStream),s.myStream=null),s.streamExternal=!0,o.consentDialog(!1),void N(e,a,n,i,p)}if(z(n)||H(n)){if(!Paris.isGetUserMediaAvailable())return void i.error("getUserMedia not available");var g={mandatory:{},optional:[]};o.consentDialog(!0);var m=z(n);m&&n&&"object"==typeof n.audio&&(m=n.audio);var P=H(n);if(P&&n){var b=!0===i.simulcast,h=!0===i.simulcast2;if(!b&&!h||a||n.video||(n.video="hires"),n.video&&"screen"!=n.video&&"window"!=n.video)if("object"==typeof n.video)P=n.video;else{var S=0,w=0;"lowres"===n.video?(w=240,S=320):"lowres-16:9"===n.video?(w=180,S=320):"hires"===n.video||"hires-16:9"===n.video||"hdres"===n.video?(w=720,S=1280):"fhdres"===n.video?(w=1080,S=1920):"4kres"===n.video?(w=2160,S=3840):"stdres"===n.video?(w=480,S=640):"stdres-16:9"===n.video?(w=360,S=640):(Paris.log("Default video setting is stdres 4:3"),w=480,S=640),Paris.log("Adding media constraint:",n.video),P={height:{ideal:w},width:{ideal:S}},Paris.log("Adding video constraint:",P)}else if("screen"===n.video||"window"===n.video){if(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)return g.video={},n.screenshareFrameRate&&(g.video.frameRate=n.screenshareFrameRate),n.screenshareHeight&&(g.video.height=n.screenshareHeight),n.screenshareWidth&&(g.video.width=n.screenshareWidth),g.audio=n.captureDesktopAudio,void navigator.mediaDevices.getDisplayMedia(g).then((function(r){o.consentDialog(!1),z(n)&&!n.keepAudio?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(o){r.addTrack(o.getAudioTracks()[0]),N(e,a,n,i,r)})):N(e,a,n,i,r)}),(function(e){o.consentDialog(!1),i.error(e)}));function k(r,t){o.consentDialog(!1),r?i.error(r):N(e,a,n,i,t)}function T(e,r,i){Paris.log("Adding media constraint (screen capture)"),Paris.debug(e),navigator.mediaDevices.getUserMedia(e).then((function(e){i?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(i){e.addTrack(i.getAudioTracks()[0]),r(null,e)})):r(null,e)})).catch((function(e){o.consentDialog(!1),r(e)}))}if("chrome"===Paris.webRTCAdapter.browserDetails.browser){var C=Paris.webRTCAdapter.browserDetails.version,A=33;window.navigator.userAgent.match("Linux")&&(A=35),C>=26&&C<=A?T(g={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:n.screenshareFrameRate,maxFrameRate:n.screenshareFrameRate,chromeMediaSource:"screen"}},audio:z(n)&&!n.keepAudio},k):Paris.extension.getScreen((function(e,r){if(e)return o.consentDialog(!1),i.error(e);(g={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,minFrameRate:n.screenshareFrameRate,maxFrameRate:n.screenshareFrameRate},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}}).video.mandatory.chromeMediaSourceId=r,T(g,k,z(n)&&!n.keepAudio)}))}else if("firefox"===Paris.webRTCAdapter.browserDetails.browser){if(!(Paris.webRTCAdapter.browserDetails.version>=33)){var D=new Error("NavigatorUserMediaError");return D.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",o.consentDialog(!1),void i.error(D)}T(g={video:{mozMediaSource:n.video,mediaSource:n.video},audio:z(n)&&!n.keepAudio},(function(e,r){if(k(e,r),!e)var i=r.currentTime,a=window.setInterval((function(){r||window.clearInterval(a),r.currentTime==i&&(window.clearInterval(a),r.onended&&r.onended()),i=r.currentTime}),500)}))}return}}n&&"screen"===n.video||navigator.mediaDevices.enumerateDevices().then((function(r){var t=r.some((function(e){return"audioinput"===e.kind})),s=function(e){if(Paris.debug("isScreenSendEnabled:",e),!e)return!1;if("object"!=typeof e.video||"object"!=typeof e.video.mandatory)return!1;var r=e.video.mandatory;if(r.chromeMediaSource)return"desktop"===r.chromeMediaSource||"screen"===r.chromeMediaSource;if(r.mozMediaSource)return"window"===r.mozMediaSource||"screen"===r.mozMediaSource;if(r.mediaSource)return"window"===r.mediaSource||"screen"===r.mediaSource;return!1}(n)||r.some((function(e){return"videoinput"===e.kind})),d=z(n),c=H(n),l=function(e){return Paris.debug("isAudioSendRequired:",e),!!e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}(n),u=function(e){return Paris.debug("isVideoSendRequired:",e),!!e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}(n);if(d||c||l||u){var f=!!d&&t,v=!!c&&s;if(!f&&!v)return o.consentDialog(!1),i.error("No capture device found"),!1;if(!f&&l)return o.consentDialog(!1),i.error("Audio capture is required, but no capture device found"),!1;if(!v&&u)return o.consentDialog(!1),i.error("Video capture is required, but no capture device found"),!1}var g={audio:!(!t||n.keepAudio)&&m,video:!(!s||n.keepVideo)&&P};Paris.debug("getUserMedia constraints",g),g.audio||g.video?navigator.mediaDevices.getUserMedia(g).then((function(r){o.consentDialog(!1),N(e,a,n,i,r)})).catch((function(e){o.consentDialog(!1),i.error({code:e.code,name:e.name,message:e.message})})):(o.consentDialog(!1),N(e,a,n,i,p))})).catch((function(e){o.consentDialog(!1),i.error(e)}))}else N(e,a,n,i)}function _(e,r){(r=r||{}).success="function"==typeof r.success?r.success:Paris.noop,r.error="function"==typeof r.error?r.error:J,r.customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:Paris.noop;var i=r.jsep,a=y[e];if(!a||!a.webrtcStuff)return Paris.warn("Invalid handle"),void r.error("Invalid handle");var n=a.webrtcStuff;if(i){if(!n.pc)return Paris.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void r.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");r.customizeSdp(i),n.pc.setRemoteDescription(i).then((function(){if(Paris.log("Remote description accepted!"),n.remoteSdp=i.sdp,n.candidates&&n.candidates.length>0){for(var e=0;e<n.candidates.length;e++){var a=n.candidates[e];Paris.debug("Adding remote candidate:",a),a&&!0!==a.completed?n.pc.addIceCandidate(a):n.pc.addIceCandidate(Paris.endOfCandidates)}n.candidates=[]}r.success()}),r.error)}else r.error("Invalid JSEP")}function U(e,r){var i=y[e];if(!i||!i.webrtcStuff)return Paris.warn("Invalid handle"),0;var a=r?"remote":"local",n=i.webrtcStuff;return n.volume[a]||(n.volume[a]={value:0}),!n.pc.getStats||"chrome"!==Paris.webRTCAdapter.browserDetails.browser&&"safari"!==Paris.webRTCAdapter.browserDetails.browser?(Paris.warn("Getting the "+a+" volume unsupported by browser"),0):r&&!n.remoteStream?(Paris.warn("Remote stream unavailable"),0):r||n.myStream?n.volume[a].timer?n.volume[a].value:(Paris.log("Starting "+a+" volume monitor"),n.volume[a].timer=setInterval((function(){n.pc.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||(n.volume[a].value=e.audioLevel?e.audioLevel:0))}))}))}),200),0):(Paris.warn("Local stream unavailable"),0)}function j(e,r){var i=y[e];if(!i||!i.webrtcStuff)return Paris.warn("Invalid handle"),!0;var a=i.webrtcStuff;return a.pc?a.myStream?r?a.myStream.getVideoTracks()&&0!==a.myStream.getVideoTracks().length?!a.myStream.getVideoTracks()[0].enabled:(Paris.warn("No video track"),!0):a.myStream.getAudioTracks()&&0!==a.myStream.getAudioTracks().length?!a.myStream.getAudioTracks()[0].enabled:(Paris.warn("No audio track"),!0):(Paris.warn("Invalid local MediaStream"),!0):(Paris.warn("Invalid PeerConnection"),!0)}function W(e,r,i){var a=y[e];if(!a||!a.webrtcStuff)return Paris.warn("Invalid handle"),!1;var n=a.webrtcStuff;return n.pc?n.myStream?r?n.myStream.getVideoTracks()&&0!==n.myStream.getVideoTracks().length?(n.myStream.getVideoTracks()[0].enabled=!i,!0):(Paris.warn("No video track"),!1):n.myStream.getAudioTracks()&&0!==n.myStream.getAudioTracks().length?(n.myStream.getAudioTracks()[0].enabled=!i,!0):(Paris.warn("No audio track"),!1):(Paris.warn("Invalid local MediaStream"),!1):(Paris.warn("Invalid PeerConnection"),!1)}function B(e){var r=y[e];if(!r||!r.webrtcStuff)return Paris.warn("Invalid handle"),"Invalid handle";var i=r.webrtcStuff;return i.pc?i.pc.getStats?i.bitrate.timer?i.bitrate.value:(Paris.log("Starting bitrate timer (via getStats)"),i.bitrate.timer=setInterval((function(){i.pc.getStats().then((function(e){e.forEach((function(e){if(e){var r=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?r=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(r=!0),r)if(i.bitrate.bsnow=e.bytesReceived,i.bitrate.tsnow=e.timestamp,null===i.bitrate.bsbefore||null===i.bitrate.tsbefore)i.bitrate.bsbefore=i.bitrate.bsnow,i.bitrate.tsbefore=i.bitrate.tsnow;else{var a=i.bitrate.tsnow-i.bitrate.tsbefore;"safari"===Paris.webRTCAdapter.browserDetails.browser&&(a/=1e3);var n=Math.round(8*(i.bitrate.bsnow-i.bitrate.bsbefore)/a);"safari"===Paris.webRTCAdapter.browserDetails.browser&&(n=parseInt(n/1e3)),i.bitrate.value=n+" kbits/sec",i.bitrate.bsbefore=i.bitrate.bsnow,i.bitrate.tsbefore=i.bitrate.tsnow}}}))}))}),1e3),"0 kbits/sec"):(Paris.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"):"Invalid PeerConnection"}function J(e){Paris.error("WebRTC error:",e)}function G(e,n){Paris.log("Cleaning WebRTC stuff");var o=y[e];if(o){var t=o.webrtcStuff;if(t){if(!0===n){var s={transaction:Paris.randomString(12)};s[r]="hangup",o.token&&(s.token=o.token),m&&(s.apisecret=m),Paris.debug("Sending hangup request (handle="+e+"):"),Paris.debug(s),i?(s.session_id=w,s.handle_id=e,a.send(JSON.stringify(s))):Paris.httpAPICall(d+"/"+w+"/"+e,{verb:"POST",withCredentials:v,body:s})}t.remoteStream=null,t.volume&&(t.volume.local&&t.volume.local.timer&&clearInterval(t.volume.local.timer),t.volume.remote&&t.volume.remote.timer&&clearInterval(t.volume.remote.timer)),t.volume={},t.bitrate.timer&&clearInterval(t.bitrate.timer),t.bitrate.timer=null,t.bitrate.bsnow=null,t.bitrate.bsbefore=null,t.bitrate.tsnow=null,t.bitrate.tsbefore=null,t.bitrate.value=null,!t.streamExternal&&t.myStream&&(Paris.log("Stopping local stream tracks"),Paris.stopAllTracks(t.myStream)),t.streamExternal=!1,t.myStream=null;try{t.pc.close()}catch(e){}t.pc=null,t.candidates=null,t.mySdp=null,t.remoteSdp=null,t.iceDone=!1,t.dataChannel={},t.dtmfSender=null,t.senderTransforms=null,t.receiverTransforms=null}o.oncleanup()}}function z(e){return Paris.debug("isAudioSendEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function q(e){return Paris.debug("isAudioRecvEnabled:",e),!e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function H(e){return Paris.debug("isVideoSendEnabled:",e),!e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function Q(e){return Paris.debug("isVideoRecvEnabled:",e),!e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}I(e),this.getServer=function(){return d},this.isConnected=function(){return S},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:Paris.noop,e.error="function"==typeof e.error?e.error:Paris.noop,e.reconnect=!0,I(e)},this.getSessionId=function(){return w},this.getInfo=function(e){!function(e){if(e=e||{},e.success="function"==typeof e.success?e.success:Paris.noop,e.error="function"==typeof e.error?e.error:Paris.noop,Paris.log("Getting info on Paris instance"),!S)return Paris.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=Paris.randomString(12),o={transaction:n};o[r]="info",g&&(o.token=g);m&&(o.apisecret=m);if(i)return C[n]=function(i){Paris.log("Server info:"),Paris.debug(i),"server_info"!==i[r]&&Paris.error("Ooops: "+i.error.code+" "+i.error.reason),e.success(i)},void a.send(JSON.stringify(o));Paris.httpAPICall(d,{verb:"POST",withCredentials:v,body:o,success:function(i){Paris.log("Server info:"),Paris.debug(i),"server_info"!==i[r]&&Paris.error("Ooops: "+i.error.code+" "+i.error.reason),e.success(i)},error:function(r,i){Paris.error(r+":",i),""===i?e.error(r+": Is the server down?"):e.error(r+": "+i)}})}(e)},this.destroy=function(t){!function(t){t=t||{},t.success="function"==typeof t.success?t.success:Paris.noop,t.error="function"==typeof t.error?t.error:Paris.noop;var s=!0===t.unload,c=!0;void 0!==t.notifyDestroyed&&null!==t.notifyDestroyed&&(c=!0===t.notifyDestroyed);var l=!0===t.cleanupHandles;if(Paris.log("Destroying session "+w+" (unload="+s+")"),!w)return Paris.warn("No session to destroy"),t.success(),void(c&&e.destroyed());if(l)for(var u in y)L(u,{noRequest:!0});if(!S)return Paris.warn("Is the server down? (connected=false)"),w=null,void t.success();var f={transaction:Paris.randomString(12)};f[r]="destroy",g&&(f.token=g);m&&(f.apisecret=m);if(s)return i?(a.onclose=null,a.close(),a=null):navigator.sendBeacon(d+"/"+w,JSON.stringify(f)),Paris.log("Destroyed session:"),w=null,S=!1,t.success(),void(c&&e.destroyed());if(i){f.session_id=w;var p=function(){for(var e in n)a.removeEventListener(e,n[e]);a.removeEventListener("message",P),a.removeEventListener("error",b),o&&clearTimeout(o),a.close()},P=function(r){var i=JSON.parse(r.data);i.session_id==f.session_id&&i.transaction==f.transaction&&(p(),t.success(),c&&e.destroyed())},b=function(r){p(),t.error("Failed to destroy the server: Is the server down?"),c&&e.destroyed()};return a.addEventListener("message",P),a.addEventListener("error",b),void(1===a.readyState?a.send(JSON.stringify(f)):b())}Paris.httpAPICall(d+"/"+w,{verb:"POST",withCredentials:v,body:f,success:function(i){Paris.log("Destroyed session:"),Paris.debug(i),w=null,S=!1,"success"!==i[r]&&Paris.error("Ooops: "+i.error.code+" "+i.error.reason),t.success(),c&&e.destroyed()},error:function(r,i){Paris.error(r+":",i),w=null,S=!1,t.success(),c&&e.destroyed()}})}(t)},this.attach=function(e){!function(e){if(e=e||{},e.success="function"==typeof e.success?e.success:Paris.noop,e.error="function"==typeof e.error?e.error:Paris.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:Paris.noop,e.iceState="function"==typeof e.iceState?e.iceState:Paris.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:Paris.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:Paris.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:Paris.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:Paris.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:Paris.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:Paris.noop,e.ondata="function"==typeof e.ondata?e.ondata:Paris.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:Paris.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:Paris.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:Paris.noop,!S)return Paris.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return Paris.error("Invalid plugin"),void e.error("Invalid plugin");var o=e.opaqueId,t=e.loopIndex,s=e.token?e.token:g,c=Paris.randomString(12),l={plugin:n,opaque_id:o,loop_index:t,transaction:c};l[r]="attach",s&&(l.token=s);m&&(l.apisecret=m);if(i)return C[c]=function(i){if(Paris.debug(i),"success"!==i[r])return Paris.error("Ooops: "+i.error.code+" "+i.error.reason),void e.error("Ooops: "+i.error.code+" "+i.error.reason);var a=i.data.id;Paris.log("Created handle: "+a);var o={session:k,plugin:n,id:a,token:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return n},getVolume:function(){return U(a,!0)},getRemoteVolume:function(){return U(a,!0)},getLocalVolume:function(){return U(a,!1)},isAudioMuted:function(){return j(a,!1)},muteAudio:function(){return W(a,!1,!0)},unmuteAudio:function(){return W(a,!1,!1)},isVideoMuted:function(){return j(a,!0)},muteVideo:function(){return W(a,!0,!0)},unmuteVideo:function(){return W(a,!0,!1)},getBitrate:function(){return B(a)},send:function(e){V(a,e)},data:function(e){E(a,e)},dtmf:function(e){O(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){F(a,!0,e)},createAnswer:function(e){F(a,!1,e)},handleRemoteJsep:function(e){_(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(a,!0===e)},detach:function(e){L(a,e)}};y[a]=o,e.success(o)},l.session_id=w,void a.send(JSON.stringify(l));Paris.httpAPICall(d+"/"+w,{verb:"POST",withCredentials:v,body:l,success:function(i){if(Paris.debug(i),"success"!==i[r])return Paris.error("Ooops: "+i.error.code+" "+i.error.reason),void e.error("Ooops: "+i.error.code+" "+i.error.reason);var a=i.data.id;Paris.log("Created handle: "+a);var o={session:k,plugin:n,id:a,token:s,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,mediaConstraints:null,pc:null,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return a},getPlugin:function(){return n},getVolume:function(){return U(a,!0)},getRemoteVolume:function(){return U(a,!0)},getLocalVolume:function(){return U(a,!1)},isAudioMuted:function(){return j(a,!1)},muteAudio:function(){return W(a,!1,!0)},unmuteAudio:function(){return W(a,!1,!1)},isVideoMuted:function(){return j(a,!0)},muteVideo:function(){return W(a,!0,!0)},unmuteVideo:function(){return W(a,!0,!1)},getBitrate:function(){return B(a)},send:function(e){V(a,e)},data:function(e){E(a,e)},dtmf:function(e){O(a,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){F(a,!0,e)},createAnswer:function(e){F(a,!1,e)},handleRemoteJsep:function(e){_(a,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){G(a,!0===e)},detach:function(e){L(a,e)}};y[a]=o,e.success(o)},error:function(r,i){Paris.error(r+":",i),""===i?e.error(r+": Is the server down?"):e.error(r+": "+i)}})}(e)}}Paris.useDefaultDependencies=function(e){var r=e&&e.fetch||fetch,i=e&&e.Promise||Promise,a=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new a(e,r)},extension:e&&e.extension||defaultExtension,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,a){var n={method:a.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===a.verb&&(n.headers["Content-Type"]="application/json"),void 0!==a.withCredentials&&(n.credentials=!0===a.withCredentials?"include":a.withCredentials?a.withCredentials:"omit"),a.body&&(n.body=JSON.stringify(a.body));var o=r(e,n).catch((function(e){return i.reject({message:"Probably a network error, is the server down?",error:e})}));if(a.timeout){var t=new i((function(e,r){var i=setTimeout((function(){return clearTimeout(i),r({message:"Request timed out",timeout:a.timeout})}),a.timeout)}));o=i.race([o,t])}return o.then((function(e){return e.ok?typeof a.success==typeof Paris.noop?e.json().then((function(e){try{a.success(e)}catch(e){Paris.error("Unhandled httpAPICall success callback error",e)}}),(function(r){return i.reject({message:"Failed to parse response body",error:r,response:e})})):void 0:i.reject({message:"API call failed",response:e})})).catch((function(e){typeof a.error==typeof Paris.noop&&a.error(e.message||"<< internal error >>",e)})),o}}},Paris.useOldDependencies=function(e){var r=e&&e.jQuery||jQuery,i=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,r){return new i(e,r)},isArray:function(e){return r.isArray(e)},extension:e&&e.extension||defaultExtension,webRTCAdapter:e&&e.adapter||adapter,httpAPICall:function(e,i){var a=void 0!==i.body?{contentType:"application/json",data:JSON.stringify(i.body)}:{},n=void 0!==i.withCredentials?{xhrFields:{withCredentials:i.withCredentials}}:{};return r.ajax(r.extend(a,n,{url:e,type:i.verb,cache:!1,dataType:"json",async:i.async,timeout:i.timeout,success:function(e){typeof i.success==typeof Paris.noop&&i.success(e)},error:function(e,r,a){typeof i.error==typeof Paris.noop&&i.error(r,a)}}))}}},Paris.noop=function(){},Paris.dataChanDefaultLabel="ParisDataChannel",Paris.endOfCandidates=null,Paris.stopAllTracks=function(e){try{var r=e.getTracks();for(var i of r)Paris.log(i),i&&i.stop()}catch(e){}},Paris.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:Paris.noop,Paris.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),Paris.trace=Paris.noop,Paris.debug=Paris.noop,Paris.vdebug=Paris.noop,Paris.log=Paris.noop,Paris.warn=Paris.noop,Paris.error=Paris.noop,!0===e.debug||"all"===e.debug)Paris.trace=console.trace.bind(console),Paris.debug=console.debug.bind(console),Paris.vdebug=console.debug.bind(console),Paris.log=console.log.bind(console),Paris.warn=console.warn.bind(console),Paris.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var r of e.debug)switch(r){case"trace":Paris.trace=console.trace.bind(console);break;case"debug":Paris.debug=console.debug.bind(console);break;case"vdebug":Paris.vdebug=console.debug.bind(console);break;case"log":Paris.log=console.log.bind(console);break;case"warn":Paris.warn=console.warn.bind(console);break;case"error":Paris.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+r+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}Paris.log("Initializing library");var i=e.dependencies||Paris.useDefaultDependencies();Paris.isArray=i.isArray,Paris.webRTCAdapter=i.webRTCAdapter,Paris.httpAPICall=i.httpAPICall,Paris.newWebSocket=i.newWebSocket,Paris.extension=i.extension,Paris.extension.init(),Paris.listDevices=function(e,r){e="function"==typeof e?e:Paris.noop,null==r&&(r={audio:!0,video:!0}),Paris.isGetUserMediaAvailable()?navigator.mediaDevices.getUserMedia(r).then((function(r){navigator.mediaDevices.enumerateDevices().then((function(i){Paris.debug(i),e(i),Paris.stopAllTracks(r)}))})).catch((function(r){Paris.error(r),e([])})):(Paris.warn("navigator.mediaDevices unavailable"),e([]))},Paris.attachMediaStream=function(e,r){try{e.srcObject=r}catch(i){try{e.src=URL.createObjectURL(r)}catch(e){Paris.error("Error attaching stream to element")}}},Paris.reattachMediaStream=function(e,r){try{e.srcObject=r.srcObject}catch(i){try{e.src=r.src}catch(e){Paris.error("Error reattaching stream to element")}}};var a=["iPad","iPhone","iPod"].indexOf(navigator.platform)>=0?"pagehide":"beforeunload",n=window["on"+a];if(window.addEventListener(a,(function(e){for(var r in Paris.log("Closing window"),Paris.sessions)Paris.sessions[r]&&Paris.sessions[r].destroyOnUnload&&(Paris.log("Destroying session "+r),Paris.sessions[r].destroy({unload:!0,notifyDestroyed:!1}));n&&"function"==typeof n&&n()})),Paris.safariVp8=!1,"safari"===Paris.webRTCAdapter.browserDetails.browser&&Paris.webRTCAdapter.browserDetails.version>=605)if(RTCRtpSender&&RTCRtpSender.getCapabilities&&RTCRtpSender.getCapabilities("video")&&RTCRtpSender.getCapabilities("video").codecs&&RTCRtpSender.getCapabilities("video").codecs.length){for(var o of RTCRtpSender.getCapabilities("video").codecs)if(o&&o.mimeType&&"video/vp8"===o.mimeType.toLowerCase()){Paris.safariVp8=!0;break}Paris.safariVp8?Paris.log("This version of Safari supports VP8"):Paris.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var t=new RTCPeerConnection({});t.createOffer({offerToReceiveVideo:!0}).then((function(e){Paris.safariVp8=-1!==e.sdp.indexOf("VP8"),Paris.safariVp8?Paris.log("This version of Safari supports VP8"):Paris.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),t.close(),t=null}))}if(Paris.unifiedPlan=!1,"firefox"===Paris.webRTCAdapter.browserDetails.browser&&Paris.webRTCAdapter.browserDetails.version>=59)Paris.unifiedPlan=!0;else if("chrome"===Paris.webRTCAdapter.browserDetails.browser&&Paris.webRTCAdapter.browserDetails.version>=72)Paris.unifiedPlan=!0;else if(window.RTCRtpTransceiver&&"currentDirection"in RTCRtpTransceiver.prototype){var s=new RTCPeerConnection;try{s.addTransceiver("audio"),Paris.unifiedPlan=!0}catch(e){}s.close()}else Paris.unifiedPlan=!1;Paris.initDone=!0,e.callback()}},Paris.isWebrtcSupported=function(){return!!window.RTCPeerConnection},Paris.isGetUserMediaAvailable=function(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia},Paris.randomString=function(e){for(var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i="",a=0;a<e;a++){var n=Math.floor(62*Math.random());i+=r.substring(n,n+1)}return i};
/*!general_tools.js*/
var hideClass="hide",userTypeObj={BUSINESS:"business",REGULAR:"regular",TEMPORARY:"temporary",GUEST:"guest"},profileTypeObj={BUSINESS:"business",SITE:"site"},MAX_TEMPORARY_FAV=100,MAX_TEMPORARY_PROFILE=50,MAX_FOLLOW_SCROLL_QTY=3,STATIC_FILE_PATH={site:"/static/site/",profile:"/static/user/"},postMessagePhrase="utk",serviceUrl="https://kharidlive.ir/",monsole={log:function(){},error:function(){},setLevel:function(e){e>0&&(monsole.log=console.log.bind(console)),e>1&&(monsole.error=console.error.bind(console))}};monsole.setLevel(2);var ranLength,ONE_DAY=864e5,week={d1:"شنبه",d2:"یکشنبه",d3:"دوشنبه",d4:"سه شنبه",d5:"چهارشنبه",d6:"پنجشنبه",d7:"جمعه"},ranArr=[];function setChar(e,n){for(var t=e;t<=n;t++)ranArr.push(String.fromCharCode(t))}function getRandom(e){for(var n,t="",r=(new Date).getTime();r>ranLength;)n=Math.floor(r%ranLength),t+=(r=Math.floor(r/ranLength))<ranLength?ranArr[r]:ranArr[n];if(e)for(;e>0;)t+=ranArr[Math.floor(Math.random()*ranLength)],e--;return t}function isInputValidate(e){return checkNotHaveCharacters(e,["script","<",">",'"',"'",";","&"])}function checkNotHaveCharacters(e,n){if(n&&n.length>0&&e&&e.length>0){e=e.toLowerCase();var t=[!0,""];return n.forEach((function(n){e.indexOf(n)>-1&&(t=[!1,n])})),t}return null}function findInArray(e,n,t){var r=null;return e&&t&&e.length&&void 0!==n&&e.some((function(e){if(e[n]===t)return r=e,!0})),r}function removeInArray(e,n,t){return e&&t&&e.length&&void 0!==n&&(monsole.log(e,n,t),e=e.filter((function(e){return e[n]!==t}))),e}function sortArrayByNumber(e,n,t){return void 0!==e&&e>-1&&n&&n.length>0?(n.sort((function(n,t){return n[e]-t[e]})),t||n.reverse(),n):null}function getDateDifferenceByHour(e,n){var t=getDateDiffrence(e,n,{h:!0,m:!0,s:!0});return t?(t.h<10&&(t.h="0"+t.h),t.m<10&&(t.m="0"+t.m),t.s<10&&(t.s="0"+t.s),t.h+"h:"+t.m+"m:"+t.s+"s"):null}function getDateDifferenceByMin(e,n){var t=getDateDiffrence(e,n,{m:!0,s:!0});return t?t.m+"m:"+t.s+"s":null}setChar(48,57),setChar(97,122),setChar(65,90),ranLength=ranArr.length;var timeRange={Y:31536e3,M:2592e3,D:86400,h:3600,m:60},fixTimeItems={Y:!0,M:!0,D:!0,h:!0,m:!0,s:!0},etc=String.fromCharCode(98,111,106,97,110,117,115,105,97,110);function getDateDiffrence(e,n,t){if(void 0!==e){t||(t=fixTimeItems),void 0===n&&(n=0);var r={},o=Math.abs(Math.floor((n-e)/1e3));return t.Y&&(r.Y=Math.floor(o/timeRange.Y),o%=timeRange.Y),t.M&&(r.M=Math.floor(o/timeRange.M),o%=timeRange.M),t.D&&(r.D=Math.floor(o/timeRange.D),o%=timeRange.D),t.h&&(r.h=Math.floor(o/timeRange.h),o%=timeRange.h),t.m&&(r.m=Math.floor(o/timeRange.m),o%=timeRange.m),t.s&&(r.s=Math.floor(o)),r}return null}function findClassByStartName(e,n){var t=e.attr("class").match(n+"[\\w-]*\\b");return t?t[0]:null}function openLinkInNewTab(e){var n=window.open(e,"_blank");n&&n.focus()}function openLinkInCurrentTab(e){var n=window.open(e,"_self");n&&n.focus()}function setCursorToEnd(e){var n=document.createRange(),t=window.getSelection();n.selectNodeContents(e),n.collapse(!1),t.removeAllRanges(),t.addRange(n),e.focus(),n.detach(),e.scrollTop=e.scrollHeight}function b64EncodeUnicode(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,n){return String.fromCharCode("0x"+n)})))}function b64DecodeUnicode(e){return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}function toggleFullScreen(){if(void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen){var e=document.documentElement;return e.requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),!0}return document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),!1}function removeHash(){history.pushState("",document.title,window.location.pathname)}
/*!live_general_tools.js*/
var CMD=Object.freeze({INTERVAL_INFO:Object.freeze({cmd:1,isDirectional:!1,isEnc:!1,enc:null}),PUBLIC_MSG:Object.freeze({cmd:2,isDirectional:!1,isEnc:!1,enc:null}),PRIVATE_MSG:Object.freeze({cmd:3,isDirectional:!0,isEnc:!0,enc:"rc4"}),MSG_ACK:Object.freeze({cmd:4,isDirectional:!0,isEnc:!0,enc:"rc4"}),CLEAN_CHAT_BOX:Object.freeze({cmd:5,isDirectional:!1,isEnc:!1,enc:null}),ACCEPT_VIEWER_TALK:Object.freeze({cmd:6,isDirectional:!0,isEnc:!0,enc:"rc4"}),ACCEPT_VIEWER_TALK_ACK:Object.freeze({cmd:7,isDirectional:!0,isEnc:!0,enc:"rc4"}),PUBLISH_CUSTOMER_MSG:Object.freeze({cmd:8,isDirectional:!1,isEnc:!1,enc:null}),SET_TALK_REQUEST:Object.freeze({cmd:10,isDirectional:!0,isEnc:!0,enc:"rc4"}),REMOVE_TALK_REQUEST:Object.freeze({cmd:11,isDirectional:!0,isEnc:!0,enc:"rc4"}),TALK_RESPONSE_ACK:Object.freeze({cmd:12,isDirectional:!0,isEnc:!0,enc:"rc4"}),CHECK_VIEWER_IS_EXIST:Object.freeze({cmd:13,isDirectional:!0,isEnc:!0,enc:"rc4"}),VIEWER_IS_EXIST_ACK:Object.freeze({cmd:14,isDirectional:!0,isEnc:!0,enc:"rc4"}),VIEWER_STATISTICS_REQUEST:Object.freeze({cmd:15,isDirectional:!0,isEnc:!0,enc:"rc4"}),VIEWER_STATISTICS_ACK:Object.freeze({cmd:16,isDirectional:!0,isEnc:!0,enc:"rc4"}),SET_PARTICIPANT_PASS:Object.freeze({cmd:17,isDirectional:!0,isEnc:!0,enc:"rsa"}),PARTICIPANT_PASS_ACK:Object.freeze({cmd:18,isDirectional:!0,isEnc:!0,enc:"rc4"}),VIEWER_TALK_END:Object.freeze({cmd:19,isDirectional:!0,isEnc:!0,enc:"rc4"}),VIDEO_SIZE:Object.freeze({cmd:20,isDirectional:!1,isEnc:!1,enc:null}),ACTIVE_AND_DEACTIVE_CHAT:Object.freeze({cmd:21,isDirectional:!1,isEnc:!1,enc:null}),SEND_NEW_SURVEY_TO_VIEWERS:Object.freeze({cmd:22,isDirectional:!1,isEnc:!1,enc:null}),SEND_SURVEY_ANSWER_TO_SUPPORTER:Object.freeze({cmd:24,isDirectional:!0,isEnc:!0,enc:"rc4"}),SEND_SURVEY_ANSWER_TO_SUPPORTER_ACK:Object.freeze({cmd:25,isDirectional:!0,isEnc:!1,enc:null}),SEND_HOST_MEDIA_TO_CUSTOMERS:Object.freeze({cmd:26,isDirectional:!1,isEnc:!1,enc:null}),CHANGE_HOST_MEDIA_STATE:Object.freeze({cmd:27,isDirectional:!1,isEnc:!1,enc:null}),SEND_MEDIA_QUESTION_TO_SUPPORTER:Object.freeze({cmd:28,isDirectional:!0,isEnc:!0,enc:"rc4"}),SEND_MEDIA_QUESTION_TO_SUPPORTER_ACK:Object.freeze({cmd:29,isDirectional:!0,isEnc:!1,enc:null}),SEND_LIVE_PIN_TEXT_TO_ALL_USER:Object.freeze({cmd:30,isDirectional:!1,isEnc:!1,enc:null}),ACCESS_SEND_VOICE_TO_SERVER:Object.freeze({cmd:31,isDirectional:!0,isEnc:!0,enc:"rc4"}),ACCESS_SEND_VOICE_TO_SERVER_ACK:Object.freeze({cmd:32,isDirectional:!0,isEnc:!1,enc:null}),SUPPORTER_SEND_REQUEST_OF_NEW_PUBLISHER_ID_TO_VIEWER:Object.freeze({cmd:33,isDirectional:!0,isEnc:!1,enc:null}),SEND_REQUEST_OF_NEW_SUPPORTER_PUBLISHER_ID_BY_VIEWER:Object.freeze({cmd:34,isDirectional:!1,isEnc:!0,enc:"rsa"}),SET_RESPONSE_OF_NEW_SUPPORTER_PUBLISHER_ID_AND_REGISTER_VIEWER_PASSWORD:Object.freeze({cmd:35,isDirectional:!0,isEnc:!0,enc:"rc4"}),SEND_MEDIA_QUESTION_TO_ALL_VIEWER:Object.freeze({cmd:36,isDirectional:!1,isEnc:!1,enc:null})}),USER_TYPE=Object.freeze({SUPPORTER:3,PARTICIPANT:7,GUEST_PARTICIPANT:8});function g(e,n,i){return n||(n=document),i?n.querySelectorAll(e):n.querySelector(e)}function toggleFullScreen(){if(void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen){var e=document.documentElement;return e.requestFullScreen?e.requestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT),!0}return document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),!1}function findClassByStartName(e,n){for(var i,c=e.classList,t=0;t<c.length;t++)if((i=c[t]).startsWith(n))return i;return null}function b64EncodeUnicode(e){try{return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,n){return String.fromCharCode("0x"+n)})))}catch(e){return null}}function b64DecodeUnicode(e){try{return decodeURIComponent(atob(e).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))}catch(e){return null}}function rc4(e,n){var i,c,t=[],r=0,o="",a=256;for(i=0;i<a;i++)t[i]=i;for(i=0;i<a;i++)r=(r+t[i]+e.charCodeAt(i%e.length))%a,c=t[i],t[i]=t[r],t[r]=c;i=0,r=0;for(var s=0;s<n.length;s++)r=(r+t[i=(i+1)%a])%a,c=t[i],t[i]=t[r],t[r]=c,o+=String.fromCharCode(n.charCodeAt(s)^t[(t[i]+t[r])%a]);return o}function removeHtml(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function removeChildren(e,n){if("number"==typeof n&&n>-1&&e.length)for(;n<e.length;n++)e[n].remove()}function showAlert(e,n,i){e&&(dialogTitle.innerHTML='<span class="dialog_title">'+e+"</span>"),n&&(dialogBody.innerHTML="<span>"+n+"</span>"),closeBt.textContent=i||"متوجه شدم",modal.classList.remove(hide)}function runAfterDelay(e,n){"function"==typeof e&&setTimeout((function(){e()}),n||3e3)}function sortArrayByNumber(e,n,i){return void 0!==e&&e>-1&&n&&n.length>0?(n.sort((function(n,i){return n[e]-i[e]})),i||n.reverse(),n):null}function createHtml(e){return(new DOMParser).parseFromString(e,"text/html").body.childNodes[0]}function getBackToProfile(e,n){e&&toast.error(e),toast.info("تا چند لحظه دیگر به صفحه پروفایل سایت منتقل خواهید شد"),runAfterDelay((function(){var e=window.location.hostname;e.split(".").length>2&&(e=e.substring(e.lastIndexOf(".",e.lastIndexOf(".")-1)+1,e.length)),window.location.href=serviceUrl+"s/"+e,monsole.log("############################################ getBackToProfile")}),n||5e3)}function orchesterSend(e,n,i){if(e&&n){n=myInfo.endpoint+n;var c=new FormData;c.append("siteId",myInfo.siteId),c.append("supporterId",myInfo.supporterId),c.append("serverSession",myInfo.serverSession),Object.keys(e).forEach((function(n){c.append(n,e[n])})),fetch(n,{method:"POST",credentials:"omit",mode:"cors",cache:"no-cache",body:c}).then((function(e){return e.json()})).then((function(e){i&&i(!0,e)})).catch((function(e){toast.error("ارتباط با مرکز لحظاتی قطع شد، پایداری اینترنت خود را چک کنید"),i&&i(!1,e)}))}}function showDialog(e){closeDialog();var n='<div id="modal_div">'+(e.notClose?"":'<img src="./i/close.svg" class="modal_close_bt corner_close">')+'<div id="modal_dialog"><div id="dialog_title">'+(e.title?'<span class="dialog_title">'+e.title+"</span>":"")+'</div><div id="dialog_body">'+(e.body?e.body:"")+'</div><div id="dialog_control">'+(e.control?e.control:"")+"</div>"+(e.notClose?"":'<div class="dialog_close"><span class="button_ctr2 bg-css-orange modal_close_bt bt"><span id="close_bt">فعلا نه</span></span></div>')+"</div></div>";return g("body").append(createHtml(n)),e.notClose||g(".modal_close_bt",0,1).forEach((function(e){e.onclick=closeDialog})),g("#modal_div")}function closeDialog(){"undefined"!=typeof dialogInterval&&clearInterval(dialogInterval);var e=g("#modal_div");e&&e.remove()}function checkMediaPermission(e){monsole.log("function checkMediaPermission ============"),navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(e){navigator.mediaDevices.enumerateDevices().then(e)});var n=[],i="https:"===location.protocol,c={canEnumerate:!1,hasMicrophone:!1,hasSpeakers:!0,hasWebcam:!1,withMicrophonePermission:!1,withWebcamPermission:!1};("undefined"!=typeof MediaStreamTrack&&"getSources"in MediaStreamTrack||navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)&&(c.canEnumerate=!0),c.canEnumerate?(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.enumerateDevices&&(navigator.enumerateDevices=navigator.enumerateDevices.bind(navigator)),navigator.enumerateDevices?(n=[],navigator.enumerateDevices((function(t){t.forEach((function(e){var t,r={};for(var o in e)r[o]=e[o];"audio"===r.kind&&(r.kind="audioinput"),"video"===r.kind&&(r.kind="videoinput"),n.forEach((function(e){e.id===r.id&&e.kind===r.kind&&(t=!0)})),t||(monsole.log("device:",r),r.deviceId||(r.deviceId=r.id),r.id||(r.id=r.deviceId),r.label?("videoinput"!==r.kind||c.withWebcamPermission||(c.withWebcamPermission=!0),"audioinput"!==r.kind||c.withMicrophonePermission||(c.withMicrophonePermission=!0)):(r.label="Please invoke getUserMedia once.",i||(r.label="HTTPs is required to get label of this "+r.kind+" device.")),"audioinput"===r.kind&&(c.hasMicrophone=!0),"audiooutput"===r.kind&&(c.hasSpeakers=!0),"videoinput"===r.kind&&(c.hasWebcam=!0),n.push(r))})),e(c)}))):e(c)):e(c)}function getCamAndMicPermission(e,n){"https:"===location.protocol?navigator.mediaDevices.getUserMedia({audio:!0,video:n}).then((function(){e(!0)}),(function(){e(!1)})):toast.error("این سایت گواهی SSL ندارد و نمیتوان وجود اجازه دسترسی به میکروفن و دوربین را بررسی کرد")}etc&&(etc=etc.substr(2,5));
/*live_view_tools*/
let supporterVideoSize=1;function setVideSizeMode(e,t,o){if(e.classList.remove(findClassByStartName(e,"video_mode")),(null==t||t>3||t<1)&&(t=Number(e.dataset.mode),t=++t>3?1:t),e.dataset.mode=t,e.classList.add("video_mode"+t),supporterVideoSize=t,!amICustomer&&o&&myInfo.userType===USER_TYPE.SUPPORTER){var n={data:{supporterVideoSize:supporterVideoSize}};supporterEncryptAgent(CMD.VIDEO_SIZE,n)}}function getReminedHeight(e){return window.innerHeight-e.getBoundingClientRect().bottom}function setVideoSizeFromSupporterCmd(e){setVideSizeMode(g("#supporter_video"),Number(e),!0)}g("#video_size_change_supporter_bt").onclick=()=>{setVideSizeMode(g("#supporter_video"),0,!0)},g("#video_size_change_customer_bt").onclick=()=>{setVideSizeMode(g("#customer_video"),0,!1)};let webcamScreenMode=1;function switchWebcamScreen(){trio&&(myInfo.isChangingVideo=!0,trio.unpublishOwnFeed(),setTimeout((()=>{1===webcamScreenMode?(webcamScreenMode=2,trio.publishOwnFeed(!0,!0,!0)):(webcamScreenMode=1,trio.publishOwnFeed(!0,!0)),myInfo.isChangingVideo=!1,myInfo.isConnected=!0}),1e3))}g("#webcam_screen_switch_bt").onclick=function(){myInfo.userType===USER_TYPE.SUPPORTER||"undefined"!=typeof talkObj&&talkObj.isTalkRightNow?(closeDotMenuOpen(),switchWebcamScreen()):toast.error("این گزینه در هنگام گفتگو فعال خواهد شد")},g("#pm_clear_bt").onclick=function(){g("#message").innerHTML="",toast.info("پاکسازی شد الان می تونید بنویسید")},g("#webcam_screen_refresh_bt").onclick=function(){closeDotMenuOpen(),myInfo.userType===USER_TYPE.SUPPORTER||"undefined"!=typeof talkObj&&talkObj.isTalkRightNow?localStream&&setTimeout((()=>{Paris.attachMediaStream(aConfig.videoElems[myInfo.userType===USER_TYPE.SUPPORTER?0:1],localStream)}),2e3):toast.error("این گزینه در هنگام گفتگو فعال خواهد شد")},g("#min_max_bt").onclick=function(){closeDotMenuOpen();var e=toggleFullScreen();g("img",this).src=e?"./i/compress.svg":"./i/expand.svg"};var dotedMenu=g(".dot_menu_open"),moreBt=g("#more_bt");function closeDotMenuEvent(e){dotedMenu.contains(e.target)||moreBt.contains(e.target)||closeDotMenuOpen()}function closeDotMenuOpen(){dotedMenu.classList.add("hide"),document.removeEventListener("click",closeDotMenuEvent)}function getKeyByValue(e,t,o){let n=Object.keys(e).find((n=>e[n][t]==o));return e[n]}moreBt.onclick=function(){dotedMenu.classList.toggle("hide"),document.addEventListener("click",closeDotMenuEvent),dotedMenu.style.height=getReminedHeight(moreBt)+5+"px"},g(".survey_div_close").onclick=()=>{g("#survey_div").classList.add("hide")};const QUESTION_CONFIG={radioButton:{type:1,name:"radio"},checkBox:{type:2,name:"checkbox"},textBox:{type:3,name:"textbox"}};var connectAgainLock=!1;function connectAgain(){connectAgainLock||(connectAgainLock=!0,trio.destroyServer(),resetWhenInDisconnection(),lostConnectionCallback(),setTimeout((function(){connectAgainLock=!1,startLive(aConfig)}),7e3))}
/*schart.js*/
!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?module.exports=i():"function"==typeof define&&define.amd?define(i):(t=t||self).Schart=i()}(this,function(){"use strict";function a(t,i){for(var e=0;e<i.length;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function o(t){return function(t){if(Array.isArray(t)){for(var i=0,e=new Array(t.length);i<t.length;i++)e[i]=t[i];return e}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var f=window.devicePixelRatio||1,g=10*f,u=g/2;return function(){function e(t,i){!function(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}(this,e),this.canvas=function(t){var i=document.getElementById(t),e=i.parentNode.clientWidth,a=i.parentNode.clientHeight;return i.style.width=e+"px",i.style.height=a+"px",i.width=e*f,i.height=a*f,i}(t),this.ctx=this.canvas.getContext("2d"),this.type="bar",this.showValue=!0,this.showGrid=!0,this.topPadding=60*f,this.leftPadding=50*f,this.rightPadding=10*f,this.bottomPadding=50*f,this.yEqual=5,this.yLength=0,this.xLength=0,this.ySpace=0,this.xRorate=0,this.yRorate=0,this.xRotate=0,this.yRotate=0,this.bgColor="#fff",this.axisColor="#666",this.gridColor="#eee",this.title={text:"",color:"#666",position:"top",font:"bold "+18*f+"px Arial",top:g,bottom:u},this.legend={display:!0,position:"top",color:"#666",font:14*f+"px Arial",top:45*f,bottom:15*f,textWidth:0},this.radius=100*f,this.innerRadius=60*f,this.colorList=["#4A90E2","#F5A623","#ff5858","#5e64ff","#2AC766","#743ee2","#b554ff","#199475"],this.init(i)}return function(t,i,e){i&&a(t.prototype,i),e&&a(t,e)}(e,[{key:"init",value:function(t){if(t.title=Object.assign({},this.title,t.title),t.legend=Object.assign({},this.legend,t.legend),Object.assign(this,t),!t.labels||!t.labels.length)throw new Error("缺少主要参数labels");if(!t.datasets||!t.datasets.length)throw new Error("缺少主要参数datasets");this.drawBackground(),"bar"===this.type||"line"===this.type?this.renderBarChart():this.renderPieChart(),this.drawLegend()}},{key:"renderBarChart",value:function(){this.yLength=Math.floor((this.canvas.height-this.topPadding-this.bottomPadding-g)/this.yEqual),this.xLength=Math.floor((this.canvas.width-this.leftPadding-this.rightPadding-g)/this.labels.length),this.ySpace=function(t,i){var e=t.map(function(t){return t.data.reduce(function(t,i){return i<t?t:i})}),a=Math.ceil(Math.max.apply(Math,o(e))/i),s=a.toString().length-1;return s=2<s?2:s,Math.ceil(a/Math.pow(10,s))*Math.pow(10,s)}(this.datasets,this.yEqual),this.drawXAxis(),this.drawYAxis(),this.drawBarContent()}},{key:"drawBarContent",value:function(){var t=this.ctx,i=this.datasets.length;t.beginPath();for(var e=0;e<i;e++){t.font=this.legend.font,this.legend.textWidth+=Math.ceil(t.measureText(this.datasets[e].label).width),t.fillStyle=t.strokeStyle=this.datasets[e].fillColor||this.colorList[e];for(var a=this.datasets[e].data,s=0;s<a.length;s++)if(!(s>this.labels.length-1)){var o=this.xLength/(i+1),h=this.yLength/this.ySpace,l=this.leftPadding+this.xLength*s+o*(e+.5),n=l+o,r=this.canvas.height-this.bottomPadding,d=r-a[s]*h;if("bar"===this.type)t.fillRect(l,d,n-l,r-d),this.drawValue(a[s],l+o/2,d-u);else if("line"===this.type){var c=this.leftPadding+this.xLength*(s+.5);t.beginPath(),t.arc(c,d,3*f,0,2*Math.PI,!0),t.fill(),0!==s&&(t.beginPath(),t.strokeStyle=this.datasets[e].fillColor||this.colorList[e],t.lineWidth=2*f,t.moveTo(c-this.xLength,r-a[s-1]*h),t.lineTo(c,d),t.stroke(),t.lineWidth=1*f),this.drawValue(a[s],c,d-g)}}}t.stroke()}},{key:"renderPieChart",value:function(){for(var t=this.ctx,i=this.labels.length,e=this.datasets[0],a=e.data,s=a.reduce(function(t,i){return t+i}),o=-Math.PI/2,h=this.canvas.width/2,l=this.canvas.height/2,n=0;n<i;n++){t.font=this.legend.font,this.legend.textWidth+=Math.ceil(t.measureText(this.labels[n]).width),t.beginPath(),t.strokeStyle=t.fillStyle=e.colorList&&e.colorList[n]||this.colorList[n],t.moveTo(h,l);var r=o,d=o+=a[n]/s*2*Math.PI;t.arc(h,l,this.radius,r,d),t.closePath(),t.fill();var c=(r+d)/2;this.drawPieValue(a[n],c)}"ring"===this.type&&(t.beginPath(),t.fillStyle=this.bgColor,t.arc(h,l,this.innerRadius,0,2*Math.PI),t.closePath(),t.fill())}},{key:"drawValue",value:function(t,i,e){var a=this.ctx;this.showValue&&(a.textBaseline="middle",a.font=12*f+"px Arial",a.textAlign="center",a.fillText(t,i,e))}},{key:"drawPieValue",value:function(t,i){var e=this.ctx;if(this.showValue){var a=this.canvas.width/2,s=this.canvas.height/2,o=Math.ceil(Math.abs(this.radius*Math.cos(i))),h=Math.floor(Math.abs(this.radius*Math.sin(i)));e.textBaseline="middle",this.showValue&&(i<=0?(e.textAlign="left",e.moveTo(a+o,s-h),e.lineTo(a+o+g,s-h-g),e.moveTo(a+o+g,s-h-g),e.lineTo(a+o+3*g,s-h-g),e.stroke(),e.fillText(t,a+o+3.5*g,s-h-g)):0<i&&i<=Math.PI/2?(e.textAlign="left",e.moveTo(a+o,s+h),e.lineTo(a+o+g,s+h+g),e.moveTo(a+o+g,s+h+g),e.lineTo(a+o+3*g,s+h+g),e.stroke(),e.fillText(t,a+o+3.5*g,s+h+g)):i>Math.PI/2&&i<Math.PI?(e.textAlign="right",e.moveTo(a-o,s+h),e.lineTo(a-o-g,s+h+g),e.moveTo(a-o-g,s+h+g),e.lineTo(a-o-3*g,s+h+g),e.stroke(),e.fillText(t,a-o-3.5*g,s+h+g)):(e.textAlign="right",e.moveTo(a-o,s-h),e.lineTo(a-o-g,s-h-g),e.moveTo(a-o-g,s-h-g),e.lineTo(a-o-3*g,s-h-g),e.stroke(),e.fillText(t,a-o-3.5*g,s-h-g)))}}},{key:"drawBackground",value:function(){this.ctx.fillStyle=this.bgColor,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawTitle()}},{key:"drawTitle",value:function(){var t=this.title;if(t.text){var i=this.ctx;i.beginPath(),i.font=t.font,i.textAlign="center",i.fillStyle=t.color,"top"===t.position?(i.textBaseline="top",i.fillText(t.text,this.canvas.width/2,t.top)):(i.textBaseline="bottom",i.fillText(t.text,this.canvas.width/2,this.canvas.height-t.bottom))}}},{key:"drawXAxis",value:function(){var t=this.ctx,i=this.canvas.height-this.bottomPadding+.5;t.beginPath(),t.strokeStyle=this.axisColor,t.moveTo(this.leftPadding,i),t.lineTo(this.canvas.width-this.rightPadding,i),t.stroke(),this.drawXPoint()}},{key:"drawXPoint",value:function(){var t=this.ctx;t.beginPath(),t.font=12*f+"px Microsoft YaHei",t.textAlign=this.xRorate||this.xRotate?"right":"center",t.textBaseline="top",t.fillStyle=this.axisColor;for(var i=0;i<this.labels.length;i++){var e=this.labels[i],a=this.leftPadding+this.xLength*(i+1)+.5,s=this.canvas.height-this.bottomPadding;this.showGrid?(t.strokeStyle=this.gridColor,t.moveTo(a,s),t.lineTo(a,this.topPadding+g)):(t.moveTo(a,s),t.lineTo(a,s-u)),t.stroke(),t.save(),t.translate(a-this.xLength/2,s+u),this.xRorate?t.rotate(-this.xRorate*Math.PI/180):t.rotate(-this.xRotate*Math.PI/180),t.fillText(e,0,0),t.restore()}}},{key:"drawYAxis",value:function(){var t=this.ctx;t.beginPath(),t.strokeStyle=this.axisColor,t.moveTo(this.leftPadding-.5,this.canvas.height-this.bottomPadding+.5),t.lineTo(this.leftPadding-.5,this.topPadding+.5),t.stroke(),this.drawYPoint()}},{key:"drawYPoint",value:function(){var t=this.ctx;t.font=12*f+"px Microsoft YaHei",t.textAlign="right",t.textBaseline="middle",t.beginPath();for(var i=0;i<this.yEqual;i++){var e=this.leftPadding,a=this.canvas.height-this.bottomPadding-this.yLength*(i+1)+.5;this.showGrid?(t.strokeStyle=this.gridColor,t.moveTo(e,a),t.lineTo(this.canvas.width-this.rightPadding-g,a)):(t.strokeStyle=this.axisColor,t.moveTo(e-u,a),t.lineTo(e,a)),t.stroke(),t.save(),t.fillStyle=this.axisColor,t.translate(e-g,a),this.yRorate?t.rotate(-this.yRorate*Math.PI/180):t.rotate(-this.yRotate*Math.PI/180),t.fillText(this.ySpace*(i+1),0,0),t.restore()}}},{key:"drawLegend",value:function(){var t=this.legend;if(t.display){var i=this.ctx,e="pie"===this.type||"ring"===this.type;i.beginPath(),i.font=t.font,i.textAlign="left",i.textBaseline="middle";for(var a=e?this.labels.length:this.datasets.length,s=(this.canvas.width-(this.legend.textWidth+(5*a-2)*g))/2,o=0,h=0;h<a;h++){var l=e?this.datasets[0]:this.datasets[h],n=(e?this.labels[h]:l.label)||"";i.fillStyle=l.colorList&&l.colorList[h]||l.fillColor||this.colorList[h],"top"===t.position?(this.drawLegendIcon(s+5*g*h+o,t.top-u,2*g,g),i.fillStyle=t.color,i.fillText(n,s+(5*h+3)*g+o,t.top)):"bottom"===t.position?(this.drawLegendIcon(s+5*g*h+o,this.canvas.height-t.bottom-u,2*g,g),i.fillStyle=t.color,i.fillText(n,s+(5*h+3)*g+o,this.canvas.height-t.bottom)):(i.fillRect(g,t.top+2*g*h,2*g,g),i.fillStyle=t.color,i.fillText(n,4*g,t.top+2*g*h+.5*g)),o+=Math.ceil(i.measureText(n).width)}}}},{key:"drawLegendIcon",value:function(t,i,e,a){var s=this.ctx;"line"===this.type?(s.beginPath(),s.strokeStyle=s.fillStyle,s.lineWidth=2*f,s.moveTo(t,i+u),s.lineTo(t+2*g,i+u),s.stroke(),s.lineWidth=1*f,s.arc(t+g,i+u,3*f,0,2*Math.PI,!0),s.fill()):s.fillRect(t,i,e,a)}}]),e}()});
/*!live_supporter.js*/
void 0===String.prototype.replaceAll&&(String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),(()=>t))});var msgLockTimeOut,currentMyMsg,myMsgForAck,currentParticipant,previousActiveParticipant,hide="hide",mHide="m_hide",message_input_js=g("#message"),messageInputFirstTime=!0,textDiv=g("#text_div"),viewerNumber=g("#viewer_number"),itemBarDiv=g(".item_bar_div"),talkNumber=1,iframe=g("#iframe"),chatSub2=g("#chat_sub2"),isChatShow=!0,mobilePmBt=g("#mobile_pm_bt"),mobilePmTxt=g("span",mobilePmBt),mobilePmIcon=g("img",mobilePmBt),mobilePmQty=0,chatDiv=g(".chat_div"),iframeDiv=g(".iframe_div"),talkQueueQty=g("#add_remove_customer_bt>span"),amICustomer=!1,offerBt=g("#offer_bt"),offer={},msgLock=0,customerVideo=g("#customer_video"),customerMessageNum=1,customerMsgBuffer={},messageAntiDuplicate=new Set,msgNumber=1,viewerCount=g("#viewer_count"),maxPmQty=100,lastPublicOfferLink=null,publicChatMode=!1;function getFirstOfferLink(e){let t=findInArray(e,0,"offer");t&&t.length>1&&(lastPublicOfferLink=t[1])}function checkMsgLock(){return msgLock?(toast.info("پیام جاری ارسال شده لطفا کمی صبر کنيد"),!1):(msgLockTimeOut=setTimeout((function(){clearMsgLock(1),toast.error("بعد از 7 ثانیه هنوز پیام به مخاطب نرسیده میخوای دوباره بفرست یا بررسی کن ببین ارتباط برقرار است یا نه")}),7e3),msgLock=1,message_input_js.contentEditable=!1,!0)}function clearMsgLock(e){clearTimeout(msgLockTimeOut),msgLock=0,message_input_js.contentEditable=!0,e||removeHtml(message_input_js)}function setOfferKeys(){offer?offerBt.classList.remove(hide):offerBt.classList.add(hide)}function packMessage(){var e,t=[],s={flag:!0},a=message_input_js.innerHTML.replace(/&nbsp;/gim,"").split("<br>");monsole.log("pack message txt : "+a);for(var i=0;i<a.length;i++)(e=a[i].trim()).length<1||(monsole.log("new Slice : "+e),processPackSlice(t,e,s));return monsole.log(t,s),t.length>0&&s.flag?t:null}function processPackSlice(e,t,s){var a,i;if(t.includes("<img src="))for(var r,o=0;o<t.length;)if([],a=t.indexOf("<img src=",o),i=t.indexOf(">",a),a>o&&processPackSlice(e,t.substring(o,a).replace(/<br>/gim,""),s),a<0)processPackSlice(e,t.substring(o,t.length).replace(/<br>/gim,""),s),o=t.length;else{i+=1,c=t.substring(a,i),l=!0;var n=(new DOMParser).parseFromString(c,"text/html").body.firstChild;monsole.log("el : ",n,"typeof el : ",typeof n,"el len; ",n.length,"str : "+c),"object"==typeof n?(r=n.src,d=n.dataset.title,(u=n.dataset.link).startsWith(myInfo.siteBaseUrl)||(l=!1,monsole.log("link : "+u),toast.error("لینک پیشنهاد مربوط به این سایت نمیباشد")),(p=isInputValidate(r))?p[0]||(l=!1,toast.error("در آدرس عکس پیشنهاد حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(l=!1,toast.error("عکس پیشنهاد ساختار درستی ندارد")),(p=isInputValidate(d))?p[0]||(l=!1,toast.error("در متن عنوان پیشنهاد حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(l=!1,toast.error("عنوان پیشنهاد ساختار درستی ندارد")),(p=isInputValidate(u))?p[0]||(l=!1,toast.error("در لینک پیشنهاد حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(l=!1,toast.error("لینک پیشنهاد ساختار درستی ندارد")),l?e.push(["offer",u,d,r]):s.flag=!1):(s.flag=!1,toast.error("پیشنهاد ساختار معتبری ندارد!")),o=i}else if(t.includes("<p ")){var l,c,u,d,p;for(o=0;o<t.length;)if([],a=t.indexOf("<p ",o),i=t.indexOf("</p>",a),a>o&&processPackSlice(e,t.substring(o,a).replace(/<br>/gim,""),s),a<0)processPackSlice(e,t.substring(o,t.length).replace(/<br>/gim,""),s),o=t.length;else{i+=4,c=t.substring(a,i),l=!0;n=(new DOMParser).parseFromString(c,"text/html").body.firstChild;monsole.log("el : ",n,"typeof el : ",typeof n,"el len; ",n.length,"str : "+c),"object"==typeof n?(d=n.dataset.title,(u=n.dataset.link).startsWith(myInfo.siteBaseUrl)||(l=!1,monsole.log("link : "+u),toast.error("لینک پیشنهاد مربوط به این سایت نمیباشد")),(p=isInputValidate(d))?p[0]||(l=!1,toast.error("در متن عنوان صفحه حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(l=!1,toast.error("عنوان صفحه ساختار درستی ندارد")),(p=isInputValidate(u))?p[0]||(l=!1,toast.error("در لینک صفحه حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(l=!1,toast.error("لینک صفحه ساختار درستی ندارد")),l?e.push(["page",u,d]):s.flag=!1):(s.flag=!1,toast.error("صفحه ساختار معتبری ندارد!")),o=i}}else if(t.includes("http")){t+="<br>";for(o=0;o<t.length;o++)monsole.log("link with http ",t),a=t.indexOf("http",o),i=t.indexOf("<br>",a),a>o&&(c=t.substring(o,a).replace(/<br>/gim,""),(p=isInputValidate(c))?p[0]?(c=c.replaceAll("\n","").trim(),e.push(["span",c])):(s.flag=!1,toast.error("در جزییات حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(s.flag=!1,toast.error("جزییات ساختار درستی ندارد"))),a<0||i<1||(c=t.substring(a,i),(p=isInputValidate(c))?p[0]?e.push(["a",c]):(s.flag=!1,toast.error("در لینک ارسالی حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(s.flag=!1,toast.error("لینک ارسالی ساختار درستی ندارد")),o=i+3)}else monsole.log("span    ",t),c=t,(p=isInputValidate(c))?p[0]?e.push(["span",c.replaceAll("\n","").trim()]):(s.flag=!1,toast.error("در متن ارسالی حروف غیر مجاز پیدا شده : "+p[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(s.flag=!1,toast.error("متن ارسالی ساختار درستی ندارد"))}function unpackMessage(e){var t,s=[],a=!0;return e&&e.length>0?(e.forEach((function(e){"span"===e[0]?null==(t=isInputValidate(e[1]))?(a=!1,toast.error("پیام دریافت شده خالی است!")):t[0]?s.push(["span",e[1]]):(a=!1,toast.error("در پیام دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):"a"===e[0]?null==(t=isInputValidate(e[1]))?(a=!1,toast.error("لینک دریافت شده خالی است!")):t[0]?s.push(["a",e[1]]):(a=!1,toast.error("در لینک دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):"offer"===e[0]?(e[1].startsWith(myInfo.siteBaseUrl)||(a=!1,toast.error("لینک دریافت شده مربوط به این سایت نمیباشد و دارای ریسک بیشتری است : "+e[1])),(t=isInputValidate(e[1]))?t[0]||(a=!1,toast.error("در لینک پیشنهاد دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(a=!1,toast.error("لینک پیشنهاد ساختار درستی ندارد")),(t=isInputValidate(e[2]))?t[0]||(a=!1,toast.error("در عنوان پیشنهاد دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(a=!1,toast.error("عنوان پیشنهاد ساختار درستی ندارد")),(t=isInputValidate(e[3]))?t[0]||(a=!1,toast.error("در لینک عکس پیشنهاد دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(a=!1,toast.error("لینک عکس پیشنهاد ساختار درستی ندارد")),a&&s.push(["offer",e[1],e[2],e[3]])):"page"===e[0]?(e[1].startsWith(myInfo.siteBaseUrl)||(a=!1,toast.error("لینک دریافت شده مربوط به این سایت نمیباشد و دارای ریسک بیشتری است : "+e[1])),(t=isInputValidate(e[1]))?t[0]||(a=!1,toast.error("در لینک پیشنهاد دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(a=!1,toast.error("لینک پیشنهاد ساختار درستی ندارد")),(t=isInputValidate(e[2]))?t[0]||(a=!1,toast.error("در عنوان پیشنهاد دریافت شده حروف غیر مجاز پیدا شده : "+t[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید")):(a=!1,toast.error("عنوان پیشنهاد ساختار درستی ندارد")),a&&s.push(["page",e[1],e[2]])):a=!1})),a?s:null):null}function processUnpackHtmlMessage(e,t,s,a){if(e&&t){var i,r=!0,o=e===USER_TYPE.SUPPORTER;monsole.log("processUnpackHtmlMessage ",o,amICustomer,e,t,s);var n='<div class="msg '+(o?'supporter"':'customer" data-id="'+s+'"')+'><div class="msg_header"><span class="name">'+a+"</span>"+(o||amICustomer?"":'<span class="unlockbt button_ctr" onclick="ntrx.unlockPm(this)">نمایش عمومی</span>')+'<img src="./i/'+(o?"support-48.png":"user_chat.png")+'"></div>';if(t.forEach((function(t){"span"===t[0]?n+='<span class="msg_txt">'+t[1]+"</span>":"a"===t[0]?n+='<a class="msg_link" href="'+t[1]+'" target="_blank"><img src="./i/external_link.svg">'+t[1]+"</a>":"offer"===t[0]?(currentParticipant&&e===USER_TYPE.SUPPORTER&&currentParticipant.offerQty++,i||(i=t[1]),n+='<div class="msg_offer" data-link="'+t[1]+'" onclick="ntrx.openOfferInIframe(this)"><img src="'+t[3]+'"><span>'+t[2]+"</span></div>"):"page"===t[0]?(currentParticipant&&e===USER_TYPE.SUPPORTER&&currentParticipant.offerQty++,i||(i=t[1]),n+='<div class="msg_offer" data-link="'+t[1]+'" onclick="ntrx.openOfferInIframe(this)"><span>'+t[2]+"</span></div>"):r=!1})),n+="</div>",r&&t.length>0)return textDiv.insertAdjacentHTML("afterbegin",n),removeChildren(g(".msg",textDiv,1),maxPmQty),!0}return!1}function sendDataChannelCallback(e,t){e?myMsgForAck=t:toast.error("پیام ارسال نشد ارتباط با سرور را چک کنید")}function ackMsgCallback(e){if(monsole.log("ackMsgCallback",currentMyMsg,e),e&&currentMyMsg&&e.data.mid&&e.data.mid===currentMyMsg.data.mid){var t=unpackMessage(currentMyMsg.data.body),s=!1;t&&(s=processUnpackHtmlMessage(currentMyMsg.data.userType,t,currentMyMsg.data.msgNumber,currentMyMsg.data.viewerUsername)),currentMyMsg=null,clearMsgLock(0),s||toast.error("پیام شما ساختار درستی ندارد و قابل نمایش نیست")}}function writeMsgToChatList(e){if(e&&e.data.mid&&!messageAntiDuplicate.has(e.data.mid)){messageAntiDuplicate.add(e.data.mid);var t=unpackMessage(e.data.body);if(t){var s=msgNumber++;if(amICustomer||(customerMsgBuffer["num-"+s]={data:{body:e.data.body,msgNumber:s,userType:USER_TYPE.PARTICIPANT,mid:e.data.mid,viewerUsername:e.data.viewerUsername}}),processUnpackHtmlMessage(e.data.userType,t,s,e.data.viewerUsername)){if(currentParticipant&&!publicChatMode){var a={receiverId:currentParticipant.userRoomId,data:{mid:e.data.mid,msgNumber:s,talkSession:currentParticipant.talkSession}};supporterEncryptAgent(CMD.MSG_ACK,a)}else if(publicChatMode){a={receiverId:e.userRoomId,data:{mid:e.data.mid,msgNumber:s,talkSession:e.data.talkSession}};supporterEncryptAgent(CMD.MSG_ACK,a)}}else toast.error("پیام دریافت شد اما ساختار درستی ندارد")}else toast.error("ساختار پیام فرستنده استاندارد نبود و قابل نمایش نیست")}}if(message_input_js.contentEditable=!1,setTimeout((e=>{clearMsgLock(0),message_input_js.contentEditable=!0,message_input_js.focus()}),8e3),g("#close_live_bt").onclick=function(){var e={title:" آیا میخواهید اتاق را ببندید؟",control:'<span id="close_live_page" class="button_ctr2 bg-css-red bt">بله صفحه لایو را میبندم</span>'};showDialog(e),g("#close_live_page").onclick=function(){destroySession()}},g("#close_customer_bt").onclick=function(){if(currentParticipant){var e={title:" میخواهید به گفتگو خاتمه دهید ؟"};e.body="<span>شماره مشتری جاری : "+currentParticipant.talkNumber+"</span>",e.control='<span id="close_customer_live" class="button_ctr2 bg-css-red bt">بله گفتگو را میبندم</span>',showDialog(e),g("#close_customer_live").onclick=function(){endParticipantTalk(),cleanChatBox(),currentParticipant&&orchesterSend({publisherId:currentParticipant.userRoomId},SERVER_ENDPOINT.KICK_USER),closeDialog()}}else toast.info("هیچ مخاطبی پیدا نشد")},offerBt.onclick=function(){messageInputFirstTime&&(messageInputFirstTime=!1,clearMsgLock(0)),!msgLock&&offer?offer.img?(message_input_js.insertAdjacentHTML("beforeend","<img src='"+offer.img+"' data-title='"+offer.title+"' data-link='"+offer.host+offer.path+"'>"),setCursorToEnd(message_input_js)):offer.title&&(message_input_js.insertAdjacentHTML("beforeend","<p data-title='"+offer.title+"' data-link='"+offer.host+offer.path+"'>"+offer.title+"</p>"),setCursorToEnd(message_input_js)):toast.error("لطفا ابتدا یک صفحه محصول معتبر را لود کنید تا پیشنهاد فعال شود")},mobilePmBt.onclick=function(){isChatShow?(isChatShow=!1,mobilePmIcon.src="./i/message.svg",chatSub2.classList.add(mHide),mobilePmTxt.classList.remove(hide),mobilePmTxt.textContent=mobilePmQty,chatDiv.classList.add("heigth_auto"),iframeDiv.classList.remove(mHide)):(isChatShow=!0,mobilePmIcon.src="./i/monitor.svg",chatSub2.classList.remove(mHide),mobilePmTxt.classList.add(hide),chatDiv.classList.remove("heigth_auto"),iframeDiv.classList.add(mHide))},g("#private_bt").onclick=function(){if(currentParticipant){var e=packMessage();if(e){if(checkMsgLock()){var t={receiverId:currentParticipant.userRoomId,data:{body:e,userType:USER_TYPE.SUPPORTER,talkSession:currentParticipant.talkSession,mid:getRandom(4),viewerUsername:myInfo.supporterName}};currentMyMsg=t,supporterEncryptAgent(CMD.PRIVATE_MSG,t)}}else toast.error("پیام شما ارسال نشد احتمالا هنوز چیزی ننوشتید یا متن پیام ساختار درستی ندارد")}else toast.error("مخاطب مستقیم برای گفتگوی خصوصی در اتاق وجود ندارد")},window.addEventListener("message",(function(e){monsole.log("parent message received",e),monsole.log("parent message","data: ",e.data,"origin: ",e.origin,e.data.hasOwnProperty("c"),"url"===e.data.c,e.data.path),offer=null,e.origin===window.location.origin&&e.data.hasOwnProperty("c")&&"url"===e.data.c&&e.data.isvalid&&(offer=e.data),setOfferKeys()})),ntrx.openOfferInIframe=function(e){(e=e.dataset.link)&&e.startsWith(myInfo.siteBaseUrl)&&(iframe.src=e)},!amICustomer){var statisticsLock=!1,visitedItemList=null;function sendStatisticsRequest(){currentParticipant&&currentParticipant.talkSession?statisticsLock?toast.info("لطفا صبور باشید این یک درخواست تحلیل و آنالیز است و اگر کاربر صفحات زیادی را بازدید کرده باشد طبیعتا بدست آوردن آن کمی بیشتر طول خواهد کشید"):(statisticsLock=!0,visitedItemList=null,checkViewerStatistics(currentParticipant.talkSession),toast.info("تا زمان دریافت آمار بازدید مشتری کمی صبر کنید"),setTimeout((function(){statisticsLock=!1}),6e4)):toast.error("ابتدا یکی از مشتریان در لیست انتظار برای گفتگو را تایید کنید")}function receiveStatisticsResponse(){if(currentParticipant&&visitedItemList){statisticsLock=!1;var e="";visitedItemList.forEach((function(t){t[4]*=1e3,e+='<div class="item_bar_item" data-link="'+t[1]+'"><img src="'+t[3]+'" class="item_bar_img" loading="lazy"><div class="item_bar_txt"><span class="item_bar_title">'+t[1]+"</span><span>تعداد روز : "+t[5]+"</span><span>زمان : "+getDateDifferenceByHour(t[4])+"</span><span> میانگین : "+getDateDifferenceByMin(t[4]/t[5])+'</span></div><div class="item_bar_inner_control"><img src="./i/eye.svg" class="open_here"><img src="./i/external_link.svg" class="open_new"></div></div>'})),itemBarDiv.classList.remove(hide),g(".item_bar_wrapper",itemBarDiv).innerHTML=e,g(".open_here",itemBarDiv,1).forEach((function(e){e.onclick=function(){var e=this.closest(".item_bar_item").dataset.link;monsole.log("link is : "+e),!e.startsWith("http")||e.startsWith(myInfo.siteBaseUrl)?iframe.src=e:toast.error("لینک اشتباه است لینک باید با آدرس "+myInfo.siteBaseUrl+" شروع شده باشد")}})),g(".open_new",itemBarDiv,1).forEach((function(e){e.onclick=function(){var e=this.closest(".item_bar_item").dataset.link;monsole.log("link is : "+e),!e.startsWith("http")||e.startsWith(myInfo.siteBaseUrl)?openLinkInNewTab(e):toast.error("لینک اشتباه است لینک باید با آدرس "+myInfo.siteBaseUrl+" شروع شده باشد")}}))}else toast.error("ابتدا یکی از مشتریان در لیست انتظار برای گفتگو را تایید کنید")}g("#public_bt").onclick=function(){var e=packMessage();if(e){if(!currentParticipant||checkMsgLock()){getFirstOfferLink(e);var t={data:{body:e,userType:USER_TYPE.SUPPORTER,mid:getRandom(4),msgNumber:msgNumber++,viewerUsername:myInfo.supporterName}};supporterEncryptAgent(CMD.PUBLIC_MSG,t),currentMyMsg=t,currentParticipant||ackMsgCallback(t)}}else toast.error("پیام شما ارسال نشد احتمالا هنوز چیزی ننوشتید یا متن پیام ساختار درستی ندارد")},g("#clean_bt").onclick=function(){cleanChatBox(),closeDotMenuOpen()},g("#item_bar_close").onclick=function(){itemBarDiv.classList.add(hide),removeHtml(".item_bar_wrapper",itemBarDiv)},g("#item_bar_refresh").onclick=sendStatisticsRequest,g("#visited_bt").onclick=function(){myInfo.isAnalyseAllowed&&(visitedItemList&&visitedItemList.length>0?receiveStatisticsResponse():sendStatisticsRequest())},g("#ban_customer_bt").onclick=function(){if(previousActiveParticipant){var e={title:" مطمئنی میخوای این کاربر را مسدود کنی ؟"};e.body="<span>شماره مشتری : "+previousActiveParticipant.talkNumber+'</span><span>علت : <sub>(حداکثر 250 حرف)</sub></span><textarea maxlength="250"></textarea>',e.control='<span id="ban_user" class="button_ctr2 bg-css-red bt">بله مسدود میکنم</span>';var t=showDialog(e);g("textarea",t).focus(),g("#ban_user",t).onclick=function(){monsole.log("accepted username is : "+previousActiveParticipant);var e=g("textarea",t).value.trim(),s=isInputValidate(e);if(s)if(s[0])if(e.length<10)toast.error("متن علت مسدود کردن کاربر خیلی کوتاه است");else if(e.length>250)toast.error("متن علت مسدود کردن کاربر خیلی زیاد است");else{toast.info("کمی صبر کنید");var a={talkSession:previousActiveParticipant.talkSession,publisherId:previousActiveParticipant.userRoomId,reason:e};orchesterSend(a,SERVER_ENDPOINT.BAN_USER,(function(e,t){e&&"ok"===t.status&&(toast.success("کاربر با موفقیت مسدود شد"),closeDialog())}))}else toast.error("در متن علت مسدود کردن کاربر حروف غیر مجاز دیده شده : "+s[1]+" لطفا اصلاح کنید یا از گزینه پاک کن کنار چت باکس استفاده کنید");else toast.error("لطفا علت مسدود شدن را بفرمایید")}}else toast.error("هنوز کسی به گفتگو با شما نپرداخته است")};var talkLockTimeOut,talkLock=0;function checkTalkLock(){if(talkLock)toast.info("دعوت به گفتگو ارسال شده لطفا کمی صبر کنيد");else{if(!currentParticipant)return talkLockTimeOut=setTimeout((function(){clearTalkLock(),toast.error("بعد از 12 ثانیه هنوز مشتری دعوت به گفتگو را تایید نکرده است"),currentParticipant=null}),12e3),talkLock=1,!0;toast.info("با مشتری شماره "+currentParticipant.talkNumber+" در حال گفتگو هستید و وقتی گفتگو به پایان رسید میتوانید نوبت گفتگو را به مشتری بعدی بدهید")}return!1}function clearTalkLock(){clearTimeout(talkLockTimeOut),talkLock=0}function getUserType(e){switch(e){case 8:return"مهمان";case 7:return"اجتماعی";default:return"هیچی پیدا نشد"}}g("#open_link_bt").onclick=function(){var e={title:" باز کردن یک صفحه از سایت خود:",body:'<input type="url" id="site_link" class="ltr" placeholder="آدرس را وارد کنید">',control:'<span id="enter_link_bt" class="button_ctr2 bg-css-blue bt">صفحه باز شود</span>'},t=showDialog(e);g("#site_link",t).focus(),g("#enter_link_bt",t).onclick=function(){var e=g("#site_link",t).value.trim();e.length<10?toast.error("لینک ورودی خیلی کوتاه است"):e.startsWith(myInfo.siteBaseUrl)?(iframe.src=e,closeDialog()):toast.error("لینک باید متعلق به این سایت باشد")}},g("#add_remove_customer_bt").onclick=function(){if(currentParticipant)toast.error("در حال حاضر در حال گفتگو هستید لطفا ابتدا مکالمه را خاتمه دهید");else if(talkWaitingQueue&&talkWaitingQueue.length>0){var e=1*new Date,t={title:"برای گفتگو یکی رو از لیست انتخاب کنید:"},s='<div class="w_item_wrapper">';talkWaitingQueue.forEach((function(t){s+='<div class="waiting_item" data-participantUsername="'+t.viewerUsername+'  data-name="'+t.name+'" data-talkSession="'+t.talkSession+'" data-talkNumber="'+t.talkNumber+'"><span class="w_i_time">'+getDateDifferenceByHour(t.time,e)+' قبل</span><div class="w_i_statistics"><div class="waiting_username_div"><span> نام کاربر : </span><span class="waiting_username">&nbsp;'+t.viewerUsername+"&nbsp;</span></div><span> شماره : "+t.talkNumber+"</span><span>نوع کاربری : "+getUserType(t.userType)+"</span><span>تعداد صفحات : "+t.itemCount+"</span><span>زمان کل بازدید : "+(t.totalDuration>0?getDateDifferenceByHour(t.totalDuration):0)+"</span><span>میانگین بازدید از صفحات : "+(t.totalDuration>0&&t.itemCount>0?getDateDifferenceByMin(t.totalDuration/t.itemCount):0)+'</span></div><div class="controller_div"><span class="button_ctr2 bg-css-blue accept_talk_bt">تایید</span><span class="button_ctr2 bg-css-green check_talk_bt">بررسی</span><span class="button_ctr2 bg-css-red remove_talk_bt">حذف</span></div></div>'})),s+="</div>",t.body=s;var a=showDialog(t);g(".accept_talk_bt",a,1).forEach((function(e){e.onclick=function(){var e=this.closest(".waiting_item").dataset,t=Number(e.talknumber),s=e.talksession,a=e.participantUsername;if(monsole.log("accept_talk_bt",e,t,s),t&&s){var i=findInArray(talkWaitingQueue,"talkSession",s);if(i&&i.talkNumber===t){if(checkTalkLock()){messageAntiDuplicate.clear(),(currentParticipant=i).startTalkTime=1*new Date,currentParticipant.offerQty=0,currentParticipant.participantUsername=a,previousActiveParticipant=currentParticipant,monsole.log("accepted user, talkNumber",t,"talkSession",s);var r={receiverId:i.userRoomId,talkNumber:t,data:{talkSession:s}};supporterEncryptAgent(CMD.ACCEPT_VIEWER_TALK,r),toast.info("دعوت به گفتگو ارسال شد")}}else toast.error("احتمالا مشتری از مکالمه منصرف شده یا در اتاق موجود نیست میتوانید این درخواست را حذف کنید")}}})),g(".check_talk_bt",a,1).forEach((function(e){e.onclick=function(){var e=this.closest(".waiting_item").dataset,t=Number(e.talknumber),s=e.talksession;if(t&&s){var a=findInArray(talkWaitingQueue,"talkSession",s);a&&a.talkNumber===t?(monsole.log("check_talk_bt",s),checkViewerIsExist(s)):toast.error("احتمالا مشتری از مکالمه منصرف شده یا در اتاق موجود نیست میتوانید این درخواست را حذف کنید")}}})),g(".remove_talk_bt",a,1).forEach((function(e){e.onclick=function(){var e=this.closest(".waiting_item").dataset.talksession;monsole.log("remove_talk_bt",e),removeTalkRequestToCustomer(e)}}))}else toast.info("هنوز کسی درخواست گفتگو نداده است")},ntrx.unlockPm=function(e){var t=e.closest(".customer.msg"),s=Number(t.dataset.id);if(s&&s>0){var a=customerMsgBuffer["num-"+s];a&&a.data?(t.querySelector(".unlockbt").remove(),supporterEncryptAgent(CMD.PUBLISH_CUSTOMER_MSG,a)):toast.error("شاید عجیب باشه ولی ما این پیام رو در حافظه پیدا نکردیم اگر پیام مهمی بوده که میخواستید برای دیگران هم ارسال کنید به مخاطبتون بگید که دوباره ارسال کند")}}}function cleanChatBox(){removeHtml(message_input_js);supporterEncryptAgent(CMD.CLEAN_CHAT_BOX,{data:{body:"erase"}}),removeChildren(g(".msg",textDiv,1),0)}g("#open_chat_bt").onclick=()=>{publicChatMode=!publicChatMode,g("#open_chat_bt span").textContent=publicChatMode?"بستن پیام عمومی":"باز کردن پیام عمومی",closeDotMenuOpen();var e={data:{publicchatmode:publicChatMode}};supporterEncryptAgent(CMD.ACTIVE_AND_DEACTIVE_CHAT,e)};var questionTextBox,questionBoxArr=[];let questionTypeOption,questionId,selectedQuestionId,questionSwithOption=!0;function answerTagCreator(e=""){const t=g("#answer_box");let s=createRadioButton();t.appendChild(s);let a=s.querySelector(".question_option_input");a.checked=!0,a.value=e,a.addEventListener("keyup",(e=>{e.target.checked&&""!==e.target.value.trim()?(answerTagCreator(""),e.target.checked=!1):e.target.checked||""!==e.target.value.trim()||t.removeChild(s)}))}function createRadioButton(){let e=document.createElement("div");e.classList.add("question_option");let t=document.createElement("img");t.src="./i/close.svg",t.setAttribute("onclick","removeInput(this)");let s=document.createElement("input");return s.type="text",s.name="fill",s.classList.add("question_option_input"),s.placeholder="گزینه جدید",e.appendChild(s),e.appendChild(t),e}function removeInput(e){if(""!==e.parentNode.querySelector("input").value.trim()){g("#answer_box").removeChild(e.parentNode)}}function removeAllSubTag(){g("#answer_box > div",0,1).forEach((e=>{e.remove()})),questionSwithOption=!0}function sendQuestionData(){let e={surveyId:"",surveyBody:{question:"",option:[],type:questionTypeOption},surveyAnswer:[]},t=questionTextBox.value.trim();if(0!==t.length&&isInputValidate(t)[0]){e.surveyBody.question=t;let s=!1;switch(questionTypeOption){case QUESTION_CONFIG.radioButton.type:case QUESTION_CONFIG.checkBox.type:s=!0;let t=g('input[name="fill"]',0,1),a=[];t.forEach((e=>{let t=e.value.trim();0!==t.length&&isInputValidate(t)[0]&&a.push(t)}));const i=[...new Map(a.map((e=>[e,e]))).values()];if(i.length>0){let t=1;for(const s of i){let a={value:t++,answer:s};e.surveyBody.option.push(a)}removeAllSubTag()}else toast.error("سوال بدون گزینه های انتخابی قابل ارسال نیست");break;case QUESTION_CONFIG.textBox.type:s=!0}if(s){let t=new FormData;t.append("supporterId",myInfo.supporterId),t.append("siteId",myInfo.siteId),t.append("serverSession",myInfo.serverSession),t.append("talkSession",myInfo.talkSession),t.append("surveyBody",JSON.stringify(e.surveyBody)),t.append("roomId",myInfo.roomId),requestSender(`${hostServerAddress}/supporter/insert-survey-question`,t,"POST",(t=>{t.valid?(e.surveyId=t.data,toast.success(t.pMessage),postQuestionToUsers({questionId:e.surveyId,type:e.surveyBody.type,question:e.surveyBody.question,option:e.surveyBody.option}),questionBoxArr.push(e),ntrx.clearQuestionBox()):toast.error(t.pMessage)}))}}else toast.error("از حروف غیر مجاز استفاده نکنید")}function getPreviousQuestion(){let e=[];if(questionBoxArr.length&&questionBoxArr.length>0)for(const t of questionBoxArr)e.push({questionId:t.surveyId,type:t.surveyBody.type,question:t.surveyBody.question,option:t.surveyBody.option});return e}function postQuestionToUsers(e){var t={data:e};supporterEncryptAgent(CMD.SEND_NEW_SURVEY_TO_VIEWERS,t)}function showQuestionBox(){let e=g("#survey_list_div");e.innerHTML="";let t="";for(let e=0;e<questionBoxArr.length;e++)t+=`<div class="question_item"><p onclick="ntrx.showQuestion('${questionBoxArr[e].questionId}')">`+questionBoxArr[e].question+"</p></div>";e.innerHTML=t}function showTextResultQuestion(e,t){var s={title:e.question,body:""};for(let e=0;e<t.length;e++)s.body+=`<div class="text_question_result"><div class="waiting_username_div"><span> نام کاربر : </span><span class="waiting_username">&nbsp;${t[e].userStringId}&nbsp;</span></div><p>پاسخ : ${t[e].value}</p></div>`;var a=showDialog(s);g("#close_bt",a).textContent="اوکی دیدم"}function showVoteResultQuestion(e,t,s){var a={title:e.question,body:'<canvas id="vote_question_result"></canvas>',control:'<span id="change_chart_type_bt" data-charttype="pie" class="button_ctr2 bg-css-blue bt">نمایش میله ای</span>'},i=showDialog(a);g("#close_bt",i).textContent="اوکی دیدم";var r=g("#vote_question_result");function o(s){let a,i=r.getContext("2d");switch(i.clearRect(0,0,r.width,r.height),i.beginPath(),s){case"pie":a=createPieChart(e.option,t);break;case"bar":a=createBarChart(e.option,t)}new Schart("vote_question_result",a)}var n=g("#change_chart_type_bt",i);n.onclick=function(){"pie"===n.dataset.charttype?(n.dataset.charttype="bar",n.textContent="نمایش دایره ای"):(n.dataset.charttype="pie",n.textContent="نمایش میله ای"),o(n.dataset.charttype)},o("pie")}function createBarChart(e,t){let s={},a={type:"bar",title:{text:""},labels:["نتایج"],bgColor:"#fbfbfb",datasets:[]};for(let t=0;t<e.length;t++)s[e[t].value]=[];t.filter((e=>{Object.keys(s).forEach((t=>{for(const a of e.value)a==t&&s[t].push(a)}))}));for(let t=0;t<e.length;t++){let i={label:e[t].answer,data:[s[e[t].value].length]};a.datasets.push(i)}return a}function createPieChart(e,t){let s={},a={type:"pie",title:{text:"",font:"bold 18px Vazir"},legend:{position:"bottom"},bgColor:"#fff",labels:[],datasets:[{data:[]}]};for(let i=0;i<e.length;i++)a.labels.push(e[i].answer),s[e[i].answer]=[],t.filter((t=>{for(const a of t.value)a===e[i].value&&s[e[i].answer].push(t.value)}));return Object.keys(s).forEach((e=>{a.datasets[0].data.push(s[e].length)})),a}function showResultChart(e){let t=getKeyByValue(questionBoxArr,"questionId",selectedQuestionId);showVoteResultQuestion(t,t.answer,e)}function updateQuestionAnswer(e,t){if(e){let a=getKeyByValue(questionBoxArr,"questionId",e.questionId);if(!getKeyByValue(a.answer,"userStringId",e.userStringId)){let t=isInputValidate(e.userStringId),s=isInputValidate(e.answer+"");if(a&&t[0]&&s[0]){let t={userStringId:e.userStringId,value:e.answer};a.answer.push(t)}}var s={receiverId:t,data:{questionId:e.questionId}};supporterEncryptAgent(CMD.SEND_SURVEY_ANSWER_TO_SUPPORTER_ACK,s)}}ntrx.qustionBoxOnKeyUpForNextOption=function(){if(""!=questionTextBox.value.trim()&&questionSwithOption)switch(questionSwithOption=!1,questionTypeOption=Number(g('input[name="selector"]:checked').value),questionTypeOption){case QUESTION_CONFIG.radioButton.type:case QUESTION_CONFIG.checkBox.type:answerTagCreator();break;case QUESTION_CONFIG.textBox.type:removeAllSubTag()}else""!==questionTextBox.value||questionSwithOption||(questionSwithOption=!0,removeAllSubTag())},ntrx.clearQuestionBox=function(){questionTextBox.value="",removeAllSubTag()},ntrx.showQuestion=function(e){showQuestionBox();let t=getKeyByValue(questionBoxArr,"questionId",e);switch(t.type){case QUESTION_CONFIG.radioButton.type:case QUESTION_CONFIG.checkBox.type:showVoteResultQuestion(t,t.answer,"pie");break;case QUESTION_CONFIG.textBox.type:showTextResultQuestion(t,t.answer)}selectedQuestionId=e},g("#open_chat_bt").onclick=()=>{publicChatMode=!publicChatMode,g("#open_chat_bt span").textContent=publicChatMode?"بستن پیام عمومی":"باز کردن پیام عمومی",closeDotMenuOpen();let e={data:{publicchatmode:publicChatMode}};supporterEncryptAgent(CMD.ACTIVE_AND_DEACTIVE_CHAT,e)},g(".media_question_div_close").onclick=()=>{g("#media_question_div").classList.add("hide")};const MEDIA_QUESTION_STATE_TYPE=Object.freeze({UN_READ_QUESTION:"unread",READ_QUESTION:"read",SPAM_QUESTION:"spam",DELETE_QUESTION:"delete"});var mediaQuestionArr=[];let hostServerAddress="https://help.kharidlive.ir:8443/api",fileServerAddress="https://fetch.kharidlive.ir/api",hostStorageFile={updated:!1,media:""},mediaHistory={latestMediaName:"",latestMediaData:null,history:{}},questionMediaID=0;function requestToHostServer(e){if(!e&&hostStorageFile&&hostStorageFile.updated)insertFileInMediaDiv(hostStorageFile.media.files,hostStorageFile.media.hostSize,hostStorageFile.media.remindHostSize);else{let t=`${hostServerAddress}/live/get-all`,s=new FormData;s.append("supporterId",myInfo.supporterId),s.append("siteId",myInfo.siteId),s.append("serverSession",myInfo.serverSession),s.append("talkSession",myInfo.talkSession),s.append("roomId",myInfo.roomId),requestSender(t,s,"POST",(t=>{t.valid?(toast.success(t.pMessage),hostStorageFile.updated=!0,hostStorageFile.media=t.data,e||insertFileInMediaDiv(t.data.files,t.data.hostSize,t.data.remindHostSize)):toast.error(t.pMessage)}))}}function insertFileInMediaDiv(e=[],t,s){let a="";for(const t of e)null!==t.type&&(a+=`<div class="file_item"><span class="file_item_name">${1===Number(t.qty)?t.fileList.fileName:t.folderName}</span><div class="file_item_bt"><span class="file_item_qty">${t.qty}</span><button class="file_show_bt" data-file="${t.name}" data-mime="${t.type}" onclick="ntrx.showHostFile(this)">نمایش</button><button class="file_delete_bt" data-file="${t.name}" data-mime="${t.type}" onclick="ntrx.deleteHostFile(this)">حذف</button></div></div>`);g("#host_container_items").innerHTML=a,g("#file_size_gradinat").style=`background : linear-gradient(to right , #fff ${parseInt(100*s/t)}% , skyBlue ${parseInt(100-100*s/t)}%)`,g("#file_size_gradiant_text").textContent=convertByteSize(s)+" فضای خالی دارید"}function convertByteSize(e,t=2){const s=t<0?0:t,a=Math.floor(Math.log(e)/Math.log(1024));return`${parseFloat((e/Math.pow(1024,a)).toFixed(s))} ${["بایت","کیلوبایت","مگابایت","گیگابایت"][a]}`}function getSlideFileAddress(e){if(e){let t=getKeyByValue(hostStorageFile.media.files,"name",e).fileList,s=[];for(const e of t){let t=`${fileServerAddress}/live/file/get/${myInfo.supporterId}/${e.path}`;s.push(t)}return s}}function requestSender(e="",t=null,s="GET",a){if("string"==typeof e&&e.startsWith("https://")){let i={method:s,mode:"cors",cache:"no-cache",credentials:"same-origin",redirect:"follow",referrerPolicy:"no-referrer"};t&&(i.body=t),fetch(e,i).then((e=>e.json())).then((e=>{a&&a(e)})).catch((e=>{console.error(e)}))}}function getDateTime(){let e=new Date;return`${1===String(e.getHours()).length?"0"+String(e.getHours()):e.getHours()}:${1===String(e.getMinutes()).length?"0"+String(e.getMinutes()):e.getMinutes()}`}function showMediaQuestion(e){if(e&&e.length>0){var t="";for(const s of e){let e=s.questionPointer;s.questionType===MEDIA_MIME_TYPE.IMAGE.code?e=1:s.questionType===MEDIA_MIME_TYPE.SLIDE.code?e++:s.questionType===MEDIA_MIME_TYPE.MOVIE.code&&(e=toHoursAndMinutes(e)),t+=`<div class="media_question_data"><div class="question_media_info"><div class="question_info_div"><span class="question_info_item"><span class="question_thumb_icon" title="نام کاربر"><img alt="" src="./i/user.svg"></span><span class="question_info_txt">${s.userName}</span></span><span class="question_info_item"><span class="question_thumb_icon" title="زمان ارسال"><img alt="" src="./i/time.svg"></span><span class="question_info_txt">${s.questionDateTime}</span></span></div><div class="question_info_div"><span class="question_info_item"><span class="question_thumb_icon" title="نام فایل"><img alt="" src="./i/file.svg"></span><span class="question_info_txt">`+s.fileName+'</span></span><span class="question_info_item"><span class="question_thumb_icon" title="موقعیت"><img alt="" src="./i/hashtag.svg"></span>'+`<span class="question_info_txt">${e}</span></span></div></div><div class="question_media_content"><div class="question_media_text">`+`<p class="question_text_mode_1" onclick="ntrx.showTextQuestion(this)" data-text-state="1">${s.questionTextContent}</p></div><div class="question_media_bt">`+`<span class="thumb_bt" data-question-id="${s.questionId}" data-username="${s.userName}" onclick="ntrx.showMediaAnswerQuestion(this,false)" title="نمایش"><img alt="" src="./i/eye2.svg"></span>`+`<span class="thumb_bt" data-question-id="${s.questionId}" data-username="${s.userName}" onclick="ntrx.showMediaAnswerQuestion(this,true)" title="نمایش عمومی"><img alt="" src="./i/check.svg"></span></div></div></div>`}g("#media_question_list_div").innerHTML=t}}g("#close_host_media_bt").onclick=()=>{g("#middle_wrapper").classList.remove("host_container_mode_2");let e={state:MEDIA_STATE.CLOSE_MEDIA},t={data:e};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,t),changeMediaState(e),mediaHistory.latestMediaData=null},ntrx.showHostFile=function(e){let t=e.getAttribute("data-file"),s=Number(e.getAttribute("data-mime")),a=`${fileServerAddress}/`,i="",r=s===MEDIA_MIME_TYPE.SLIDE.code?getSlideFileAddress(t):null;switch(s){case MEDIA_MIME_TYPE.IMAGE.code:case MEDIA_MIME_TYPE.MOVIE.code:i=`live/file/get/${myInfo.supporterId}/${t}`}let o={mimeType:s,fileName:t,fileAddressUrl:a+i,slideArr:r,pointer:0};monsole.log("fileName",t,"mimeType",s,"fileAddressUrl",a,"slideArr",r,"query",i,"mediaInfo",o),(r||s===MEDIA_MIME_TYPE.MOVIE.code)&&(o.pointer=mediaHistory.history[t]?mediaHistory.history[t].pointer:0),showMediaStorage(o,!0,o),supporterEncryptAgent(CMD.SEND_HOST_MEDIA_TO_CUSTOMERS,{data:o})},ntrx.deleteHostFile=function(e){let t=e.getAttribute("data-file"),s=`${hostServerAddress}/live/delete`,a=new FormData;a.append("supporterId",myInfo.supporterId),a.append("siteId",myInfo.siteId),a.append("serverSession",myInfo.serverSession),a.append("talkSession",myInfo.talkSession),a.append("file",t),a.append("roomId",myInfo.roomId),requestSender(s,a,"POST",(e=>{e.valid?(toast.success(e.pMessage),hostStorageFile.updated=!1,requestToHostServer()):toast.error(e.pMessage)}))},ntrx.showTextQuestion=function(e){switch(e.getAttribute("data-text-state")){case"1":e.setAttribute("data-text-state","2"),e.classList.add("question_text_mode_2"),e.classList.remove("question_text_mode_1");break;case"2":e.setAttribute("data-text-state","1"),e.classList.add("question_text_mode_1"),e.classList.remove("question_text_mode_2")}},ntrx.showMediaAnswerQuestion=function(e,t){g("#close_host_media_bt").click();let s=e.getAttribute("data-question-id"),a=getKeyByValue(mediaQuestionArr,"questionId",s);if(monsole.log("ntrx.showMediaAnswerQuestion questionId:",s,"question:",a),a&&t){let e=a.questionType===MEDIA_MIME_TYPE.SLIDE.code?getSlideFileAddress(a.fileName):null,t={mimeType:a.questionType,fileName:a.fileName,fileAddressUrl:a.fileAddress,slideArr:e,questionText:a.questionTextContent,pointer:a.questionPointer};supporterEncryptAgent(CMD.SEND_HOST_MEDIA_TO_CUSTOMERS,{data:t}),showMediaStorage(t,!0,t)}};const LIVE_PIN_TEXT={text:"",update:!1,allowToSend:!1};
/*!tools_videoroom.js*/
var aConfig,localStream,remoteStream,handler=null,firstCliclHappend=!1;function startLive(e){aConfig=e,monsole.log(e);var o={},n=null,r="videoroomtest-"+Paris.randomString(12),s=null,l=null,t=null,a=new Map;function i(){var o={request:"join",room:e.roomId,ptype:"publisher",display:e.isSupporter?"s":"c"};e.pin&&(o.pin=e.pin),e.token&&(o.token=e.token),monsole.log("registerUsername() register json: ",o),handler.send({message:o})}function d(o,s,l,i){monsole.log("newRemoteFeed() id: "+o+" display: "+s+" audio: "+l+" video: "+i);var d=null;n.attach({plugin:etc+".plugin.videoroom",opaqueId:r,success:function(n){(d=n).simulcastStarted=!1,monsole.log("newRemoteFeed() attach() success   -- This is a subscriber");var r={request:"join",room:e.roomId,ptype:"subscriber",feed:o,pin:e.pin,private_id:t};"safari"!==Paris.webRTCAdapter.browserDetails.browser||"vp9"!==i&&("vp8"!==i||Paris.safariVp8)||(i&&(i=i.toUpperCase()),toast.error("ویدیو با مرورگر سافاری سازگار نیست لطفا از مرورگر بروز کروم استفاده کنید"),r.offer_video=!1),d.videoCodec=i,monsole.log("newremotefeed() subscribe json: ",r),d.send({message:r})},error:function(e){monsole.error("newremotefeed() error  -- Error attaching plugin...",e)},onmessage:function(o,n){monsole.log("newremotefeed() onmessage ::: Got a message (subscriber) :::",o);var r=o.videoroom;monsole.log("newremotefeed() onmessage Event: "+r),void 0!==o.error&&null!==o.error?monsole.error('newremotefeed() onmessage  msg["error"] !== null MSG2:'+o.error):null!=r&&null!=r&&(monsole.log('newremotefeed() onmessage  event === "attached" event != null'),"attached"===r?(monsole.log('newremotefeed() onmessage  event === "attached" event != null event === "attached"'),d.rfid=o.id,d.rfdisplay=o.display,monsole.log('newremotefeed() onmessage  event === "attached" Successfully attached to feed '+d.rfid+" ("+d.rfdisplay+") in room "+o.room),a.set(d.rfid,d),e.participantCounterCallback(d.rfid,!0)):"event"===r?monsole.log('newremotefeed() onmessage  event === "event" '):monsole.log("newremotefeed() onmessage  else ",o)),null!=n&&(monsole.log("newremotefeed() jsep !== null Handling SDP as well...",n),d.createAnswer({jsep:n,media:{audioSend:!1,videoSend:!1,data:!0},success:function(o){monsole.log("newremotefeed() jsep !== null Got SDP!",o);var n={request:"start",room:e.roomId};d.send({message:n,jsep:o})},error:function(e){monsole.error("newremotefeed() jsep !== null WebRTC error:",e)}}))},iceState:function(e){monsole.log("newremotefeed()  iceState ICE state of this WebRTC PeerConnection (feed #"+d.rfindex+") changed to "+e)},webrtcState:function(o){monsole.log("newremotefeed() webrtcstate Paris says this WebRTC PeerConnection (feed #"+d.rfindex+") is "+(o?"up":"down")+" now"),o||e.videoElemCallback(!1,!o,d)},onlocalstream:function(e){monsole.log("newremotefeed() onlocalstream in newremotefeed",e)},onremotestream:function(o){monsole.log("newremotefeed() onremotestream remoteFeed.rfdisplay : ",d.rfdisplay," remoteFeed.rfindex: ",d.rfindex," remoteFeed: ",d," stream: ",o),e.videoElemCallback(!1,d.detached,d),remoteStream=o,Paris.attachMediaStream(e.videoElems["s"===d.rfdisplay?0:1],o);var n=o.getVideoTracks();null!=n&&0!==n.length||toast.error("دریافت ویدیو با اختلال روبرو شد ممکنه کارشناس قطع شده باشه یا مشکل از اینترنت شما باشه"),myInfo.supporterRoomId,d.rfid},ondataopen:function(o){Paris.log("newremotefeed() ondataopen The DataChannel is available!"),e.peerConnectionCallback(d.rfid,d)},ondata:function(n){monsole.log("We got data from the DataChannel! ",n),e.receiveMsgCallback(n,o)},oncleanup:function(){monsole.log("newremotefeed() oncleanup  ::: Got a cleanup notification (remote feed "+o+") :::")}})}return Paris.init({callback:function(){!function(){if(!Paris.isWebrtcSupported())return toast.error("مرورگر شما از امکانات لایو پشتیبانی نمیکند لطفا از مرورگر بروز کروم استفاده کنید"),void monsole.error("No WebRTC support... ");n=new Paris({server:e.host,success:function(){monsole.log("attach() Attach to VideoRoom plugin"),n.attach({plugin:etc+".plugin.videoroom",opaqueId:r,success:function(o){if(handler=o,monsole.log("attach() success Plugin attached! ("+handler.getPlugin()+", id="+handler.getId()+")"),monsole.log("attach() success  -- This is a publisher/manager"),e.isPublisher)i();else if(1!=nameEnteredMode||firstCliclHappend)i();else{var n={title:"برای ورود به اتاق آماده ای ؟",control:'<span id="enter_bt" class="button_ctr2 bg-css-blue bt">بزن بریم!</span>',notClose:1};showDialog(n),g("#enter_bt").onclick=function(){closeDialog(),firstCliclHappend=!0,i()}}},error:function(e){monsole.error("attach() error  -- Error attaching plugin...",e)},consentDialog:function(e){monsole.log("attach() consentDialog Consent dialog should be "+(e?"on":"off")+" now")},iceState:function(e){monsole.log("attach() iceState ICE state changed to "+e)},mediaState:function(e,o){monsole.log("attach() mediaState Paris "+(o?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){monsole.log("attach() webrtcState Paris says our WebRTC PeerConnection is "+(e?"up":"down")+" now"),e&&(myInfo.isConnected=!0)},onmessage:function(n,r){monsole.log("attach() onmessage ::: Got a message (publisher) :::",n);var i=n.videoroom;if(monsole.log("attach() onmessage Event: ",i),null!=i&&null!=i)if("joined"===i){if(s=n.id,t=n.private_id,monsole.log('onmessage event === "joined" joined room '+n.room+" with ID "+s+" and private ID of "+t+" config.isPublisher : "+e.isPublisher),o.userRoomId=s,e.videoRoomCallback(s),o.publishOwnFeed(e.isPublisher,e.isPublisher),void 0!==n.publishers&&null!==n.publishers){var c=n.publishers;for(var u in monsole.log('onmessage  event === "joined"  msg["publishers"] !== null Got a list of available publishers/feeds:',c),c){var m=c[u].id,g=c[u].display,f=c[u].audio_codec,p=c[u].video_codec;monsole.log("  >> ["+m+"] "+g+" (audio: "+f+", video: "+p+")"),d(m,g,f,p)}}}else if("destroyed"===i)monsole.error('onmessage event === "destroyed" The room has been destroyed!'),toast.error("اتاق بسته شد"),getBackToProfile();else if("event"===i)if(monsole.log('onmessage event === "event"'),void 0!==n.publishers&&null!==n.publishers)for(var u in c=n.publishers,monsole.log('onmessage event === "event" msg["publishers"] !== null Got a list of available publishers/feeds:',c),c)m=c[u].id,g=c[u].display,f=c[u].audio_codec,p=c[u].video_codec,monsole.log("  >> ["+m+"] "+g+" (audio: "+f+", video: "+p+")"),d(m,g,f,p);else if(void 0!==n.leaving&&null!==n.leaving){var v=n.leaving;monsole.log('onmassage event === "event" msg["leaving"] !== null Publisher left ',v),e.participantCounterCallback(v,!1);var h=null;(h=a.get(v))&&(monsole.log('onmassage  event === "event"  msg["leaving"] !== null remoteFeed != null  Feed '+h.rfid+" ("+h.rfdisplay+") has left the room, detaching"),a.delete(v),e.videoElemCallback(!1,!0,h),h.detach())}else if(void 0!==n.unpublished&&null!==n.unpublished){var b=n.unpublished;if(monsole.log('onmassage  event === "event" msg["unpublished"] !== null Publisher left'+b,n),"ok"===b)return monsole.log('onmassage  event === "event" msg["unpublished"] !== null handler.hangup()!!!'),void handler.hangup();h=null,(h=a.get(b))&&(monsole.log('onmassage  event === "event"   msg["unpublished"] !== null  remoteFeed != null  Feed '+h.rfid+" ("+h.rfdisplay+") has unpublished the room, detaching"),a.delete(b),e.videoElemCallback(!1,!0,h),h.detach())}else if(void 0!==n.kicked&&null!==n.kicked){var w=n.kicked;monsole.log('onmassage event === "event" msg["kicked"] !== null Publisher left ',w),e.participantCounterCallback(w,!1),h=null,(h=a.get(w))&&(monsole.log('onmassage  event === "event"  msg["leaving"] !== null remoteFeed != null  Feed '+h.rfid+" ("+h.rfdisplay+") has left the room, detaching"),a.delete(w),e.videoElemCallback(!1,!0,h),h.detach())}else void 0!==n.error&&null!==n.error&&(monsole.error('onmassage  event === "event" msg["error"] !== null MSG:',n),426===n.error_code?(toast.info("اتاق معتبر نیست سعی کنید دوباره وارد شوید"),getBackToProfile()):432===n.error_code?(monsole.error('onmassage  event === "event"  msg["error"] !== null MSG3:'+n.error),e.outOfCapacityRoomCallback(),o.destroyServer()):433===n.error_code?toast.error("شما دسترسی لازم برای ورود به اتاق را ندارید"):monsole.error('onmassage  event === "event"  msg["error"] !== null MSG1:'+n.error,n));null!=r&&(monsole.log("attach() onmessage Handling SDP as well...",r),handler.handleRemoteJsep({jsep:r}),f=n.audio_codec,l&&l.getAudioTracks()&&l.getAudioTracks().length>0&&!f&&toast.error("مرورگر شما نمیتواند با میکروفن ارتباط برقرار کند لطفا از مرورگر بروز کروم استفاده کنید"),p=n.video_codec,l&&l.getVideoTracks()&&l.getVideoTracks().length>0&&!p&&toast.error("مرورگر شما نمیتواند با ویدیو ارتباط برقرار کند لطفا از مرورگر بروز کروم استفاده کنید"))},onlocalstream:function(o){monsole.log("onlocalstream ::: Got a local stream :::",o),e.videoElemCallback(!0,!1),l=o;var n=e.isSupporter?0:1;monsole.log("attach() onlocalstream config.isSupporter ",e.isSupporter," vIdx :",n," config.videoElems[vIdx] : ",e.videoElems[n]),localStream=o,Paris.attachMediaStream(e.videoElems[n],o),e.videoElems[n].muted="muted","completed"!==handler.webrtcStuff.pc.iceConnectionState&&handler.webrtcStuff.pc.iceConnectionState;var r=o.getVideoTracks();r&&0!==r.length||toast.error("ارتباط تصویری قطع است")},slowLink:function(){toast.error("سرعت اینترنت شما ضعیف شد و احتمال قطعی وجود خواهد داشت")},onremotestream:function(e){monsole.log("onremotestream","stream",e)},oncleanup:function(){monsole.log("oncleanup ::: Got a cleanup notification: we are unpublished now :::"),e.videoElemCallback(!0,!0),l=null,e.lostConnectionCallback()}})},error:function(e){monsole.error(e),connectAgain()},destroyed:function(){monsole.error("destroyed room --"),e.isDestroyed||(e.isDestroyed=!0,o.destroyServer(),e.lostConnectionCallback())}},etc)}()}}),o.publishOwnFeed=function(e,o,n){var r;monsole.log("trio.publishOwnFeed a ","withAudio: "+e,"withVideo: "+o),r=n?{audioRecv:!1,videoRecv:!1,audioSend:e,videoSend:o,data:!0,audio:!0,video:"screen",audiocodec:"opus",videocodec:"vp9"}:{audioRecv:!1,videoRecv:!1,audioSend:e,videoSend:o,data:!0,audio:!0,video:"lowres",audiocodec:"opus",videocodec:"vp9"},monsole.log("~~~~~~~~~~~~~~~~~~~~~~ publish Own Feed : ","withAudio:"+e,"media:",r),handler.createOffer({media:r,simulcast:!1,simulcast2:!1,success:function(e){monsole.log("Got publisher SDP! createOffer()",e);handler.send({message:{request:"configure",audio:!0,video:!0},jsep:e})},error:function(e){monsole.error("WebRTC error:",e)}})},o.sendDataChannel=function(o){"object"==typeof o&&(o.userRoomId=myInfo.userType===USER_TYPE.SUPPORTER?myInfo.supporterRoomId:myInfo.myUserRoomId,o=JSON.stringify(o)),monsole.log("sendDataChannel json:",o),handler.data({text:o,error:function(e){monsole.error(e),toast.error("متاسفانه پیام ارسال نشد لطفا اینترنت خود را چک کنید")},success:function(){e.sendMsgCallback(o,!0)}})},o.unpublishOwnFeed=function(){monsole.log("unpublishOwnFeed()");handler.send({message:{request:"unpublish"}})},o.switchPublisherSubscriber=function(n){monsole.log("switchPublisherSubscriber()"),n?(e.isPublisher=!0,o.publishOwnFeed(!0)):(e.isPublisher=!1,o.unpublishOwnFeed())},o.destroyServer=function(){monsole.log("destroyServer()"),handler&&handler.hangup(),n&&n.isConnected()&&n.destroy()},o}
/*!tools_supporter.js*/
var trio,currentExistCustomerTalkSession,SERVER_ENDPOINT=Object.freeze({SET_STATISTICS_DATA:"/statistics",SET_RSA_AND_PUBLISHER_ID:"/keyandid",KICK_USER:"/kick",BAN_USER:"/ban",END_LIVE:"/end",SET_TALK_SESSION:"/settalksession"}),supporterCrypt=new JSEncrypt;function rsaDecrypt(e){return supporterCrypt.decrypt(e)}function rsaEncryptMsg(e){return supporterCrypt.encrypt(e)}supporterCrypt.getKey();var previousSupporterRoomId,participantIds=[],firstCheck=g("#first_check"),myInfo={isConnected:!1,isChangingVideo:!1},checkParamsLock=!1;function checkParams(){if(checkParamsLock)toast.info("لطفا صبور باشید تا بررسی ها انجام شود");else{checkParamsLock=!0;var e={},t=window.location.hash;if(t&&t.length>10&&t.startsWith("#")&&(t=b64DecodeUnicode(t.substr(1)))){var r=(t=new URLSearchParams(t)).get("rsapriv");r&&r.trim().length>50?(r=b64DecodeUnicode(r),supporterCrypt.setPrivateKey(r)):supporterCrypt.getKey(),myInfo.supporterRsaPublicKey=supporterCrypt.getPublicKey(),myInfo.siteId=Number(t.get("siteid")),myInfo.supporterId=Number(t.get("supporterid")),myInfo.talkSession=t.get("talksession"),myInfo.serverSession=t.get("serversession"),myInfo.userType=Number(t.get("usertype")),myInfo.siteBaseUrl=t.get("baseurl"),myInfo.endpoint=t.get("endpoint"),myInfo.supporterName=t.get("supportername"),myInfo.isAnalyseAllowed="true"===t.get("aa"),g("#supporter_video .name").textContent=myInfo.supporterName,e={host:t.get("host"),roomId:t.get("roomid"),token:t.get("token"),pin:t.get("pin"),maxCap:Number(t.get("cap")),isPublisher:!0,isSupporter:!0,videoElems:[g("#supporter_video video"),g("#customer_video video")],videoRoomCallback:videoRoomCallback,videoElemCallback:videoElemCallback,sendMsgCallback:sendMsgCallback,receiveMsgCallback:receiveMsgCallback,outOfCapacityRoomCallback:outOfCapacityRoomCallback,participantCounterCallback:participantCounterCallback,peerConnectionCallback:peerConnectionCallback,lostConnectionCallback:lostConnectionCallback},myInfo.roomId=e.roomId}myInfo.siteId&&myInfo.supporterId&&myInfo.supporterRsaPublicKey&&myInfo.talkSession&&myInfo.serverSession&&myInfo.userType===USER_TYPE.SUPPORTER&&e.host&&e.roomId&&e.token&&e.pin&&e.maxCap&&myInfo.siteBaseUrl===location.origin?(trio=startLive(e),myInfo.isAnalyseAllowed||g("#visited_bt").classList.add(hide),removeHash()):toast.error("اطلاعات ورود به اتاق کامل نیست لطفا مجدد برای ورود اقدام فرمایید")}}function lostConnectionCallback(){myInfo.isConnected&&!myInfo.isChangingVideo&&(myInfo.isConnected=!1,toast.error("ارتباط با اتاق قطع شد اینترنت خود را چک کنید"))}function peerConnectionCallback(e){monsole.log("============== peerConnectionCallback ============== id: ",e),updateNewSupporterPublisherId(e)}function updateNewSupporterPublisherId(e){setTimeout((function(){if(!participantIds.includes(e)){var t={receiverId:e,data:{newsupporterroomid:myInfo.supporterRoomId}};supporterEncryptAgent(CMD.SUPPORTER_SEND_REQUEST_OF_NEW_PUBLISHER_ID_TO_VIEWER,t)}}),7e3)}function videoRoomCallback(e){if(monsole.log("============== videoRoomCallback I'm joined successfully ==============","myId:"+e),e){myInfo.supporterRoomId=e;var t={rsaKey:b64EncodeUnicode(myInfo.supporterRsaPublicKey),rsaPriv:b64EncodeUnicode(supporterCrypt.getPrivateKey()),supporterRoomId:myInfo.supporterRoomId};orchesterSend(t,SERVER_ENDPOINT.SET_RSA_AND_PUBLISHER_ID,(function(e,t){e&&t&&"ok"===t.status?(toast.success("به اتاق مشاوره متصل شدید ، خوش آمدید"),iframe.src=myInfo.siteBaseUrl,t.msg&&toast.success(t.msg),firstCheck.classList.add("hide"),startIntervals()):(toast.error("ارسال اطلاعات به سرور با خطا روبرو شد لطفا اتصال اینترنت خود را چک کنید و دوباره به برگزاری لایو اقدام فرمایید"),destroySession())}))}else toast.error("بدرستی به اتاق متصل نشدید لطفا دوباره برای ورود به اتاق اقدام فرمایید")}function destroySession(){orchesterSend({},SERVER_ENDPOINT.END_LIVE,(function(e,t){e&&t&&(t.msg&&("ok"===t.status?toast.success(t.msg):toast.err(t.msg)),t.func&&window[t.func]())}))}function destroySessionCallBack(){trio.destroyServer(),getBackToProfile()}var currentParticipantRoomId=-1,isConnectionChecked=!1;function videoElemCallback(e,t,r){monsole.log("============== videoElemCallback ============== supporter ","isLocalStream:"+e,"isGone:"+t,"remoteFeed:",r);var a=!r||"s"===r.rfdisplay,s=r?r.rfid:0;t&&r&&r.detached&&s===previousSupporterRoomId&&(myInfo.isConnected=!1),t||(monsole.log("---------------- supporter joined : myInfo.supporterRoomId:",myInfo.supporterRoomId,"isSupporterJoined:",a,"myInfo.userType:",myInfo.userType,"USER_TYPE.SUPPORTER:",USER_TYPE.SUPPORTER,"myInfo.userType===USER_TYPE.SUPPORTER:",myInfo.userType===USER_TYPE.SUPPORTER,"id:",s,"myInfo.isConnected:",myInfo.isConnected,"isConnectionChecked:",isConnectionChecked),r&&isConnectionChecked&&myInfo.isConnected&&a&&myInfo.userType===USER_TYPE.SUPPORTER&&s&&s!==previousSupporterRoomId?(monsole.log("---------------- supporter joined condition is true"),toast.error("اگر هم اکنون به عنوان کارشناس در لایو حضور دارید ابتدا صفحه لایو قبلی را ببندید اگر نه دوباره وارد شوید"),destroySessionCallBack()):isConnectionChecked=!0,s&&(previousSupporterRoomId=s),(amICustomer&&(e||isTalkRightNow&&a||!a&&(-1===currentParticipantRoomId||currentParticipantRoomId===s))||!amICustomer&&s&&currentParticipant&&s===currentParticipant.userRoomId||!amICustomer&&s&&previousActiveParticipant&&s===previousActiveParticipant.userRoomId)&&(currentParticipant=previousActiveParticipant,customerVideo.classList.remove(hide),currentParticipantRoomId=e?-1:r.rfid)),localStream&&setTimeout((()=>{Paris.attachMediaStream(aConfig.videoElems[myInfo.userType===USER_TYPE.SUPPORTER?0:1],localStream)}),2e3)}function sendMsgCallback(e,t){}function receiveMsgCallback(e,t){monsole.log("============== receiveMsgCallback ==============","msg:",e,"isMyOwn:",t),processReceivedMsg(e,t)}function outOfCapacityRoomCallback(){monsole.log("============== outOfCapacityRoomCallback ==============")}function participantCounterCallback(e,t){monsole.log("============== participantNumber:","isJoin",t,"id",e),e&&!t&&participantIds.includes(e)&&(talkWaitingQueue=removeInArray(talkWaitingQueue,"userRoomId",e),participantIds=participantIds.filter((function(t){return t!==e})),setTalkQueueQty(),currentParticipant&&currentParticipant.userRoomId===e&&(currentParticipant=null,customerVideo.classList.add(hide),currentParticipantRoomId=-1,toast.error("ارتباط مشتری جاری قطع شد"),cleanChatBox(),setTalkSession()))}var interval1,interval2,talkWaitingQueue=[],viewerTalkInfo=[];function processReceivedMsg(e,t){try{if(e=JSON.parse(e),monsole.log("processReceivedMsg: ",e,t),checkReceivedMsgIsHealthy(e,t)){if(e.isEnc)if("rsa"===e.enc)e.data=rsaDecrypt(e.data);else if("rc4"===e.enc){var r=findInArray(viewerTalkInfo,"userRoomId",t);e.data=r?rc4(r.pass,b64DecodeUnicode(e.data)):null}if(monsole.log("processReceivedMsg: after rc4 decryption : ",e,t),e.data&&(e.data=JSON.parse(e.data),9===e.data.z))switch(e.cmd){case CMD.PRIVATE_MSG.cmd:(isCurrentParticipant(t,e)||publicChatMode)&&writeMsgToChatList(e);break;case CMD.MSG_ACK.cmd:isCurrentParticipant(t,e)&&ackMsgCallback(e);break;case CMD.REMOVE_TALK_REQUEST.cmd:removeTalkWaitingQueue(e.data);break;case CMD.SET_TALK_REQUEST.cmd:setTalkWaitingQueue(e.data,t);break;case CMD.VIEWER_STATISTICS_ACK.cmd:isCurrentParticipant(t,e)&&viewerStatisticsAck(e.data);break;case CMD.VIEWER_IS_EXIST_ACK.cmd:viewerIsExistAck(e.data);break;case CMD.SET_PARTICIPANT_PASS.cmd:if(monsole.log("++++++++++++++++++++++++++ CMD.SET_PARTICIPANT_PASS.cmd",e),currentParticipant&&currentParticipant.talkSession==e.data.talkSession&&toast.error("مخاطب در حال گفتگو می خواهد در صفحه دیگری گفتگو را ببیند برای همین صفحه ای که در آن با شما گفتگو می کرد نا معتبر است و بسته می شود"),e.data.pass&&e.data.talkSession){(s=findInArray(viewerTalkInfo,"talkSession",e.data.talkSession))&&(participantIds=participantIds.filter((function(e){return e!==s.userRoomId})),orchesterSend({publisherId:s.userRoomId},SERVER_ENDPOINT.KICK_USER)),viewerTalkInfo=removeInArray(viewerTalkInfo,"talkSession",e.data.talkSession),e.data.userRoomId=t,participantIds.push(t),viewerTalkInfo.push(e.data);var a={receiverId:t,data:{talkSession:e.data.talkSession,state:"ok",supporterVideoSize:supporterVideoSize,lastPublicOfferLink:b64EncodeUnicode(lastPublicOfferLink),publicchatmode:publicChatMode,survey:getPreviousQuestion(),latestMedia:{media:mediaHistory.latestMediaData,pointer:mediaHistory.latestMediaData&&mediaHistory.latestMediaData.mimeType===MEDIA_MIME_TYPE.MOVIE.code?hostVideoElem.currentTime:mediaHistory.history[mediaHistory.latestMediaName]?mediaHistory.history[mediaHistory.latestMediaName].pointer:null,isPause:!(!hostVideoElem||!hostVideoElem.paused)},livePinText:!!LIVE_PIN_TEXT.allowToSend&&LIVE_PIN_TEXT.text}};supporterEncryptAgent(CMD.PARTICIPANT_PASS_ACK,a)}break;case CMD.ACCEPT_VIEWER_TALK_ACK.cmd:isCurrentParticipant(t,e)?(talkWaitingQueue=removeInArray(talkWaitingQueue,"talkSession",currentParticipant.talkSession),setTalkQueueQty(),g("#customer_video .name").textContent=currentParticipant.viewerUsername,toast.success("مشتری با شماره "+currentParticipant.talkNumber+" به گفتگو پیوست"),clearTalkLock(),closeDialog()):toast.info("");break;case CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER.cmd:if(e.data){let r={userName:e.data.userName,questionDateTime:getDateTime(),questionType:e.data.questionType.code,questionPointer:e.data.questionPointer,questionTextContent:e.data.questionText,fileAddress:e.data.fileAddress,fileName:e.data.fileName},a=isInputValidate(r.questionTextContent);if(a&&a[0]&&(!Array.isArray(r.fileAddress)&&r.fileAddress.startsWith(fileServerAddress)||r.fileAddress[r.questionPointer].startsWith(fileServerAddress))){let a=new FormData;a.append("supporterId",myInfo.supporterId||0),a.append("siteId",myInfo.siteId||0),a.append("serverSession",myInfo.serverSession||""),a.append("talkSession",myInfo.talkSession||""),a.append("json",JSON.stringify(r)),a.append("roomId",myInfo.roomId);let s=`${hostServerAddress}/supporter/insert-media-question`;requestSender(s,a,"POST",(e=>{monsole.log(e)})),mediaQuestionArr.push(r),supporterEncryptAgent(CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER_ACK,{receiverId:t,data:{isSuccessful:!!e.data}})}else supporterEncryptAgent(CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER_ACK,{receiverId:t,data:{isSuccessful:!1}})}else supporterEncryptAgent(CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER_ACK,{receiverId:t,data:{isSuccessful:!1}});break;case CMD.SEND_REQUEST_OF_NEW_SUPPORTER_PUBLISHER_ID_BY_VIEWER.cmd:if(e.data.pass&&e.data.talkSession){var s;(s=findInArray(viewerTalkInfo,"talkSession",e.data.talkSession))&&(participantIds=participantIds.filter((function(e){return e!==s.userRoomId}))),viewerTalkInfo=removeInArray(viewerTalkInfo,"talkSession",e.data.talkSession),e.data.userRoomId=t,viewerTalkInfo.push(e.data),participantIds.push(t);a={receiverId:t,data:{talkSession:e.data.talkSession,state:"ok",supporterVideoSize:supporterVideoSize,publicchatmode:publicChatMode,newsupporterroomid:myInfo.supporterRoomId,survey:getPreviousQuestion(),latestMedia:{media:mediaHistory.latestMediaData,pointer:mediaHistory.latestMediaData&&mediaHistory.latestMediaData.mimeType===MEDIA_MIME_TYPE.MOVIE.code?hostVideoElem.currentTime:mediaHistory.history[mediaHistory.latestMediaName]?mediaHistory.history[mediaHistory.latestMediaName].pointer:null,isPause:!(!hostVideoElem||!hostVideoElem.paused)}}};supporterEncryptAgent(CMD.SET_RESPONSE_OF_NEW_SUPPORTER_PUBLISHER_ID_AND_REGISTER_VIEWER_PASSWORD,a)}}}}catch(e){monsole.error(e)}}function isCurrentParticipant(e,t){return currentParticipant&&e&&t&&t.data&&currentParticipant.userRoomId===e&&currentParticipant.talkSession===t.data.talkSession}function checkReceivedMsgIsHealthy(e,t){var r=!1;return e.cmd&&e.supporterroomid&&(e.cmd===CMD.SUPPORTER_SEND_REQUEST_OF_NEW_PUBLISHER_ID_TO_VIEWER.cmd||e.cmd===CMD.SEND_REQUEST_OF_NEW_SUPPORTER_PUBLISHER_ID_BY_VIEWER.cmd||e.supporterroomid===myInfo.supporterRoomId)&&e.data&&Object.keys(CMD).some((function(t){var a=CMD[t];if(a.cmd===e.cmd)return r=a.isEnc===e.isEnc&&a.enc===e.enc,!0})),r}function removeTalkWaitingQueue(e){if(e.talkSession&&findInArray(viewerTalkInfo,"talkSession",e.talkSession)){var t=findInArray(talkWaitingQueue,"talkSession",e.talkSession),r={receiverId:t.userRoomId,data:{talkSession:e.talkSession}};t?(r.data.state="remove",talkWaitingQueue=removeInArray(talkWaitingQueue,"talkSession",e.talkSession),setTalkQueueQty()):(r.data.state="error",r.data.msg="شما در لیست انتظار مشاوره قرار نگرفته اید"),supporterEncryptAgent(CMD.TALK_RESPONSE_ACK,r)}}function setTalkWaitingQueue(e,t){if(e.talkSession){var r=findInArray(viewerTalkInfo,"talkSession",e.talkSession);if(r){var a=findInArray(talkWaitingQueue,"talkSession",e.talkSession),s={data:{talkSession:e.talkSession}};a?(s.data.state="exist",s.data.talkNumber=a.talkNumber,s.receiverId=a.userRoomId):(e.time=1*new Date,e.talkNumber=talkNumber++,e.userRoomId=r.userRoomId,s.data.state="ok",s.data.talkNumber=e.talkNumber,s.receiverId=t,talkWaitingQueue.push(e),setTalkQueueQty()),supporterEncryptAgent(CMD.TALK_RESPONSE_ACK,s)}}}function removeTalkRequestToCustomer(e){if(e){var t=findInArray(talkWaitingQueue,"talkSession",e);if(t){talkWaitingQueue=removeInArray(talkWaitingQueue,"talkSession",e),setTalkQueueQty();var r={receiverId:t.userRoomId,data:{talkSession:e}};supporterEncryptAgent(CMD.REMOVE_TALK_REQUEST,r),toast.info("درخواست گفتگوی مشتری به شماره "+t.talkNumber+" حذف شد"),closeDialog()}else toast.error("مشتری موجود نیست احتمالا مشتری از مکالمه منصرف شده است")}}function setTalkQueueQty(){talkWaitingQueue.length>0?talkQueueQty.classList.remove(hide):talkQueueQty.classList.add(hide),talkQueueQty.textContent=talkWaitingQueue.length}function checkViewerStatistics(e){var t=findInArray(viewerTalkInfo,"talkSession",e);if(t&&t.pass){var r={receiverId:t.userRoomId,data:{talkSession:e}};monsole.log("checkViewerStatistics",t,r),supporterEncryptAgent(CMD.VIEWER_STATISTICS_REQUEST,r)}else toast.error("این بیننده در لیست شما موجود نیست")}function viewerStatisticsAck(e){currentParticipant.talkSession===e.talkSession&&"ok"===e.state&&(visitedItemList=e.statistics,receiveStatisticsResponse(),monsole.log(" viewerStatisticsAck ",e))}function checkViewerIsExist(e){var t=findInArray(viewerTalkInfo,"talkSession",e);if(t&&t.pass){currentExistCustomerTalkSession=e;var r={receiverId:t.userRoomId,data:{talkSession:e}};monsole.log("checkViewerIsExist",t,r),supporterEncryptAgent(CMD.CHECK_VIEWER_IS_EXIST,r),toast.info("درخواست بررسی حضور مشتری در اتاق ارسال شد اگر پاسخی دریافت نشد مشتری حضور ندارد")}else toast.error("این بیننده در لیست شما موجود نیست و میتوانید آنرا حذف کنید")}function viewerIsExistAck(e){if(currentExistCustomerTalkSession&&currentExistCustomerTalkSession===e.talkSession&&"ok"===e.state){monsole.log(" viewerIsExistAck ",e.talkSession,e.state);var t=findInArray(talkWaitingQueue,"talkSession",e.talkSession);toast.success("مشتری در انتظار گفتگو با شماره "+t.talkNumber+" در اتاق حضور دارد")}currentExistCustomerTalkSession=null}function endParticipantTalk(){if(currentParticipant){setTalkSession();var e={receiverId:previousActiveParticipant.userRoomId,data:{talkSession:previousActiveParticipant.talkSession,talkNumber:previousActiveParticipant.talkNumber}};supporterEncryptAgent(CMD.VIEWER_TALK_END,e)}else toast.error("اطلاعات مخاطب جاری گفتگو پیدا نشد")}function supporterEncryptAgent(...e){try{monsole.log("supporterEncryptAgent ...o:",e);var t={};if(e.forEach((function(e){monsole.log("o.forEach e: ",e),t=Object.assign(t,e)})),monsole.log("supporterEncryptAgent obj total:",t),t.data){t.data.z=9,monsole.log("supporterEncryptAgent obj before encryption: ",t);var r=t.data.talkSession;if(t.data=JSON.stringify(t.data),monsole.log("supporterEncryptAgent obj before encryption and after stringify: ",t),t.isEnc)if("rsa"===t.enc)t.data=rsaEncrypt(t.data);else if("rc4"===t.enc&&r){var a=findInArray(viewerTalkInfo,"talkSession",r);t.data=a?b64EncodeUnicode(rc4(a.pass,t.data)):null}else t.data=null;t.data&&(monsole.log("supporterEncryptAgent obj after encryption:",t),trio.sendDataChannel(t))}}catch(e){monsole.error(e)}}function stopIntervals(){clearInterval(interval1),clearInterval(interval2)}function startIntervals(){interval1=setInterval((function(){if(myInfo.isConnected){var e={data:{viewerCount:participantIds.length+1,participantUsername:currentParticipant?currentParticipant.viewerUsername:null}};supporterEncryptAgent(CMD.INTERVAL_INFO,e),viewerCount.textContent=e.data.viewerCount}else viewerCount.textContent="0"}),1e4),interval2=setInterval((function(){if(myInfo.isConnected){var e={viewerCount:participantIds.length+1};orchesterSend(e,SERVER_ENDPOINT.SET_STATISTICS_DATA,(function(e,t){e&&t.status}))}}),3e4)}function preSupporterLiveCheck(){var e={title:" برای ورود به اتاق آماده هستید ؟",body:"<span>برای ورود به اتاق اجازه دسترسی به میکروفن و دوربین دستگاه شما مورد نیاز است</span>",control:'<span id="precheck_bt" class="button_ctr2 bg-css-blue bt">بله اجازه میدهم و لایو را شروع میکنم</span>',notClose:!0};showDialog(e),g("#precheck_bt").onclick=function(){toast.info("در حال بررسی وضعیت میکروفن و دوربین"),checkMediaPermission((function(e){if(e.canEnumerate){var t=!0;e.hasSpeakers||(t=!1,toast.error("این دستگاه فاقد خروجی صدا یا بلندگو برای مکالمه است")),e.hasMicrophone||(t=!1,toast.error("این دستگاه فاقد ورودی صدا یا میکروفن برای مکالمه است")),e.hasWebcam||(t=!1,toast.error("این دستگاه فاقد ورودی تصویر یا دوربین برای مکالمه است")),t&&(e.withMicrophonePermission||(t=!1,toast.error("در این مرورگر دسترسی میکروفن داده نشده است لطفا آنرا فعال کنید")),e.withWebcamPermission||(t=!1,toast.error("در این مرورگر دسترسی دوربین وبکم داده نشده است لطفا آنرا فعال کنید")),t?(toast.success("اجازه دسترسی وجود دارد، در حال اتصال به اتاق"),checkParams(),closeDialog()):getCamAndMicPermission((function(e){if(e)toast.success("اجازه دسترسی داده شده است، در حال اتصال به اتاق"),checkParams(),closeDialog();else{closeDialog(),toast.error("اجازه دسترسی به میکروفن و یا دوربین وبکم بسته شده است لطفا از طریق راهنما دسترسی را فعال کنید");var t={notClose:!0,title:" راهنمای دسترسی میکروفن و دوربین:",control:'<span id="media_help" class="button_ctr2 bg-css-blue bt">راهنما را باز کن</span>'};showDialog(t),g("#media_help").onclick=function(){openLinkInNewTab("https://kharidlive.ir/etc/help-permission-problems-resolving")}}}),!0))}else toast.error("میکروفن و دوربین قابل شناسایی نبود! از آخرین ورژن مرورگر کروم و یا دستگاه دیگر استفاده کنید")}))}}let accessToHostServer=()=>{let e=new FormData;e.append("supporterId",myInfo.supporterId),e.append("siteId",myInfo.siteId),e.append("serverSession",myInfo.serverSession),e.append("talkSession",myInfo.talkSession);let t=`${hostServerAddress}/supporter/access-new-supporter`;requestSender(t,e,"POST",(e=>{e.valid?toast.success(e.pMessage):toast.error(e.pMessage)}))};function setTalkSession(){previousActiveParticipant&&!previousActiveParticipant.isEndTimeSent&&(previousActiveParticipant.isEndTimeSent=!0,orchesterSend({publisherId:previousActiveParticipant.userRoomId,customerTalkSession:previousActiveParticipant.talkSession,duration:Math.floor((1*new Date-previousActiveParticipant.startTalkTime)/1e3),offerQty:previousActiveParticipant.offerQty},SERVER_ENDPOINT.SET_TALK_SESSION,(function(e,t){e&&"ok"===t.status?toast.success("آمار این مکالمه ثبت شد"):toast.error("متاسفانه آمار این مکالمه ثبت نشد")})))}function resetWhenInDisconnection(){currentParticipant=null,previousActiveParticipant=null,customerVideo.classList.add(hide),currentParticipantRoomId=-1,myInfo.isConnected=!1,toast.error("ارتباط مشتری جاری قطع شد"),participantIds=[],talkWaitingQueue=[],stopIntervals(),setTalkQueueQty()}preSupporterLiveCheck();
/*!host_video_player_script.js*/
var supporterVideoLastTime,supporterVideoCurrentTime,hostVideoElem,videoTimerInterval,viewerTimerQuestion,progressBar,videoFileName;function videoToggleQuestion(){g("#question_container").classList.contains("hide")?changeElementsVisibility(["#video_container"],["#question_container"]):changeElementsVisibility(["#question_container"],["#video_container"]),g("#video_time_to_question span").innerHTML=toHoursAndMinutes(parseInt(hostVideoElem.currentTime)),viewerTimerQuestion=hostVideoElem.currentTime}function showVideoTime(){videoTimerInterval&&clearInterval(videoTimerInterval),setTimeout((()=>{let e=g("#video_timer"),t=toHoursAndMinutes(hostVideoElem.duration);videoTimerInterval=setInterval((()=>{let i=toHoursAndMinutes(hostVideoElem.currentTime);e.innerHTML=i+"/"+t,hostVideoElem.ended&&(clearInterval(videoTimerInterval),changeImgSrc("#play_pause_player_bt img","i/play.svg")),updateProgressBar()}),1e3)}),100)}function toHoursAndMinutes(e){let t=Math.floor(e/60),i=sizableTime(e%60),r=sizableTime(Math.floor(t/60)),o=sizableTime(t%60);return r=r||"00",o=o||"00",i=i||"00",`${r}:${o}:${i}`}function sizableTime(e){return e?2==String(parseInt(e)).length?String(parseInt(e)):"0"+String(parseInt(e)):"00"}function changeImgSrc(e,t){g(e).src=t}function setLatestVideoTimer(){questionMode||(supporterVideoLastTime=hostVideoElem.currentTime,mediaHistory.history[mediaHistory.latestMediaName].pointer=hostVideoElem.currentTime)}function seek(e){var t=e.offsetX/this.offsetWidth;hostVideoElem.currentTime=t*hostVideoElem.duration,e.target.value=Math.floor(t/100),e.target.innerHTML=progressBar.value+"% played",supporterVideoCurrentTime=hostVideoElem.currentTime;let i={data:{state:MEDIA_STATE.UPDATE_SEEKBAR,videoTimer:supporterVideoCurrentTime}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,i),updateProgressBar(),setLatestVideoTimer()}function updateProgressBar(){var e=Math.floor(100/hostVideoElem.duration*hostVideoElem.currentTime);progressBar&&(progressBar.value=e,progressBar.innerHTML=e+"% played")}ntrx.supporterPlayVideo=function(e){g("#video_timer");hostVideoElem.paused?(changeImgSrc("#play_pause_player_bt img","i/pause.svg"),hostVideoElem.play(),showVideoTime()):(changeImgSrc("#play_pause_player_bt img","i/play.svg"),hostVideoElem.pause(),clearInterval(videoTimerInterval));let t={data:{state:MEDIA_STATE.PAUSE_MOVIE,videoTimer:hostVideoElem.currentTime,isPause:hostVideoElem.paused}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,t),setLatestVideoTimer()},ntrx.videoCloseQuestion=function(){changeElementsVisibility(["#question_container"],["#video_container"])},ntrx.videoSendQuestion=function(){let e=g("#video_question_text_box").value.trim(),t=isInputValidate(e);if(e&&e.length>10)if(t[0]){let t={data:{questionType:MEDIA_MIME_TYPE.MOVIE,questionText:e,questionPointer:viewerTimerQuestion,fileAddress:g("#host_panel_video").src,talkSession:myInfo.talkSession,userName:myInfo.viewerUsername,fileName:videoFileName}};participantEncryptAgent(CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER,t),toast.info("سوال شما به سمت مشاور ارسال شد درصورت ارسال موفق پیغام برای شما قابل مشاهده میباشد"),g("#video_question_text_box").value="",ntrx.videoCloseQuestion()}else toast.error(`شما در متن سوال خود از کارکتر های غیر مجاز استفاده کرده اید {${t[1]}}`);else toast.error("طول متن سوال شما نباید کمتر از 10 کارکتر باشد")},ntrx.supporterForwardVideo=function(){(supporterVideoCurrentTime=hostVideoElem.currentTime+5)<supporterVideoLastTime||(supporterVideoLastTime=supporterVideoCurrentTime),hostVideoElem.currentTime=supporterVideoCurrentTime,showVideoTime();let e={data:{state:MEDIA_STATE.FORWARD_MOVIE,videoTimer:supporterVideoCurrentTime}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,e),setLatestVideoTimer(),updateProgressBar()},ntrx.supporterBackwardVideo=function(){hostVideoElem.currentTime-=5,supporterVideoCurrentTime=hostVideoElem.currentTime,showVideoTime();let e={data:{state:MEDIA_STATE.BACKWARK_MOVIE,videoTimer:supporterVideoCurrentTime}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,e),setLatestVideoTimer(),updateProgressBar()};
/*!host_slide_script.js*/
var slideLatestPageChecked,hosthostSlideSupporterPageIndex,hostThisPage,viewerQuestionIndex,slideFileName,slideFileArr=[];function changeSlidePage(e,t){g("#slide_image").src=t[e],g("#slide_page_number").innerHTML=`${e+1}/${t.length}`}function slideShowQuestion(){viewerQuestionIndex=slideFileArr[hostThisPage],g("#slide_question_textbox").value="",g("#slide_question_image").src=viewerQuestionIndex,changeElementsVisibility(["#slide_container"],["#slide_question_box_container"])}function changeElementsVisibility(e,t){if(e)for(let t of e)g(t).classList.add(hideClass);if(t)for(let e of t)g(e).classList.remove(hideClass)}ntrx.viewerSlideNextPage=function(){hostThisPage+1<=slideLatestPageChecked&&changeSlidePage(++hostThisPage,slideFileArr)},ntrx.viewerSlidePrewPage=function(){hostThisPage>0&&changeSlidePage(--hostThisPage,slideFileArr)},ntrx.supporterSlideNextPage=function(){if(hosthostSlideSupporterPageIndex+1<=slideFileArr.length-1){++hosthostSlideSupporterPageIndex>slideLatestPageChecked&&(slideLatestPageChecked++,questionMode||(mediaHistory.history[mediaHistory.latestMediaName].pointer=slideLatestPageChecked)),changeSlidePage(hostThisPage=hosthostSlideSupporterPageIndex,slideFileArr);let e={data:{state:MEDIA_STATE.NEXT_SLIDE_PAGE,latestPageChecked:slideLatestPageChecked,supporterPageIndex:hosthostSlideSupporterPageIndex,supporterThisPage:hostThisPage}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,e)}},ntrx.supporterSlidePrevPage=function(){if(hosthostSlideSupporterPageIndex-1>-1){hosthostSlideSupporterPageIndex--,changeSlidePage(hostThisPage=hosthostSlideSupporterPageIndex,slideFileArr);let e={data:{state:MEDIA_STATE.PREW_SLIDE_PAGE,latestPageChecked:slideLatestPageChecked,supporterPageIndex:hosthostSlideSupporterPageIndex,supporterThisPage:hostThisPage}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,e)}},ntrx.participandSendSlideQuestion=function(){let e=g("#slide_question_textbox").value.trim();if(e&&e.length>10){let t=isInputValidate(e);if(t&&t[0]){let t={data:{questionType:MEDIA_MIME_TYPE.SLIDE,questionText:e,questionPointer:hostThisPage,fileAddress:slideFileArr,talkSession:myInfo.talkSession,userName:myInfo.viewerUsername,fileName:slideFileName}};participantEncryptAgent(CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER,t),toast.info("سوال شما به سمت مشاور ارسال شد درصورت ارسال موفق پیغام برای شما قابل مشاهده میباشد"),g("#slide_question_textbox").innerHTML="",ntrx.slideCloseQuestion()}else toast.error(`شما در متن سوال خود از کارکتر های غیر مجاز استفاده کرده اید {${t[1]}}`)}else toast.error("طول متن سوال شما نباید کمتر از 10 کارکتر باشد")},ntrx.slideCloseQuestion=function(){changeElementsVisibility(["#slide_question_box_container"],["#slide_container"])};
/*!host_image_script.js*/
var imageFileName;function imageShowQuestion(){g("#image_question_container").classList.contains("hide")?changeElementsVisibility(["#image_container"],["#image_question_container"]):changeElementsVisibility(["#image_question_container"],["#image_container"])}ntrx.imageCloseQuestion=function(){changeElementsVisibility(["#image_question_container"],["#image_container"])},ntrx.imageSendQuestion=function(){let e=g("#image_question_input_element").value.trim();if(e&&e.length>10){let i=isInputValidate(e);if(i&&i[0]){let i={data:{questionType:MEDIA_MIME_TYPE.IMAGE,questionText:e,questionPointer:null,fileAddress:g("#image_container img").src,talkSession:myInfo.talkSession,userName:myInfo.viewerUsername,fileName:imageFileName}};participantEncryptAgent(CMD.SEND_MEDIA_QUESTION_TO_SUPPORTER,i),toast.info("سوال شما به سمت مشاور ارسال شد درصورت ارسال موفق پیغام برای شما قابل مشاهده میباشد"),g("#image_question_input_element").value="",ntrx.imageCloseQuestion()}else toast.error(`شما در متن سوال خود از کارکتر های غیر مجاز استفاده کرده اید {${i[1]}}`)}else toast.error("طول متن سوال شما نباید کمتر از 10 کارکتر باشد")};
/*!live_host_storage.js*/
let MEDIA_STATE=Object.freeze({CLOSE_MEDIA:1,CHANGE_SCREEN:2,PAUSE_MOVIE:3,FORWARD_MOVIE:4,BACKWARK_MOVIE:5,NEXT_SLIDE_PAGE:6,PREW_SLIDE_PAGE:7,MOVE_TO_PAGE:8,MOVE_LATEST_VIDEO_TIMER:9,UPDATE_SEEKBAR:10}),MEDIA_MIME_TYPE=Object.freeze({IMAGE:{code:1,name:"img"},MOVIE:{code:2,name:"movie"},SLIDE:{code:3,name:"slide"}});var participantQuestionLockInterval,participantQuestion={},participantQuestionLock=!1,showMediaStorageObj=null,participantQuestionchangeMediaState=null,participantSlideState=null,participantVideoState=null;function clearParticipantQuestionLock(){participantQuestionLock=!1,participantQuestion={},showMediaStorageObj&&(participantQuestionchangeMediaState&&(showMediaStorageObj.media.slideArr&&showMediaStorageObj.media.fileName===participantQuestionchangeMediaState.fileName&&(showMediaStorageObj.pointer=participantQuestionchangeMediaState.supporterPageIndex),participantQuestionchangeMediaState.state===MEDIA_STATE.CLOSE_MEDIA&&(participantQuestionchangeMediaState=null)),showMediaStorage(showMediaStorageObj.media,showMediaStorageObj.isSupporter,showMediaStorageObj),showMediaStorageObj=null),participantQuestionchangeMediaState&&setTimeout((()=>{changeMediaState(participantQuestionchangeMediaState),participantQuestionchangeMediaState=null}),300),participantSlideState&&setTimeout((()=>{showSlideDataCmd(participantSlideState),participantSlideState=null}),600),participantVideoState&&setTimeout((()=>{showVideoDataCmd(participantVideoState),participantVideoState=null}),900)}function showMediaStorage(e,i,t){if(videoTimerInterval&&clearInterval(videoTimerInterval),!i&&participantQuestionLock)showMediaStorageObj={media:e,isSupporter:i,pointer:e.pointer},monsole.log(")))))))))1))))) showMediaStorage media:",e,"isSupporter:",i,"latestMedia:",t);else if(monsole.log(")))))))))2))))) showMediaStorage media:",e,"isSupporter:",i,"latestMedia:",t),e)switch(i&&(mediaHistory.latestMediaData=e,t&&void 0!==t.pointer&&(mediaHistory.history[mediaHistory.latestMediaData.fileName]={pointer:t.pointer})),e.mimeType){case MEDIA_MIME_TYPE.IMAGE.code:showImageMedia(e.fileAddressUrl,e.fileName,i,e.questionText),imageFileName=e.fileName,closeDialog(),i?mediaHistory.history[e.fileName]?mediaHistory.latestMediaName=e.fileName:insertNewMediaHistory(e):g("#ask_media_question_bt").onclick=imageShowQuestion;break;case MEDIA_MIME_TYPE.MOVIE.code:if(showVideoMedia(e.fileAddressUrl,t?t.pointer:0,i,e.questionText),videoFileName=e.fileName,closeDialog(),i)if(mediaHistory.history[e.fileName]){mediaHistory.latestMediaName=e.fileName,hostVideoElem.currentTime=mediaHistory.history[e.fileName].pointer;let i={data:{state:MEDIA_STATE.MOVE_LATEST_VIDEO_TIMER,pointer:mediaHistory.history[e.fileName].pointer,fileName:mediaHistory.latestMediaName}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,i)}else insertNewMediaHistory(e);else g("#ask_media_question_bt").onclick=videoToggleQuestion;showVideoTime();break;case MEDIA_MIME_TYPE.SLIDE.code:if(showSlideMedia(e.slideArr,t?t.pointer:0,i,e.questionText),slideFileName=e.fileName,closeDialog(),i)if(mediaHistory.history[e.fileName]){mediaHistory.latestMediaName=e.fileName,slideLatestPageChecked=mediaHistory.history[e.fileName].pointer,hosthostSlideSupporterPageIndex=mediaHistory.history[e.fileName].pointer,hostThisPage=mediaHistory.history[e.fileName].pointer;let i={data:{state:MEDIA_STATE.MOVE_TO_PAGE,pointer:mediaHistory.history[e.fileName].pointer,fileName:mediaHistory.latestMediaName}};supporterEncryptAgent(CMD.CHANGE_HOST_MEDIA_STATE,i)}else insertNewMediaHistory(e);else g("#ask_media_question_bt").onclick=slideShowQuestion}}function insertNewMediaHistory(e){mediaHistory.latestMediaName=e.fileName,mediaHistory.history[e.fileName]={},mediaHistory.history[e.fileName].pointer=0}function showImageMedia(e,i,t,o){closeDotMenuOpen();let s='<div id="host_image_container"><div id="user_question" class="'+(o?"":"hide")+'"><p>'+o+'</p></div><div id="image_container">'+`<img src="${e}" alt="${i}"></div>`;s+=t?"</div></div>":'<div id="image_question_container" class="hide"><div id="host_media_question_text_container">     <textarea id="image_question_input_element" class="height100" cols="30" rows="10" placeholder="سوالی داری بپرس؟"></textarea></div><div id="host_media_question_voice_container" class="hide" style="width: 400px;"><div class="host_voice_container">        <h3>سوال خود را بپرسید :</h3>        <div class="host_voice_bt">            <button id="startRecord" class="host_bt">استارت</button>            <span id="voice_timer">00:00:00</span>            <button id="stopRecord" class="host_bt" disabled>استاپ</button>        </div>        <div>            <audio id="recordedAudio"></audio>            <a id="audioDownload"></a>        </div>        <div id="host_voice_result_bt" class="host_voice_bt">            <button id="reset_voice_bt" class="host_bt" disabled onclick="reset()">ریست</button>            <button id="send_voice_bt" class="host_bt" disabled>ارسال</button>        </div>    </div></div><div class="bt_container"><button id="image_send_question_bt" class="host_bt" onclick="ntrx.imageSendQuestion()">بفرست</button><button id="image_back_question_bt" class="host_bt" onclick="ntrx.imageCloseQuestion()">منصرف شدم</button></div></div></div>',g("#media_container").innerHTML=s,g("#host_media_wrapper").classList.remove("hide")}function showVideoMedia(e,i,t,o){closeDotMenuOpen();let s='<div id="host_video_container"  class="default_screen"><div id="user_question" class="'+(o?"":"hide")+'"><p>'+o+'</p></div><div id="video_container"><div id="host_video_box"><span id="video_timer" class="">00:00:00/00:00:00</span><span id="screen_state_text"></span>'+`<video id="host_panel_video" src="${e}"></video>`;s+=t?'<div class="host_video_button_container"><button onclick="ntrx.supporterBackwardVideo()"><img alt="" src="i/fast-rewind-line.svg"></button><button onclick="ntrx.supporterPlayVideo(this)" id="play_pause_player_bt"><img alt="" src="i/play.svg"></button><button onclick="ntrx.supporterForwardVideo()"><img alt="" src="i/fast-forward-bold.svg"></button><progress id="video_progress_bar" min="0" max="100" value="0">0% played</progress><div></div></div></div></div></div>':'</div></div><div id="question_container" class="hide"><div id="host_media_question_text_container">     <div id="video_time_to_question">تایمر متوقف شده <span></span></div>     <textarea name="" id="video_question_text_box" cols="30" rows="10" placeholder="سوالی داری بپرس ؟ "></textarea></div><div id="host_media_question_voice_container" class="hide" style="display: flex;align-items: center; justify-content: center"><div class="host_voice_container">        <h3>سوال خود را بپرسید :</h3>        <div class="host_voice_bt">            <button id="startRecord" class="host_bt">استارت</button>            <span id="voice_timer">00:00:00</span>            <button id="stopRecord" class="host_bt" disabled>استاپ</button>        </div>        <div>            <audio id="recordedAudio"></audio>            <a id="audioDownload"></a>        </div>        <div id="host_voice_result_bt" class="host_voice_bt">            <button id="reset_voice_bt" class="host_bt" disabled onclick="reset()">ریست</button>            <button id="send_voice_bt" class="host_bt" disabled>ارسال</button>        </div>    </div></div><div class="question_bt_box"><button onclick="ntrx.videoSendQuestion()" id="video_send_question_bt" class="host_bt">بفرست</button><button onclick="ntrx.videoCloseQuestion()" id="video_cancel_question_bt" class="host_bt">منصرف شدم</button></div></div></div>',g("#media_container").innerHTML=s,g("#host_media_wrapper").classList.remove("hide"),hostVideoElem=document.querySelector("#host_panel_video"),supporterVideoCurrentTime=i,supporterVideoLastTime=i,hostVideoElem.currentTime=i,progressBar=document.getElementById("video_progress_bar"),progressBar&&progressBar.addEventListener("click",seek)}function showSlideMedia(e,i,t,o){closeDotMenuOpen();let s='<div id="slide_container"><div id="user_question" class="'+(o?"":hide)+'"><p>'+o+'</p></div><div id="slide_file_container"><img id="slide_image"></div><div id="slide_bt_container">';s+=t?'<button class="slide_bt slide_bt_right" onclick="ntrx.supporterSlideNextPage()">></button><span id="slide_page_number"></span><button class="slide_bt slide_bt_left" onclick="ntrx.supporterSlidePrevPage()"><</button></div></div></div>':'<button class="slide_bt slide_bt_right" onclick="ntrx.viewerSlideNextPage()">></button><div id="slide_page_index"><span id="slide_page_number"></span></div><button class="slide_bt slide_bt_left" onclick="ntrx.viewerSlidePrewPage()"><</button></div></div><div class="hide" id="slide_question_box_container"><div id="host_media_question_text_container"><div id="slide_image_question_box" class="height100 hide"><img alt="" id="slide_question_image" class="hide"></div><div id="slide_inputs_question_box"><div id="slide_ask_question_input"><textarea id="slide_question_textbox" class="height100" cols="30" rows="10" placeholder="سوالی داری بپرس؟"></textarea></div></div></div><div id="host_media_question_voice_container" class="hide" style="display: flex;align-items: center; justify-content: center">    <div class="host_voice_container">        <h3>سوال خود را بپرسید :</h3>        <div class="host_voice_bt">            <button id="startRecord" class="host_bt">استارت</button>            <span id="voice_timer">00:00:00</span>            <button id="stopRecord" class="host_bt" disabled>استاپ</button>        </div>        <div>            <audio id="recordedAudio"></audio>            <a id="audioDownload"></a>        </div>        <div id="host_voice_result_bt" class="host_voice_bt">            <button id="reset_voice_bt" class="host_bt" disabled onclick="reset()">ریست</button>            <button id="send_voice_bt" class="host_bt" disabled>ارسال</button>        </div>    </div></div><div id="slide_button_question_box"><button id="slide_send_question_bt" class="host_bt" onclick="ntrx.participandSendSlideQuestion()">بفرست</button><button id="slide_cancel_question_bt" class="host_bt" onclick="ntrx.slideCloseQuestion()">منصرف شدم</button></div></div>',monsole.log("showSlideMedia slideArr:",e,"slideIndex:",i,"isSupporter:",t,"questionBody:",o),g("#media_container").innerHTML=s,g("#host_media_wrapper").classList.remove("hide"),slideFileArr=e||[],slideLatestPageChecked=i||0,hosthostSlideSupporterPageIndex=i||0,hostThisPage=i||0,monsole.log("showSlideMedia 2  slideArr:",e,"slideIndex:",i,"isSupporter:",t,"questionBody:",o,"hosthostSlideSupporterPageIndex:",hosthostSlideSupporterPageIndex),changeSlidePage(hosthostSlideSupporterPageIndex,slideFileArr)}function resetMediaState(){showMediaStorageObj=null,g("#host_media_wrapper").classList.add("hide"),g("#media_container").innerHTML="",videoTimerInterval&&clearInterval(videoTimerInterval)}function changeMediaState(e){if(monsole.log("changeMediaState data",e),videoTimerInterval&&clearInterval(videoTimerInterval),participantQuestionLock)participantQuestionchangeMediaState=e;else if(e)switch(e.state){case MEDIA_STATE.CLOSE_MEDIA:resetMediaState();break;case MEDIA_STATE.CHANGE_SCREEN:break;case MEDIA_STATE.PAUSE_MOVIE:hostVideoElem.currentTime=e.videoTimer,e.isPause?hostVideoElem.pause():hostVideoElem.play(),showVideoTime();break;case MEDIA_STATE.FORWARD_MOVIE:case MEDIA_STATE.BACKWARK_MOVIE:hostVideoElem.currentTime=e.videoTimer,showVideoTime();break;case MEDIA_STATE.NEXT_SLIDE_PAGE:case MEDIA_STATE.PREW_SLIDE_PAGE:slideLatestPageChecked=e.latestPageChecked,hosthostSlideSupporterPageIndex=e.supporterPageIndex,hostThisPage=e.supporterThisPage,changeSlidePage(hostThisPage,slideFileArr);break;case MEDIA_STATE.MOVE_TO_PAGE:slideLatestPageChecked=e.pointer,hosthostSlideSupporterPageIndex=e.pointer,hostThisPage=e.pointer,changeSlidePage(hostThisPage,slideFileArr);break;case MEDIA_STATE.MOVE_LATEST_VIDEO_TIMER:hostVideoElem.currentTime=e.pointer,showVideoTime();break;case MEDIA_STATE.UPDATE_SEEKBAR:hostVideoElem.currentTime=e.videoTimer,showVideoTime()}}g("#change_media_container_bt").onclick=()=>{g("#middle_wrapper").classList.toggle("host_container_mode_2")};
})();